import{R as s,r as e,j as r}from"./B29SdWEC.js";import{F as a,A as t,I as o,J as i,K as d}from"./CPF8VAmO.js";import{R as l}from"./Cri8ushB.js";import{a as p,d as n}from"./B5AZvu_e.js";import{d as c,b as j,c as m,Q as x,R as w,S as h,T as u,X as g,Y as f,U as v,a as b}from"./BYX7WaHQ.js";import"./ucIcx5RQ.js";import"./E8MUDNEF.js";import"./4RmQ9_ev.js";import"./CIdotNGq.js";import"./yJGO6Amu.js";import"./BIw_sdFo.js";import"./BFKNndIN.js";import"./BjhGVRpM.js";import"./BFk34ZWe.js";import"./BmTZu7tj.js";import"./CxXfFpkk.js";import"./DPENoFOj.js";import"./Ba2eFa9Y.js";import"./BOgnOvQQ.js";import"./CjjZDEdp.js";import"./K-dupnmX.js";import"./FLTEVThY.js";import"./DPAjA2jz.js";import"./DWXbBa0z.js";import"./BVv0Fxeo.js";import"./CzGuHLZU.js";import"./B8Let_61.js";import"./fZjk1EK6.js";import"./BXEMiIsG.js";import"./Bb7MnDjl.js";import"./CA9thugF.js";import"./BPjVUy-D.js";import"./C_n0TLp5.js";import"./DYPlXUME.js";import"./BqHrj3jM.js";const S=()=>{const{user:S}=p(),y=s.useRef(),[C,N]=e.useState(!1),[_,k]=e.useState({password:"",new_password:"",repeat_password:""}),[A,R]=e.useState(!1),[q,z]=e.useState(!1),[K,P]=e.useState({error:!1,message:""}),D=s=>{const{id:e,value:r}=s.target;k((s=>({...s,[e]:r})))},H=[{id:1,text:"At least 8 characters",test:s=>s.length>=8},{id:2,text:"At least one uppercase letter",test:s=>/[A-Z]/.test(s)},{id:3,text:"At least one lowercase letter",test:s=>/[a-z]/.test(s)},{id:4,text:"At least one number",test:s=>/[0-9]/.test(s)},{id:5,text:"At least one special character",test:s=>/[!@#$%^&*(),.?":{}|<>]/.test(s)}],I=s=>H.map((e=>({...e,passed:e.test(s)}))),[J,O]=e.useState(I(_.new_password));return r.jsxs("div",{children:[C&&r.jsx("div",{className:"loading-overlay",children:r.jsx(c,{color:"primary",variant:"grow"})}),r.jsx(l,{ref:y,size:"invisible",sitekey:n}),r.jsxs(j,{xs:{cols:1},sm:{cols:2},children:[r.jsxs(m,{children:[r.jsxs("h4",{children:["OK"===S.password?"Change":"Set"," Password"]}),r.jsx(x,{className:"mb-3",children:r.jsxs(w,{children:[K.error&&r.jsxs(h,{color:"danger",className:"d-flex align-items-center",children:[r.jsx(a,{className:"flex-shrink-0 me-2",icon:t,size:"xl"}),r.jsx("div",{children:K.message})]}),r.jsxs(u,{onSubmit:async s=>{s&&s.preventDefault();const e=await y.current.executeAsync();N(!0),axios.post("/auth/password",{..._,recaptcha_ref:e}).then((s=>{if(s.data.error)return P({error:!0,message:s.data.error});window.location.reload()})).catch((s=>{var e,r;const a=(null==(r=null==(e=s.response)?void 0:e.data)?void 0:r.error)||("network error"===s.message?"Server is offline or restarting please wait":s.message);P({error:!0,message:a})})).finally((()=>N(!1)))},children:["OK"===S.password&&r.jsxs(g,{className:"mb-3",children:[r.jsx(f,{children:r.jsx(a,{icon:o})}),r.jsx(v,{id:"password",type:A?"text":"password",placeholder:"Password",autoComplete:"current-password",value:_.password,onChange:s=>D(s),required:!0}),r.jsx(f,{children:r.jsx("span",{onClick:s=>R(!A),"aria-label":A?"Hide password":"Show password",children:r.jsx(a,{icon:A?i:d,onClick:s=>R(!A)})})})]}),r.jsxs(g,{className:"mb-3",children:[r.jsx(f,{children:r.jsx(a,{icon:o})}),r.jsx(v,{id:"new_password",type:q?"text":"password",placeholder:"New Password",autoComplete:"new-password",value:_.new_password,onChange:s=>(s=>{D(s),"new_password"===s.target.id&&O(I(s.target.value))})(s),required:!0}),r.jsx(f,{children:r.jsx("span",{onClick:s=>z(!q),"aria-label":q?"Hide password":"Show password",children:r.jsx(a,{icon:q?i:d,onClick:s=>z(!q)})})})]}),r.jsx("ul",{children:J.map((s=>r.jsx("li",{style:{color:s.passed?"green":"red"},children:s.text},s.id)))}),r.jsxs(g,{className:"mb-3",children:[r.jsx(f,{children:r.jsx(a,{icon:o})}),r.jsx(v,{id:"repeat_password",type:"password",placeholder:"Repeat password",autoComplete:"new-password",value:_.repeat_password,onChange:s=>D(s),required:!0})]}),r.jsx(b,{type:"submit",color:"primary",className:"d-block me-2 rounded",children:"Save changes"})]})]})})]}),r.jsx(m,{})]})]})};export{S as default};
