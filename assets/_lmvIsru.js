/**
 * Â© 2025 Melvin Jones Repol & its contributors . All rights reserved.
 * This project is licensed under the MIT License with Commons Clause.
*/
import{R as s,r as e,j as i}from"./CbKKHx2O.js";import{R as o}from"./DfG9QjQz.js";import{F as a,$ as l}from"./VnuSoLuO.js";import{u as t,G as r,M as n}from"./CvRXgUud.js";import{b as c,e as d,o as m}from"./tc-6uyop.js";import{A as j}from"./C4GBeDCy.js";import{p}from"./2aPQtUzY.js";import{d as u,b as x,c as h,Q as g,R as v,a as f,e as b,f as N,g as y,h as S,i as _}from"./y9pk00oJ.js";import"./D9QqU1Un.js";import"./z-cSZRUs.js";import"./vr9ZyHRf.js";import"./DylAs1sT.js";import"./yJGO6Amu.js";import"./BKrKJ3DW.js";import"./BFk34ZWe.js";import"./BIw_sdFo.js";import"./CXjkhZnE.js";import"./U6rf_yqH.js";import"./D68gzNyG.js";import"./6thM_Rat.js";import"./BsZLDNo0.js";import"./CAJYX4M0.js";import"./Bhaa8ZPc.js";import"./K-dupnmX.js";import"./B7alYAEp.js";import"./DP3P1EsK.js";import"./C3hrCPXF.js";import"./Dw0KO6EP.js";import"./CzGuHLZU.js";import"./B8Let_61.js";import"./CPqRiR-E.js";import"./fZjk1EK6.js";import"./BXEMiIsG.js";import"./Bb7MnDjl.js";import"./CA9thugF.js";import"./BPjVUy-D.js";import"./CTpwok2W.js";import"./DYPlXUME.js";import"./BqHrj3jM.js";const k=()=>{const{isLoaded:k}=t({id:"google-map-script",googleMapsApiKey:m}),C=s.useRef(),{addToast:w}=c(),[O,L]=e.useState(!0),[P,J]=e.useState([]),[z,A]=e.useState(1),[T,M]=e.useState(0),[R,F]=e.useState(!1),[G,I]=e.useState(!1),[E,K]=e.useState(null),[Q,V]=e.useState(null);s.useCallback((function(s){V(s)}),[]),s.useCallback((function(s){V(null)}),[]);const W=async s=>{const e=await C.current.executeAsync();L(!0),axios.post("/sec/sessions/logout",{session_id:s,recaptcha_ref:e}).then((e=>{w(e.data.message),J(s?e=>({...e,sessions:e.sessions.filter((e=>e._id!==s))}):s=>({...s,sessions:[]}))})).catch((s=>{var e,i;const o=(null==(i=null==(e=s.response)?void 0:e.data)?void 0:i.error)||("network error"===s.message?"Server is offline or restarting please wait":s.message);w(o)})).finally((()=>L(!1)))};return e.useEffect((()=>{(async s=>{axios.post("/sec/sessions",{page:s}).then((s=>{J(s.data.data),M(s.data.totalPages)})).catch((s=>{var e,i;const o=(null==(i=null==(e=s.response)?void 0:e.data)?void 0:i.error)||("network error"===s.message?"Server is offline or restarting please wait":s.message);w(o)})).finally((()=>L(!1)))})(z)}),[z]),O?i.jsx("div",{className:"loading-overlay",children:i.jsx(u,{color:"primary",variant:"grow"})}):i.jsxs("div",{children:[i.jsxs(x,{xs:{cols:1},sm:{cols:2},children:[i.jsxs(h,{className:"mb-3",children:[i.jsx("h4",{children:"This device"}),i.jsx(g,{children:i.jsxs(v,{children:[i.jsxs("div",{className:"d-flex justify-content-between",children:[i.jsx("p",{className:"display-3",children:"::1"===P.current_session.ip_address||"::ffff:127.0.0.1"===P.current_session.ip_address?"localhost":P.current_session.ip_address}),i.jsx("span",{onClick:s=>{K(P.current_session),I(!0)},children:i.jsx(a,{icon:l,size:"xl"})})]}),i.jsx("span",{className:"lead",children:P.current_session.user_agent})]})})]}),i.jsxs(h,{className:"mb-3",children:[i.jsx("h4",{children:"Logout other sessions"}),i.jsx(g,{children:i.jsxs(v,{children:[i.jsx("p",{children:"Clearing all device sessions will log you out from all devices and browsers, except for the one you're currently using."}),i.jsx(f,{type:"submit",color:"danger",className:"mt-4 d-block me-2 rounded",disabled:P.logout,onClick:s=>F(!0),children:"Logout other sessions"})]})})]})]}),P.sessions.map(((s,e)=>i.jsxs("div",{children:[i.jsx(g,{className:"mb-3",children:i.jsxs(v,{children:[i.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[i.jsx("h3",{className:(s.active?"text-primary":"")+" text-truncate",children:s.user_agent}),i.jsxs("div",{className:"text-right d-flex justify-content-end",children:[i.jsx("span",{className:"me-4",onClick:e=>{K(s),I(!0)},children:i.jsx(a,{icon:l,size:"xl"})}),i.jsx(f,{color:"danger",className:"ms-auto",onClick:e=>W(s._id),children:"Logout"})]})]}),i.jsxs("div",{className:"d-block d-sm-flex",children:[i.jsxs("div",{className:"me-3 mb-2",children:[i.jsx("span",{className:"text-muted",children:"Last accessed"}),i.jsxs("span",{className:"d-block small",children:[s.last_accessed?p(s.last_accessed):"Never"," ","| ",s.active?"Verified":"Not verified"]})]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-muted",children:"IP Address"}),i.jsx("span",{className:"d-block small text-capitalize",children:"::1"===s.ip_address?"localhost":s.ip_address})]})]})]})}),T>1&&i.jsx(j,{currentPage:z,setCurrentPage:A,totalPages:T,setTotalPages:M})]},e))),i.jsxs(b,{alignment:"center",scrollable:!0,visible:R,onClose:()=>F(!1),"aria-labelledby":"M",children:[i.jsx(N,{children:i.jsx(y,{children:"Confirm Logout?"})}),i.jsx(S,{children:"Are you sure you want to logout all sessions? This action cannot be undone."}),i.jsxs(_,{className:"d-flex justify-content-end",children:[i.jsx(f,{color:"secondary",onClick:s=>W(null),children:"Okay"}),i.jsx(f,{color:"primary",onClick:()=>{F(!1)},className:"ms-2",children:"Cancel"})]})]}),i.jsxs(b,{alignment:"center",scrollable:!0,visible:G,onClose:()=>I(!1),"aria-labelledby":"M",children:[i.jsx(N,{children:i.jsx(y,{children:null==E?void 0:E.user_agent})}),i.jsxs(S,{children:[i.jsx("strong",{children:"IP Address:"})," ",null==E?void 0:E.ip_address,i.jsx("div",{className:"mb-2 border-bottom"}),i.jsx("strong",{children:"Latitude:"})," ",(null==E?void 0:E.location)?JSON.parse(null==E?void 0:E.location)[0].latitude:0,i.jsx("div",{className:"mb-2 border-bottom"}),i.jsx("strong",{children:"Longtitude:"})," ",JSON.parse((null==E?void 0:E.location)?JSON.parse(null==E?void 0:E.location)[0].longitude:0),i.jsx("div",{className:"mb-4 border-bottom"}),k&&i.jsxs(i.Fragment,{children:[i.jsx(r,{mapContainerStyle:{height:"400px",width:"auto"},center:{lat:(null==E?void 0:E.location)?JSON.parse(null==E?void 0:E.location)[0].latitude:0,lng:(null==E?void 0:E.location)?JSON.parse(null==E?void 0:E.location)[0].longitude:0},zoom:18,children:i.jsx(n,{position:{lat:(null==E?void 0:E.location)?JSON.parse(null==E?void 0:E.location)[0].latitude:0,lng:(null==E?void 0:E.location)?JSON.parse(null==E?void 0:E.location)[0].longitude:0}})}),i.jsx("p",{className:"text-muted mt-2",children:"Note: GPS accuracy may vary significantly on desktop or laptop devices compared to mobile phones."})]})]})]}),i.jsx(o,{ref:C,size:"invisible",sitekey:d})]})};export{k as default};
