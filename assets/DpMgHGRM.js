import{r as i,R as A,j as e}from"./D3kDgYDB.js";import{F as P,H as S}from"./DY2y_89w.js";import{R as b}from"./D0iU1EWp.js";import{u as _}from"./CQ-yZ3vu.js";import{c as p,b as I,V as f}from"./B1KJEzUT.js";import{E as R}from"./URk2IvX2.js";import{d as T}from"./o5tV6Bm-.js";import{c as B,C as $,M as L,N as O,U as V,V as z,W as D,m as F,o as K,T as g}from"./0xvR-hIp.js";import"./CNSOrHVr.js";import"./WyM-ksIe.js";import"./dB90dn3U.js";import"./Dw8pycEM.js";import"./8JwjhRSi.js";import"./BmHAl9XU.js";import"./CWoBZRFf.js";import"./tpRZQFqq.js";import"./CzFDRTuY.js";import"./B6-gGlhp.js";import"./DzfTGk6K.js";import"./hKczlkOd.js";import"./CXnULsF_.js";import"./CCb-kr4I.js";import"./Cz0CWeBA.js";import"./Cp7XljvA.js";import"./BQBsAJpH.js";import"./DRFurTTo.js";import"./BZxJdD1U.js";const ge=()=>{const[x,c]=i.useState(!0),[l,j]=i.useState(""),[d,u]=i.useState({error:!1,message:""}),[n,y]=i.useState(["","","","","",""]),m=cookies.get(p),o=T(),h=A.useRef();_();const v=async()=>{if(m===void 0)return o("/login");await axios.post(`${f}/api/v1/auth/verify`,{},{headers:{Authorization:`Bearer ${m}`}}).then(r=>{if(r.data.is_email_verified)return o("/");j(r.data.email)}).catch(r=>{if(!r.response)return console.error(r);cookies.remove(p),o("/login")}).finally(()=>c(!1))};i.useEffect(()=>{v()},[o]);const C=(r,t)=>{const a=r.target.value.replace(/[^0-9]/g,"");if(a.length<=1){const s=[...n];s[t]=a,a&&t<5&&document.getElementById(`otp-input-${t+1}`).focus(),y(s)}},E=()=>{cookies.remove(p),window.location.href="/login"},k=(r,t)=>{r.key==="Backspace"&&!n[t]&&t>0&&document.getElementById(`otp-input-${t-1}`).focus()},w=async r=>{r.preventDefault(),c(!0);const t=await h.current.executeAsync();await axios.post(`${f}/api/v1/auth/verify/otp`,{otp:n,recaptcha_ref:t},{headers:{Authorization:`Bearer ${m}`}}).then(a=>{if(a.data.error)return u({error:!0,message:a.data.error});const s=new URLSearchParams(window.location.search),N=s.get("n")?s.get("n"):"/";o(N)}).catch(a=>{console.error(a);const s=R[a.status]||"Internal Application Error";u({error:!0,message:s})}).finally(()=>c(!1))};return e.jsxs("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:[e.jsx("div",{className:"auth-bg"}),e.jsxs(B,{children:[x&&e.jsx("div",{className:"loading-overlay",children:e.jsx($,{color:"primary",variant:"grow"})}),!l&&e.jsx("p",{className:"text-center",children:"Processing..."}),l&&e.jsx(L,{className:"justify-content-center",children:e.jsx(O,{md:8,lg:6,xl:5,children:e.jsx(V,{className:"p-1 p-md-4 shadow",children:e.jsxs(z,{children:[d.error&&e.jsxs(D,{color:"danger",className:"d-flex align-items-center",children:[e.jsx(P,{className:"flex-shrink-0 me-2",icon:S,size:"xl"}),e.jsx("div",{children:d.message})]}),e.jsxs(F,{onSubmit:w,children:[e.jsx("h1",{children:"OTP"}),e.jsxs("p",{className:"text-body-secondary",children:["Enter the 6 digit code that was sent to ",e.jsx("b",{children:l}),"."]}),e.jsx(b,{ref:h,size:"invisible",sitekey:I}),e.jsx("div",{className:"d-flex justify-content-center gap-2 mb-3",children:n.map((r,t)=>e.jsx(K,{type:"text",id:`otp-input-${t}`,value:r,onChange:a=>C(a,t),onKeyDown:a=>k(a,t),className:"otp-input",maxLength:"1"},t))}),e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(g,{type:"submit",color:"primary",className:"me-2 rounded",children:"Submit"})}),e.jsx(g,{color:"link",className:"px-0 link-offset-2 link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover",onClick:E,children:"Logout"})]})]})})})})]})]})};export{ge as default};
