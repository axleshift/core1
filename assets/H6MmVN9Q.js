import{r as o,R as I,j as e}from"./D3kDgYDB.js";import{R as N}from"./D0iU1EWp.js";import{F as l,O as _,P as E,Q as P,R as S,S as R}from"./3V3OsIEt.js";import{V as T,a as x,b as u}from"./Dxvdh3Uh.js";import{E as j}from"./DYDFNPHr.js";import{C as z,D as F,E as y,y as B,O as r,M as f,K as D}from"./CRebGdRz.js";import"./CNSOrHVr.js";import"./WyM-ksIe.js";import"./dB90dn3U.js";import"./Dw8pycEM.js";import"./8JwjhRSi.js";import"./FDBtgKq2.js";import"./D3kAHpSt.js";import"./tpRZQFqq.js";import"./CzFDRTuY.js";import"./CQ-yZ3vu.js";import"./BmHAl9XU.js";import"./t_wxcTun.js";import"./DiDpq0UU.js";import"./CHUBTVDa.js";import"./CXnULsF_.js";import"./CCb-kr4I.js";import"./Cz0CWeBA.js";import"./Cp7XljvA.js";import"./BQBsAJpH.js";import"./CWmxXzlZ.js";import"./BZxJdD1U.js";const pe=()=>{const[w,c]=o.useState(!1),d=I.useRef(),[m,b]=o.useState(!0),[g,$]=o.useState(!1),[t,n]=o.useState({token:"",whitelist_ip:[]}),C=()=>{b(s=>!s)},p=async()=>{try{await navigator.clipboard.writeText(t),alert("API Key copied!")}catch(s){console.log(s),alert("Failed... no idea why.")}},h=async()=>{c(!0);const s=await d.current.executeAsync(),a=new FormData;a.append("recaptcha_ref",s),await axios.post(`${x}/api/v1/auth/token/new`,a,{headers:{Authorization:`Bearer ${cookies.get(u)}`}}).then(i=>n(i.data)).catch(i=>{console.error(i);const k=j[i.status]||"An unexpected error occurred";alert(k)}).finally(()=>c(!1))},v=async()=>{c(!0),await axios.get(`${x}/api/v1/auth/token/`,{headers:{Authorization:`Bearer ${cookies.get(u)}`}}).then(s=>n(s.data)).catch(s=>{console.error(s);const a=j[s.status]||"An unexpected error occurred";alert(a)}).finally(()=>c(!1))},A=()=>{if(!Array.isArray(t.whitelist_ip))return n(s=>({...s,whitelist_ip:[""]}));if(t.whitelist_ip.length<5)return n(s=>({...s,whitelist_ip:[...s.whitelist_ip,""]}));alert(JSON.stringify(t)),alert("Max number of whitelisted ip address reached")};return o.useEffect(()=>{v()},[]),e.jsxs("div",{children:[w&&e.jsx("div",{className:"loading-overlay",children:e.jsx(z,{color:"primary",variant:"grow"})}),e.jsx(N,{ref:d,size:"invisible",sitekey:T}),e.jsxs(F,{xs:{cols:1},sm:{cols:2},children:[e.jsxs(y,{children:[e.jsx("h4",{children:"Auth token"}),!t&&e.jsx("div",{className:"text-center border rounded mb-4",children:e.jsxs("div",{className:"p-1 p-md-5 my-5 my-md-0",children:[e.jsx(B,{src:"/images/threat.png",fluid:!0,width:"50%"}),e.jsx("h1",{children:"There was no API Token"}),e.jsx(r,{color:"primary",size:"sm",onClick:h,children:"Generate Token"})]})}),t&&e.jsx("div",{className:"text-center border rounded mb-4",children:e.jsxs("div",{className:"p-2 p-md-3 my-5 my-md-0",children:[e.jsxs("div",{className:"d-flex mb-3",children:[e.jsx(f,{className:m?"blurred":"",value:t.token,"aria-describedby":"basic-addon"}),e.jsx(r,{className:"ms-2",onClick:C,children:e.jsx(l,{icon:m?_:E})}),e.jsx(r,{className:"ms-2",onClick:p,children:e.jsx(l,{icon:P})})]}),e.jsx(r,{color:"primary",size:"sm",onClick:h,children:"Generate new token"})]})})]}),e.jsxs(y,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h4",{children:"Ip address"}),e.jsxs(r,{color:"success",size:"sm",className:"text-white",onClick:A,disabled:g,children:[e.jsx(l,{icon:S})," Create"]})]}),!t.whitelist_ip&&e.jsx("div",{className:"text-center border rounded mb-4",children:e.jsx("div",{className:"p-2 p-md-3 my-5 my-md-0",children:e.jsx("h6",{children:"There was no Whitelisted IP Addresses"})})}),t.whitelist_ip&&e.jsx("div",{className:"text-center border rounded mb-4",children:e.jsx("div",{className:"p-2 p-md-3 my-5 my-md-0",children:e.jsxs(D,{children:[t.whitelist_ip.map((s,a)=>e.jsxs("div",{className:"d-flex mb-2",children:[e.jsx(f,{value:s,onChange:i=>handleIpChange(a,i.target.value),placeholder:`192.168.0.${a+1}`}),e.jsx(r,{color:"danger",className:"text-white ms-2",onClick:p,children:e.jsx(l,{icon:R})})]},a)),e.jsx(r,{type:"submit",color:"primary",className:"d-block me-2 rounded",children:"Save changes"})]})})})]})]})]})};export{pe as default};
