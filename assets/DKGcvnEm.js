import{R as s,r as e,j as a}from"./CbKKHx2O.js";import{R as i}from"./DfG9QjQz.js";import{F as l,a3 as o}from"./BQD-ZI7K.js";import{u as t,G as r,M as n}from"./CvRXgUud.js";import{b as c,e as d,o as m}from"./CPHEUBAJ.js";import{A as j}from"./DJvZbr7v.js";import{p}from"./2aPQtUzY.js";import{d as u,b as x,c as h,Q as g,R as v,a as f,e as b,f as y,g as N,h as _,i as k}from"./C-SwLysj.js";import"./D9QqU1Un.js";import"./z-cSZRUs.js";import"./vr9ZyHRf.js";import"./DylAs1sT.js";import"./yJGO6Amu.js";import"./BKrKJ3DW.js";import"./BFk34ZWe.js";import"./BIw_sdFo.js";import"./CXjkhZnE.js";import"./U6rf_yqH.js";import"./D68gzNyG.js";import"./6thM_Rat.js";import"./BsZLDNo0.js";import"./CAJYX4M0.js";import"./Bhaa8ZPc.js";import"./K-dupnmX.js";import"./B7alYAEp.js";import"./DP3P1EsK.js";import"./C3hrCPXF.js";import"./Dw0KO6EP.js";import"./CzGuHLZU.js";import"./B8Let_61.js";import"./CPqRiR-E.js";import"./fZjk1EK6.js";import"./BXEMiIsG.js";import"./Bb7MnDjl.js";import"./CA9thugF.js";import"./BPjVUy-D.js";import"./CTpwok2W.js";import"./DYPlXUME.js";import"./BqHrj3jM.js";const S=()=>{const{isLoaded:S}=t({id:"google-map-script",googleMapsApiKey:m}),C=s.useRef(),{addToast:w}=c(),[P,A]=e.useState(!0),[L,z]=e.useState([]),[O,T]=e.useState(1),[J,M]=e.useState(0),[R,F]=e.useState(!1),[G,I]=e.useState(!1),[V,E]=e.useState(null),[K,Q]=e.useState(null);s.useCallback((function(s){Q(s)}),[]),s.useCallback((function(s){Q(null)}),[]);const W=async s=>{const e=await C.current.executeAsync();A(!0),axios.post("/sec/sessions/logout",{session_id:s,recaptcha_ref:e}).then((s=>w(s.data.message))).catch((s=>{var e,a;const i=(null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.error)||("network error"===s.message?"Server is offline or restarting please wait":s.message);w(i)})).finally((()=>X()))},X=async s=>{axios.post("/sec/sessions",{page:s}).then((s=>{z(s.data.data),M(s.data.totalPages)})).catch((s=>{var e,a;const i=(null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.error)||("network error"===s.message?"Server is offline or restarting please wait":s.message);w(i)})).finally((()=>A(!1)))};return e.useEffect((()=>{X(O)}),[O]),P?a.jsx("div",{className:"loading-overlay",children:a.jsx(u,{color:"primary",variant:"grow"})}):a.jsxs("div",{children:[a.jsxs(x,{xs:{cols:1},sm:{cols:2},children:[a.jsxs(h,{className:"mb-3",children:[a.jsx("h4",{children:"This device"}),a.jsx(g,{children:a.jsxs(v,{children:[a.jsxs("div",{className:"d-flex justify-content-between",children:[a.jsx("p",{className:"display-3",children:"::1"===L.current_session.ip_address||"::ffff:127.0.0.1"===L.current_session.ip_address?"localhost":L.current_session.ip_address}),a.jsx("span",{onClick:s=>{E(L.current_session),I(!0)},children:a.jsx(l,{icon:o,size:"xl"})})]}),a.jsx("span",{className:"lead",children:L.current_session.user_agent})]})})]}),a.jsxs(h,{className:"mb-3",children:[a.jsx("h4",{children:"Logout other sessions"}),a.jsx(g,{children:a.jsxs(v,{children:[a.jsx("p",{children:"Clearing all device sessions will log you out from all devices and browsers, except for the one you're currently using."}),a.jsx(f,{type:"submit",color:"danger",className:"mt-4 d-block me-2 rounded",disabled:L.logout,onClick:s=>F(!0),children:"Logout other sessions"})]})})]})]}),L.sessions.map(((s,e)=>a.jsxs("div",{children:[a.jsx(g,{className:"mb-3",children:a.jsxs(v,{children:[a.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[a.jsx("h3",{className:(s.active?"text-primary":"")+" text-truncate",children:s.user_agent}),a.jsxs("div",{className:"text-right d-flex justify-content-end",children:[a.jsx("span",{className:"me-4",onClick:e=>{E(s),I(!0)},children:a.jsx(l,{icon:o,size:"xl"})}),a.jsx(f,{color:"danger",className:"ms-auto",onClick:e=>W(s._id),children:"Logout"})]})]}),a.jsxs("div",{className:"d-block d-sm-flex",children:[a.jsxs("div",{className:"me-3 mb-2",children:[a.jsx("span",{className:"text-muted",children:"Last accessed"}),a.jsxs("span",{className:"d-block small",children:[s.last_accessed?p(s.last_accessed):"Never"," ","| ",s.active?"Verified":"Not verified"]})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-muted",children:"IP Address"}),a.jsx("span",{className:"d-block small text-capitalize",children:"::1"===s.ip_address?"localhost":s.ip_address})]})]})]})}),J>1&&a.jsx(j,{currentPage:O,setCurrentPage:T,totalPages:J,setTotalPages:M})]},e))),a.jsxs(b,{alignment:"center",scrollable:!0,visible:R,onClose:()=>F(!1),"aria-labelledby":"M",children:[a.jsx(y,{children:a.jsx(N,{children:"Confirm Logout?"})}),a.jsx(_,{children:"Are you sure you want to logout all sessions? This action cannot be undone."}),a.jsxs(k,{className:"d-flex justify-content-end",children:[a.jsx(f,{color:"secondary",onClick:s=>W(null),children:"Okay"}),a.jsx(f,{color:"primary",onClick:()=>{F(!1)},className:"ms-2",children:"Cancel"})]})]}),a.jsxs(b,{alignment:"center",scrollable:!0,visible:G,onClose:()=>I(!1),"aria-labelledby":"M",children:[a.jsx(y,{children:a.jsx(N,{children:null==V?void 0:V.user_agent})}),a.jsxs(_,{children:["Last Accessed: ",null==V?void 0:V.last_accessed," IP Address:"," ",null==V?void 0:V.ip_address," Verified: ",(null==V?void 0:V.active)?"Yes":"No",S&&a.jsxs(a.Fragment,{children:[a.jsx(r,{mapContainerStyle:{height:"400px",width:"400px"},center:{lat:(null==V?void 0:V.location)?JSON.parse(null==V?void 0:V.location)[0].latitude:0,lng:(null==V?void 0:V.location)?JSON.parse(null==V?void 0:V.location)[0].longitude:0},zoom:18,children:a.jsx(n,{position:{lat:(null==V?void 0:V.location)?JSON.parse(null==V?void 0:V.location)[0].latitude:0,lng:(null==V?void 0:V.location)?JSON.parse(null==V?void 0:V.location)[0].longitude:0}})}),a.jsx("p",{className:"text-muted mt-2",children:"Note: GPS accuracy may vary significantly on desktop or laptop devices compared to mobile phones."})]})]})]}),a.jsx(i,{ref:C,size:"invisible",sitekey:d})]})};export{S as default};
