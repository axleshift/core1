import{j as e,r as s,R as i}from"./B29SdWEC.js";import{d as t}from"./OsFsip44.js";import{o as r,q as o,a,b as d,c as l}from"./CvTj7SuE.js";import{a as n}from"./B-XuIoVH.js";import{p as c}from"./2aPQtUzY.js";import{P as m}from"./E8MUDNEF.js";import{F as p,P as h,Q as x,C as u,k as j}from"./B8Q0R7Pu.js";import{P as f,B as g,I as y,F as v,O as b}from"./UzOIWMBD.js";import{c as w,Q as R}from"./C9HbIWyp.js";import"./ucIcx5RQ.js";import"./BQRwqC_R.js";import"./CFK1l90-.js";import"./BIw_sdFo.js";import"./BFKNndIN.js";import"./CIdotNGq.js";import"./yJGO6Amu.js";import"./BjhGVRpM.js";import"./BFk34ZWe.js";import"./BmTZu7tj.js";import"./CxXfFpkk.js";import"./DPENoFOj.js";import"./Ba2eFa9Y.js";import"./B1ETHe3Q.js";import"./CjjZDEdp.js";import"./K-dupnmX.js";import"./CLdVYh6z.js";import"./DPAjA2jz.js";import"./OBe_9qlD.js";import"./BXEMiIsG.js";import"./Bb7MnDjl.js";import"./CA9thugF.js";import"./BPjVUy-D.js";import"./C_n0TLp5.js";import"./DYPlXUME.js";import"./BqHrj3jM.js";import"./DmCNZUD0.js";import"./COJYqVAh.js";import"./B8aVJnds.js";import"./_On2gxB8.js";import"./BgKg063h.js";import"./DoBxDInM.js";import"./CrRThSud.js";import"./DYPupapv.js";import"./DUOVp0nK.js";const N=({threadsID:s,selectedUser:i,handleSelectUser:t,isMobile:r})=>e.jsx("div",{style:{width:r?"100%":"30%",overflowY:"auto",borderTopLeftRadius:"12px",borderBottomLeftRadius:r?"0":"12px",borderTopRightRadius:r?"12px":"0",height:r?"100%":"auto"},children:s.map((s=>e.jsxs("div",{onClick:()=>t(s),className:`${(null==i?void 0:i.id)===s.id&&"bg-body-secondary fw-bold"} d-flex align-items-center px-3 py-2 border-bottom`,style:{cursor:"pointer",transition:"all 0.2s ease"},children:[e.jsx("div",{className:"bg-primary fw-bold rounded-pill me-3 d-flex justify-content-center align-items-center text-white",style:{width:"36px",height:"36px"},children:s.id.slice(0,1).toUpperCase()}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("div",{className:"fw-bold",style:{fontSize:"14px"},children:s.id.slice(0,6).toUpperCase()}),e.jsx("div",{style:{fontSize:"11px"},className:"text-muted",children:c(s.timestamp)})]})]},s.id)))});N.propTypes={threadsID:m.arrayOf(m.shape({id:m.string.isRequired,timestamp:m.oneOfType([m.string,m.number]).isRequired})).isRequired,selectedUser:m.shape({id:m.string}),handleSelectUser:m.func.isRequired,isMobile:m.bool.isRequired};const k=({messagesRef:t,selectedUser:l,handleBackToList:m,isMobile:w,showBackButton:R})=>{const[N,k]=s.useState([]),[S,B]=s.useState(""),[I,C]=s.useState(!1),q=i.useRef(null),{user:z}=n();s.useEffect((()=>{if(!l)return;const e=r(o(t,a("timestamp")),(e=>{const s=e.docs.map((e=>({id:e.id,...e.data()}))).filter((e=>e.sender_id===l.id));k(s)}));return()=>e()}),[l]),s.useEffect((()=>{q.current&&q.current.scrollIntoView({behavior:"smooth"})}),[N,l]);const U=e.jsxs(f,{id:"popover-basic",style:{maxWidth:"300px"},children:[e.jsx(f.Header,{as:"h3",children:"Quick Messages"}),e.jsx(f.Body,{children:e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto"},children:["When will my shipment be dispatched?","What documents are required for customs clearance?","Can you confirm the estimated arrival date of my freight?","How can I update the delivery address or contact details?","Are there any special handling instructions I should be aware of?","How do I schedule a pickup for my next shipment?","What are the charges for expedited shipping?","Can I track my shipment in real-time?","What should I do if my shipment is delayed?","Are there any restrictions on the type of goods I can ship?","How do I file a claim for a damaged shipment?","What are the weight and size limits for freight shipments?","Can I request a specific delivery time for my shipment?","What payment methods do you accept for freight services?","How do I cancel or reschedule a shipment?"].map(((s,i)=>e.jsx("div",{className:"p-2 mb-1 border-bottom",style:{cursor:"pointer"},onClick:()=>(B(s),void C(!1)),children:s},i)))})})]}),T=e=>e.role===z.role;return e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",borderTopRightRadius:w?"0":"12px",borderBottomRightRadius:w?"0":"12px",borderBottomLeftRadius:w?"12px":"0",height:w?"100%":"auto"},children:l?e.jsxs("div",{className:"d-flex flex-column justify-content-between h-100",children:[e.jsxs("div",{className:"d-flex align-items-center p-2 bg-body-secondary rounded-top",children:[R&&e.jsx(g,{variant:"link",onClick:m,children:e.jsx(p,{icon:h})}),e.jsx("div",{className:"bg-primary fw-bold rounded-pill me-2 d-flex justify-content-center align-items-center text-white",style:{width:"40px",height:"40px"},children:l.id.slice(0,1).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h4",{style:{margin:0,fontSize:w?"16px":"18px"},children:l.id.slice(0,6).toUpperCase()}),e.jsx("div",{className:"text-muted",style:{fontSize:"13px"},children:l.id})]})]}),e.jsxs("div",{className:"flex-grow-1 border-start border-end p-3",style:{overflowY:"auto"},children:[N.map(((s,i)=>e.jsxs("div",{style:{textAlign:T(s)?"right":"left",marginBottom:"12px"},children:[e.jsx("div",{className:(T(s)?"bg-primary":"bg-body-secondary")+" text-white rounded p-2",style:{display:"inline-block",maxWidth:w?"85%":"80%",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",position:"relative",wordBreak:"break-word"},children:e.jsx("div",{style:{fontSize:w?"13px":"14px"},children:s.message})}),e.jsx("div",{style:{fontSize:"11px",color:"gray",marginTop:"4px",textAlign:T(s)?"right":"left",paddingLeft:T(s)?"0":"12px",paddingRight:T(s)?"12px":"0"},children:c(s.timestamp)})]},i))),e.jsx("div",{ref:q})]}),e.jsx("div",{className:"mt-2",children:e.jsxs(y,{className:"mt-2",children:[e.jsx(v,{as:"textarea",placeholder:"Type message...",value:S,className:"border-primary border-2",onChange:e=>B(e.target.value),style:{padding:"10px",resize:"none",minHeight:"45px",maxHeight:"45px",overflowY:"auto",fontSize:"12px"}}),e.jsx(b,{trigger:"click",placement:"top",overlay:U,rootClose:!0,children:e.jsx(g,{style:{height:"45px"},children:e.jsx(p,{icon:x})})}),e.jsx(g,{style:{height:"45px"},onClick:async()=>{""!==S.trim()&&l&&(await d(t,{message:S,role:z.role,timestamp:Date.now(),sender_id:l.id}),B(""))},children:e.jsx(p,{icon:u})})]})})]}):e.jsxs("div",{className:"d-flex justify-content-center align-items-center h-100 flex-column",children:[e.jsx("div",{className:"bg-primary rounded-pill d-flex justify-content-center align-items-center mb-3",style:{width:"70px",height:"70px"},children:e.jsx(p,{icon:j,size:"2x"})}),e.jsx("p",{children:"Select a user to view conversation"})]})})};k.propTypes={messagesRef:m.object.isRequired,selectedUser:m.shape({id:m.string.isRequired}),handleBackToList:m.func.isRequired,isMobile:m.bool.isRequired,showBackButton:m.bool.isRequired};const S=()=>{const[i,d]=s.useState(!0),[c,m]=s.useState(null),[p,h]=s.useState(!1),[x,u]=s.useState(!0),[j,f]=s.useState([]),{user:g}=n(),y=l(t,"messages");s.useEffect((()=>{if(!g._id)return;const e=r(o(y,a("timestamp")),(e=>{const s=new Map;let i=[];e.docs.forEach((e=>{const t={id:e.id,...e.data()};i.includes(t.ref)||(s.set(t.ref,t),i.push(t.ref))}));const t=Array.from(s.values());f(t),d(!1)})),s=()=>{h(window.innerWidth<768)};return s(),window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s),e()}}),[g]);return i?e.jsx("div",{className:"loading-overlay",children:e.jsx(w,{color:"primary",variant:"grow"})}):y?e.jsx("div",{className:"mb-3",children:e.jsx(R,{children:e.jsxs("div",{className:"d-flex",style:{height:p?"calc(100vh - 180px)":"75vh",flexDirection:p?"column":"row"},children:["user"!==(null==g?void 0:g.role)&&(!p||p&&x)&&e.jsx(N,{threadsID:j,selectedUser:c,handleSelectUser:e=>{m(e),p&&u(!1)},isMobile:p}),("user"===(null==g?void 0:g.role)||!p||p&&!x)&&e.jsx(k,{messagesRef:y,selectedUser:c||("user"===g.role?g:null),handleBackToList:()=>{p&&u(!0)},isMobile:p,showBackButton:p&&"user"!==(null==g?void 0:g.role)})]})})}):e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"70vh"},children:e.jsx("p",{children:"No messages yet"})})};export{S as default};
