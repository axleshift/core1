import{R as s,r as e,j as r}from"./CbKKHx2O.js";import{F as a,B as t,J as o,K as i,L as p}from"./tiPrGhv9.js";import{R as d}from"./DfG9QjQz.js";import{a as l,e as n}from"./CbqEVASn.js";import{d as c,b as j,c as m,Q as x,R as w,S as h,T as u,X as g,Y as v,U as f,a as b}from"./C-SwLysj.js";import"./D9QqU1Un.js";import"./z-cSZRUs.js";import"./vr9ZyHRf.js";import"./DylAs1sT.js";import"./yJGO6Amu.js";import"./BIw_sdFo.js";import"./CXjkhZnE.js";import"./BKrKJ3DW.js";import"./BFk34ZWe.js";import"./U6rf_yqH.js";import"./D68gzNyG.js";import"./6thM_Rat.js";import"./BsZLDNo0.js";import"./CAJYX4M0.js";import"./Bhaa8ZPc.js";import"./K-dupnmX.js";import"./B7alYAEp.js";import"./DP3P1EsK.js";import"./C3hrCPXF.js";import"./Dw0KO6EP.js";import"./CzGuHLZU.js";import"./B8Let_61.js";import"./CPqRiR-E.js";import"./fZjk1EK6.js";import"./BXEMiIsG.js";import"./Bb7MnDjl.js";import"./CA9thugF.js";import"./BPjVUy-D.js";import"./CTpwok2W.js";import"./DYPlXUME.js";import"./BqHrj3jM.js";const S=()=>{const{user:S}=l(),y=s.useRef(),[C,N]=e.useState(!1),[k,_]=e.useState({password:"",new_password:"",repeat_password:""}),[A,R]=e.useState(!1),[z,q]=e.useState(!1),[K,O]=e.useState({error:!1,message:""}),P=s=>{const{id:e,value:r}=s.target;_((s=>({...s,[e]:r})))},H=[{id:1,text:"At least 8 characters",test:s=>s.length>=8},{id:2,text:"At least one uppercase letter",test:s=>/[A-Z]/.test(s)},{id:3,text:"At least one lowercase letter",test:s=>/[a-z]/.test(s)},{id:4,text:"At least one number",test:s=>/[0-9]/.test(s)},{id:5,text:"At least one special character",test:s=>/[!@#$%^&*(),.?":{}|<>]/.test(s)}],T=s=>H.map((e=>({...e,passed:e.test(s)}))),[X,B]=e.useState(T(k.new_password));return r.jsxs("div",{children:[C&&r.jsx("div",{className:"loading-overlay",children:r.jsx(c,{color:"primary",variant:"grow"})}),r.jsx(d,{ref:y,size:"invisible",sitekey:n}),r.jsxs(j,{xs:{cols:1},sm:{cols:2},children:[r.jsxs(m,{children:[r.jsxs("h4",{children:["OK"===S.password?"Change":"Set"," Password"]}),r.jsx(x,{className:"mb-3",children:r.jsxs(w,{children:[K.error&&r.jsxs(h,{color:"danger",className:"d-flex align-items-center",children:[r.jsx(a,{className:"flex-shrink-0 me-2",icon:t,size:"xl"}),r.jsx("div",{children:K.message})]}),r.jsxs(u,{onSubmit:async s=>{s&&s.preventDefault();const e=await y.current.executeAsync();N(!0),axios.post("/auth/password",{...k,recaptcha_ref:e}).then((s=>{if(s.data.error)return O({error:!0,message:s.data.error});window.location.reload()})).catch((s=>{var e,r;const a=(null==(r=null==(e=s.response)?void 0:e.data)?void 0:r.error)||("network error"===s.message?"Server is offline or restarting please wait":s.message);O({error:!0,message:a})})).finally((()=>N(!1)))},children:["OK"===S.password&&r.jsxs(g,{className:"mb-3",children:[r.jsx(v,{children:r.jsx(a,{icon:o})}),r.jsx(f,{id:"password",type:A?"text":"password",placeholder:"Password",autoComplete:"current-password",value:k.password,onChange:s=>P(s),required:!0}),r.jsx(v,{children:r.jsx("span",{onClick:s=>R(!A),"aria-label":A?"Hide password":"Show password",children:r.jsx(a,{icon:A?i:p,onClick:s=>R(!A)})})})]}),r.jsxs(g,{className:"mb-3",children:[r.jsx(v,{children:r.jsx(a,{icon:o})}),r.jsx(f,{id:"new_password",type:z?"text":"password",placeholder:"New Password",autoComplete:"new-password",value:k.new_password,onChange:s=>(s=>{P(s),"new_password"===s.target.id&&B(T(s.target.value))})(s),required:!0}),r.jsx(v,{children:r.jsx("span",{onClick:s=>q(!z),"aria-label":z?"Hide password":"Show password",children:r.jsx(a,{icon:z?i:p,onClick:s=>q(!z)})})})]}),k.new_password.length>0&&r.jsx("ul",{children:X.map((s=>r.jsx("li",{className:"text-"+(s.passed?"success":"danger"),children:s.text},s.id)))}),r.jsxs(g,{className:"mb-3",children:[r.jsx(v,{children:r.jsx(a,{icon:o})}),r.jsx(f,{id:"repeat_password",type:"password",placeholder:"Repeat password",autoComplete:"new-password",value:k.repeat_password,onChange:s=>P(s),required:!0})]}),r.jsx(b,{type:"submit",color:"primary",className:"d-block me-2 rounded",children:"Save changes"})]})]})})]}),r.jsx(m,{})]})]})};export{S as default};
