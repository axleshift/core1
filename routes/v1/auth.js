const H=f;(function(p,q){const Q={p:0xfd,q:'A91C',r:0xa6,s:'VYzQ',t:0xec,u:'wrJS',v:0xe4,w:'KJZX',x:'Z#jS'},B=f,r=p();while(!![]){try{const s=parseInt(B(0xd0,'4)@*'))/0x1*(parseInt(B(Q.p,Q.q))/0x2)+parseInt(B(0xd5,'4nj8'))/0x3+parseInt(B(Q.r,'JxeO'))/0x4*(parseInt(B(0x8a,'JxeO'))/0x5)+-parseInt(B(0x9f,'RM]i'))/0x6*(-parseInt(B(0x10d,Q.s))/0x7)+-parseInt(B(Q.t,'pZ!U'))/0x8*(parseInt(B(0xc2,Q.u))/0x9)+-parseInt(B(Q.v,Q.w))/0xa*(parseInt(B(0xf4,Q.x))/0xb)+parseInt(B(0xb4,'unxE'))/0xc;if(s===q)break;else r['push'](r['shift']());}catch(t){r['push'](r['shift']());}}}(e,0xc9e89));const d=(function(){let p=!![];return function(q,r){const R={p:'r1af'},s=p?function(){const C=f;if(r){const t=r[C(0x92,R.p)](q,arguments);return r=null,t;}}:function(){};return p=![],s;};}());(function(){const a0={p:0xd1,q:'pGv$',r:'@!47',s:'FmXb',t:0xe5,u:'YUV7'},Z={p:'j06f',q:0xca,r:0xc1,s:'FmXb'},D=f,p={'jckCi':D(a0.p,'FmXb'),'XrnqL':D(0xce,a0.q),'jlhkV':function(q,r){return q(r);},'LjrRX':D(0xc7,a0.r),'NkxYT':function(q,r){return q+r;},'RgJns':D(0xa5,a0.s),'bCsdJ':'input','jyZqQ':function(q){return q();},'WLWUE':function(q,r,s){return q(r,s);}};p[D(a0.t,a0.u)](d,this,function(){const E=D,q=new RegExp(p[E(0xbf,'Z#jS')]),r=new RegExp(p[E(0xc9,Z.p)],'i'),s=p['jlhkV'](c,p[E(0x77,'&jDd')]);!q[E(0xaa,'&jDd')](p[E(0x111,'[Pe7')](s,p[E(0xf1,'RM]i')]))||!r[E(Z.q,'Y#dS')](s+p[E(Z.r,Z.s)])?s('0'):p['jyZqQ'](c);})();}());const b=(function(){const a1={p:'Q&J7'};let p=!![];return function(q,r){const s=p?function(){const F=f;if(r){const t=r[F(0xe8,a1.p)](q,arguments);return r=null,t;}}:function(){};return p=![],s;};}()),a=b(this,function(){const a8={p:'hSvI',q:'#FeE',r:0xbd,s:0xa7,t:'9I^5',u:0xed,v:'EhPP',w:0xf0,x:'j06f',y:0xde,z:'wrJS',A:0x9d,a9:'qT[T',aa:0x116,ab:0xf6,ac:0xb8,ad:'hSvI',ae:0x113,af:0x117,ag:'D(7b',ah:0xa1,ai:0x9e},G=f,p={'nPnwn':function(t,u){return t(u);},'VINzr':G(0xa9,a8.p),'ZwiBP':G(0x99,'LO1y'),'lQbvA':function(t){return t();},'dxeIu':G(0x107,'unxE'),'ogdIV':G(0xfa,'HmF]'),'Ysvtx':G(0xac,'g6TE'),'nhhXc':G(0xcb,a8.q),'yXxEC':G(0xdc,'T]ER'),'IRteh':function(t,u){return t<u;}};let q;try{const t=p[G(a8.r,'unxE')](Function,p[G(a8.s,a8.t)]+p['ZwiBP']+');');q=p[G(0xd6,'HmF]')](t);}catch(u){q=window;}const r=q['console']=q['console']||{},s=[p[G(0x110,'9I^5')],p[G(0xe6,'XoCg')],p[G(a8.u,a8.v)],p[G(a8.w,a8.x)],'exception',G(a8.y,a8.z),p[G(a8.A,a8.a9)]];for(let v=0x0;p[G(a8.aa,'vU#O')](v,s[G(a8.ab,'KJZX')]);v++){const w=b['constructor'][G(a8.ac,a8.ad)]['bind'](b),x=s[v],y=r[x]||w;w[G(a8.ae,'#FeE')]=b[G(a8.af,a8.ag)](b),w['toString']=y[G(a8.ah,'am(v')][G(a8.ai,'86ji')](y),r[x]=w;}});a();import g from'dotenv';g[H(0xd2,'d3Wt')]();function f(a,b){const c=e();return f=function(d,g){d=d-0x76;let h=c[d];if(f['fOlxGq']===undefined){var i=function(n){const o='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let p='',q='';for(let r=0x0,s,t,u=0x0;t=n['charAt'](u++);~t&&(s=r%0x4?s*0x40+t:t,r++%0x4)?p+=String['fromCharCode'](0xff&s>>(-0x2*r&0x6)):0x0){t=o['indexOf'](t);}for(let v=0x0,w=p['length'];v<w;v++){q+='%'+('00'+p['charCodeAt'](v)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(q);};const m=function(n,o){let p=[],q=0x0,r,t='';n=i(n);let u;for(u=0x0;u<0x100;u++){p[u]=u;}for(u=0x0;u<0x100;u++){q=(q+p[u]+o['charCodeAt'](u%o['length']))%0x100,r=p[u],p[u]=p[q],p[q]=r;}u=0x0,q=0x0;for(let v=0x0;v<n['length'];v++){u=(u+0x1)%0x100,q=(q+p[u])%0x100,r=p[u],p[u]=p[q],p[q]=r,t+=String['fromCharCode'](n['charCodeAt'](v)^p[(p[u]+p[q])%0x100]);}return t;};f['pFGEQv']=m,a=arguments,f['fOlxGq']=!![];}const j=c[0x0],k=d+j,l=a[k];return!l?(f['QaacIe']===undefined&&(f['QaacIe']=!![]),h=f['pFGEQv'](h,g),a[k]=h):h=l,h;},f(a,b);}import h from'express';import i from'bcryptjs';import j from'crypto';import k from'../../models/db.js';import l from'../../src/logger.js';function e(){const aB=['D2bwrv0','jmk+W6P8kW','W4O/wCk1WPZdKa/cRq','bSkQu8keBCoq','puJcLfe','W6PjWOX9W7WUW41updBdJmksW6hdKNG','CMxcRXpcPSozce3dGmkJ','wLuFW7tdNq','CCodW74lAa','W6zXW6fNpa','W7CTWQJcLLZdSCorau/dLW','Fc01fstdOSkM','WOZcQIi','FrhcQJ3cJIJdKa','W6xdOW0goa','sSkbW5FcJSofWP3dOMSqWO8','zhOCW7pdLc9GWPawW55V','W5pdVWa1','W5JdJvFcSSkXW5RdI8kw','WPvQCG','WQquwr9A','kv/cGMZdUG','w8ootmovkG','fmk0W7HWeH8','n8k1WReVW5FdTCoFgLW','W5ldJdBdTSobW5ldGCkYv8k5WP0','W43cONSE','o8ocl2dcPa','W7hcOuLy','nIKIcd8','hZeInru','W5ugW4BdRtq','CmoxrSoJda','DxamW4m','WQf4W7RdLa','WRFcNSk1W53cTa','W6ZcJmongSk1','WP5gW4RdKL4','WQFcUCo4W4jLBW','W5rqW7hcN0ddLHxcLSkghq','e8kvWOpdVW','W4ddLfNdLHu3kr/cKG8','gmkwWPZdVCkH','EH3cGaJcGa','BamHA8kiWP8zW7OPyCoSWPJcI8kEhW','xmkve8oDW4q','E8krW6tcTmke','g8k7iSkYtCky','C3TgseC','W7/dHfX5sSoueCk8WQtcQGRcMN8','W4LGW53cUZ7dQa','WQhdOryDzCkrm2VdTr/cTmoGq8o0W7HtWQqit8oEhCobyeG1FSoetXHtrSku','WRZcS8o6W41LACoT','rmoNamockCkvW5WAWRRdRstdHq','pLpcLuZdOqq','WQlcKWeTd8ko','WPKMW6fgW6lcGq','W4CBW6FdHc8','tvtcMGC','WOpcTtnSW5q','EbFcQIRcTttdGmorWPRcUcq','sCkkoCo+W5VdPq','aCoKoNhcQCkag8olxmkwlW','W7hcQv0iaG','B8otWRebA8o+WRD5W6bTW4NcQfxcH8kAb8kpW5pcQCoQyquItmolxmkppSkgWQ7dOva','we/cPI0','dmkvWONdO8kR','i0T3W7uOkdjLsgG','W5CnW4ZdPZe','W78jfSoX','WRvGW6hcQCorzcPeWOddM8o/sa','gmkGmmkY','WOddGCkRW7S8xmoaW7m','W7y8WQFdRSkspfabWQ/dT8oCrCkBcSo5hmkzW5ng','sSkMAdxdUSkbfSo3A8k8aW','WQFcOSo6W511Aa','WRNdTfKxza','W7RcGa47gmk2sa','g27cQv/dVq','WQNdQfKkF8km','smkBlmo/W5ZdUfJcQCogBrrvW4hdHmojW4jcW4pdQW','jZ4JeW','jCokjuhcRW','FNeoW5u','uvpcPZddQZi2WRNcLmo6dq','W5LWW63cI1e','g8kEWQaPW43dSG','lCkhWQa0W5tcOCozispcImoMW6G2WRtcNY5YgSo/W4hdL8knfW','huBcLfBdUaXWWORcGgpcPmonWONdIcNcVmovzL7cQmo3fSoXWODYF2y+WOZcRhS7W47dL37cRmk8','D8opW7mo','W70+B8ojyCkc','W5hdShu9WOPBEXhcNNHlWPGFWOO','WQ7cJhSGW5T+aMK','W6dcVeziW483','W6a8WRhdRG','sSkmn8o+W4hdOGhdSCof','W4uoWORdJSkh','CreXWRq3aWvOC24','WOZdL1RdNr8Hkq','B8oRqSkAWRK','WO7cLsT5W5C','amkQiSkIxCkzWQ8','WQjAeSoRWRe','nc8fmGO','WRJdN0SAqa','W7iVWQRcN3BdK8otfLZdJW','b8ogW6dcJmkSWPddHLG','WPpcNgVcPG','hmkuWP7dVSkQ','WOxcTZDHW4S','W5tcO2eE','B1tcNaC/EG','W6pcUSokaCk9','BX3cTY0','dCkyWRmYW4O','WP7dNCkxW6e','vfNcLtZcUG','W6SuW4hdMaxcN0NdGmotkfy6vCoYW74QzHy6WPJcTmkDcmkiF8oQv3BcOvddPb3cUSoa','aSk8lmkO','WQZdMmoYWORcRuOZC8ozhW','WRZdQvyDFSkwl3hcP0dcI8k8dmkSWOXy','W7RdK0yLW55X','W4jMW5jhehG','deDNW4CZ','W4TZWQewWR/dMmoJWQJcJmoOW73cTqq','pmoOiKxcNq','WRddTvqyqG','W69negu8WPtcMWBcLmotr8obca','W6HsWObJW6O','aCkHmmkJsSkFWPmPWPu','W50WW5RdHG','fCk2W71YaW','D8obW7erCmoIWRfUW6z3W5G','WRj+W73dILq','AmoWECkHWQO','W6RdMuyN','WRTngmoCWQ3dKW','zSolW7inCmo1WOvPW7zQW4/cR0K','D2pcRrVcJmougq','WPFcVLj3hCktW7VdICoNoG','WOKZDani','kKvHW48k','DgFcOHBcRW','cCk/m8kQqq','W7qJW4pdHsi','oSkRb8opWOFcU8opnaRdRW','W6dcRuLy','s8otW5/cPCoSfSoqD8oyW4CV','shNcTqVcUW','FCoZu8oeW7xdLW','W6fZW4baeMrFxY5OW4pcJ8kWa8k1WOdcMSonW4VdSNe7ma','W5xcOmomkmks','W5y+WPNdTCkt','WQ4quci','W7OhhCoN','W7apsSkyW67dRNXRgN3dPq','W65vWOrLW6X9','W4RdQqSGbmkd','F37cUsZcKW','W6ZdGbq+ja','W7tdMgFdRIK','j8oymL0'];e=function(){return aB;};return e();}(function(){const ab={p:0x8c,q:0xdf,r:'s7Kk',s:'RM]i',t:0xcd,u:'EhPP'},I=H,p={'fkKWj':function(r,s){return r+s;},'hgmJS':I(ab.p,'FmXb'),'ESVCy':function(r){return r();}};let q;try{const r=Function(p[I(ab.q,ab.r)](p[I(0x86,'hSvI')](I(0xa2,ab.s),p['hgmJS']),');'));q=p[I(ab.t,ab.u)](r);}catch(s){q=window;}q[I(0x10b,'g6TE')](c,0x9c4);}());import{addSession,addUserProfileToSession,removeSession}from'../../src/sessions.js';import m from'../../middleware/auth.js';import n from'../../middleware/recaptcha.js';import o,{generateUniqueId}from'../../src/password.js';const router=h[H(0xc8,'wX&e')]();router[H(0x93,'wX&e')]('/register',async(p,q)=>{const af={p:0xb1,q:'9I^5',r:'JXrB',s:0x9b,t:0x88,u:'Q&J7',v:0x7e,w:0x9a,x:0xae,y:'pGv$',z:0x80,A:0xe9,ag:0x108,ah:'Y#dS',ai:'D(7b',aj:0x10c,ak:'KJZX',al:0x78,am:0x96,an:'hSvI',ao:0xe0,ap:'d3Wt'},J=H,r={'XYUto':function(s,t){return s<t;},'DAGmg':J(af.p,af.q),'hSMwA':function(s,t){return s!=t;},'nOpxt':J(0xef,af.r),'RHTmt':J(af.s,'pZ!U'),'smQEb':function(s,t){return s(t);}};try{const {email:s,first_name:t,last_name:u,password:v,repeat_password:w}=p['body'];if(!s||!t||!u||!v||!w)return q[J(0xd3,'JXrB')](0x190)['send']();if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/['test'](s))return q[J(af.t,af.u)](0xc8)[J(0x81,'pZ!U')]({'error':'Invalid\x20email\x20address'});if(r[J(af.v,'wrJS')](v[J(0x90,'JxeO')],0x8))return q['status'](0xc8)[J(af.w,'dwsf')]({'error':r['DAGmg']});if(r['hSMwA'](v,w))return q[J(0xaf,'#FeE')](0xc8)[J(0xcf,af.u)]({'error':r[J(af.x,af.y)]});const x=await k(),y=x[J(af.z,'pGv$')](r[J(af.A,'r1af')]),z=await y[J(af.ag,af.ah)]({'email':s});if(z)return l[J(0xc6,'unxE')](J(0xb0,'#FeE')),q[J(0xb6,'D(7b')](0x199)[J(0xeb,af.ai)]();return await y[J(0xda,af.u)]({'email':s,'first_name':t,'last_name':u,'role':J(af.aj,af.ak),'password':r[J(af.al,'r1af')](o,v),'email_verify_at':'','created_at':new Date(),'update_at':new Date()}),q[J(af.am,af.an)](0xc9)[J(af.ao,af.ap)]();}catch(A){l[J(0x76,'&jDd')](A);}return q['status'](0x1f4)[J(0xdb,'qT[T')]();}),router[H(0xa0,'Q&J7')](H(0x8b,'cMIg'),n,async(p,q)=>{const al={p:0xd9,q:0xee,r:0x85,s:'ih[H',t:'SIL1',u:0x7a,v:0xdb,w:'qT[T',x:0x89,y:0x82,z:']LXY',A:0xfe,am:'iCRI',an:0x87,ao:0x10f,ap:0xe1,aq:0x112,ar:'T]ER',as:'Q&J7',at:0x109,au:'KJZX',av:'vrd4',aw:0x102,ax:'g6TE',ay:0x8d,az:0xf7,aA:'EhPP',aB:0xa8,aC:'pZ!U',aD:0xb3},K=H,r={'WDijD':function(s,t){return s||t;},'KWZEY':function(s){return s();},'OLJHC':K(al.p,'EE0%'),'DcVHl':function(s,t){return s!=t;},'zkzIW':function(s,t){return s(t);},'vAGsW':K(al.q,'s7Kk'),'CohAH':K(al.r,al.s),'MJwNg':function(s,t,u,v,w){return s(t,u,v,w);},'ntzSP':K(0x10a,al.t)};try{const {email:s,password:t}=p[K(al.u,'g6TE')];if(r[K(0x7d,'j06f')](!s,!t))return q['status'](0x190)[K(al.v,al.w)]();const u=await r[K(al.x,']LXY')](k),v=u[K(al.y,'ynX%')](r[K(0xfb,al.z)]),w=await v['findOne']({'email':s});if(!w)return q[K(al.A,al.am)](0x194)['send']();if(r[K(al.an,'SIL1')](r[K(al.ao,'YUV7')](o,t),w['password']))return q[K(al.ap,'Z#jS')](0x191)[K(0xc4,'VYzQ')]();addUserProfileToSession(w);const x=j['createHash'](r['vAGsW'])[K(al.aq,al.ar)](generateUniqueId())['digest'](K(0x10e,'A91C')),y=p[K(0xbe,al.as)][r[K(al.at,al.au)]]||p[K(0x7f,al.av)][K(0xe2,'LO1y')];return r[K(al.aw,al.ax)](addSession,w,x,y,p[K(al.ay,'vrd4')][r[K(al.az,al.aA)]]),q[K(al.aB,'FmXb')](0xc8)['json']({'token':x});}catch(z){l[K(0xc5,al.aC)](z);}return q[K(al.aD,'gehD')](0x1f4)['send']();}),router[H(0xf2,'YUV7')](H(0x106,'&jDd'),m,function(p,q,r){const am={p:'am(v',q:0xe7},L=H;return q[L(0xa4,'vrd4')](0xc8)[L(0xcc,am.p)]({'email':p[L(am.q,'EhPP')]});}),router[H(0x115,'@!47')](H(0x7c,'4)@*'),m,async function(p,q,r){const ao={p:0xab,q:'HmF]',r:0x101,s:'EhPP',t:0xf8,u:'LO1y',v:0x9c,w:'EE0%'},M=H,s={'pEoJj':function(t){return t();},'JLqyT':M(ao.p,ao.q)};try{const t=await s['pEoJj'](k),u=t[M(ao.r,ao.s)](s[M(ao.t,'KJZX')]),v=await u[M(0xe3,'EhPP')]({'email':p['email']});return q['status'](0xc8)['json']({'user':{'email':v[M(0x103,ao.u)],'first_name':v[M(ao.v,'XoCg')],'last_name':v['last_name']}});}catch(w){l[M(0x79,'[Pe7')](w);}return q[M(0xf5,ao.w)](0x1f4)['send']();}),router[H(0xff,'9I^5')](H(0xbb,'ynX%'),m,function(p,q,r){const aq={p:0x98,q:'@!47'},N=H,s={'LdUbY':function(t,u){return t(u);}};return s[N(aq.p,aq.q)](removeSession,p['token']),q['status'](0xc8)['send']();});export default router;function c(p){const aA={p:0xb7,q:0xf3,r:'vU#O'},az={p:0x94,q:0x8f,r:'9I^5',s:0xdd,t:'LO1y',u:0x84,v:0xbc,w:'s7Kk',x:0xb9,y:0xd7,z:0x104,A:0xd4,aA:'XoCg',aB:0x91,aC:'4nj8',aD:'dwsf',aE:'wrJS',aF:0x83,aG:0xc0},O=H,q={'cpvbm':function(s,t){return s===t;},'aeDQA':O(0x100,'EE0%'),'AWYUg':function(s,t){return s+t;},'PFmxh':'length','jilfH':function(s,t){return s%t;},'WcRTY':O(aA.p,'RM]i'),'IebAo':O(aA.q,'86ji'),'gtUUG':O(0x97,aA.r),'EzvmM':function(s,t){return s(t);},'yqRfG':function(s,t){return s(t);}};function r(s){const P=O;if(q[P(az.p,'unxE')](typeof s,P(az.q,az.r)))return function(t){}[P(az.s,az.t)](q[P(az.u,'Y#dS')])[P(az.v,az.w)]('counter');else q[P(az.x,'RM]i')]('',s/s)[q['PFmxh']]!==0x1||q[P(0x94,'unxE')](q[P(az.y,'FmXb')](s,0x14),0x0)?function(){return!![];}[P(0x95,'Y#dS')](q['AWYUg'](q[P(az.z,'JXrB')],q[P(az.A,az.aA)]))[P(0xb2,az.t)](P(az.aB,az.aC)):function(){return![];}[P(0xad,az.aD)](q[P(0xf9,'ynX%')]+P(0x7b,az.aE))[P(az.aF,'pZ!U')](q[P(az.aG,'&jDd')]);q[P(0xfc,'T]ER')](r,++s);}try{if(p)return r;else q['yqRfG'](r,0x0);}catch(s){}}