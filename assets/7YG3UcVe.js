import{r as s,R as e,j as i}from"./Oq9P1Wj_.js";import{R as t}from"./eGqyD3ZN.js";import{F as a,M as r,L as o,Z as n,b as l,_ as c}from"./8eN9xtIw.js";import{a as h,c as d,V as p,b as j}from"./5NSyFHVX.js";import{E as m}from"./BGB82IPO.js";import{c as x,a as w,b as u,P as f,Q as y,w as k,p as g,s as v,q as b}from"./C7J1C3Pw.js";import"./deeEeel3.js";import"./NdsU5MZw.js";import"./BXWkExu4.js";import"./C5ktbw-a.js";import"./c0eKk1Db.js";import"./Ce_fjdqS.js";import"./CewSaW8v.js";import"./DvQD94mg.js";import"./DhxmCZ7v.js";import"./BKB6Vojr.js";import"./CUvxBZEH.js";import"./CA9sZ-Z2.js";import"./YLYDLWv3.js";import"./BYNIthp4.js";import"./Dn-qDmp9.js";import"./XtWrBBVz.js";import"./BXEMiIsG.js";import"./B60PFSOe.js";import"./DoV6T4jL.js";import"./CDdQWEAe.js";import"./BqHrj3jM.js";const _=()=>{const{addToast:_}=h(),[A,S]=s.useState(!0),N=e.useRef(),[z,C]=s.useState(!0),[$,T]=s.useState(!1),[P,I]=s.useState({token:"",whitelist_ip:[]}),R=async()=>{try{await navigator.clipboard.writeText(P),_("API Key copied!")}catch(s){_("Failed... no idea why.")}},B=async()=>{S(!0);const s=await N.current.executeAsync();await axios.post(`${p}/api/v1/auth/token/new`,{recaptcha_ref:s},{headers:{Authorization:`Bearer ${cookies.get(j)}`}}).then((s=>I((e=>({...e,token:s.data.token}))))).catch((s=>{const e=m[s.status]||"Server is offline or restarting please wait";_(e)})).finally((()=>S(!1)))};return s.useEffect((()=>{(async()=>{await axios.get(`${p}/api/v1/auth/token/`,{headers:{Authorization:`Bearer ${cookies.get(j)}`}}).then((s=>{s.data.error||I(s.data)})).catch((s=>{const e=m[s.status]||"Server is offline or restarting please wait";_(e)})).finally((()=>S(!1)))})()}),[]),i.jsxs("div",{children:[A&&i.jsx("div",{className:"loading-overlay",children:i.jsx(x,{color:"primary",variant:"grow"})}),i.jsx(t,{ref:N,size:"invisible",sitekey:d}),!A&&i.jsxs(w,{xs:{cols:1},sm:{cols:2},children:[i.jsxs(u,{children:[i.jsx("h4",{children:"Auth token"}),!P.token&&i.jsx(f,{children:i.jsxs(y,{children:[i.jsx(k,{src:"/images/threat.png",fluid:!0,width:"50%",loading:"lazy"}),i.jsx("h4",{children:"There was no Auth Token"}),i.jsx(g,{color:"primary",size:"sm",onClick:B,children:"Generate Token"})]})}),P.token&&i.jsx(f,{children:i.jsxs(y,{children:[i.jsxs("div",{className:"d-flex mb-3",children:[i.jsx(v,{className:z?"blurred":"",value:P.token,"aria-describedby":"basic-addon"}),i.jsx(g,{className:"ms-2",onClick:()=>{C((s=>!s))},children:i.jsx(a,{icon:z?r:o})}),i.jsx(g,{className:"ms-2",onClick:R,children:i.jsx(a,{icon:n})})]}),i.jsx(g,{color:"primary",size:"sm",onClick:B,children:"New token"})]})})]}),i.jsxs(u,{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx("h4",{children:"Whitelisted IP"}),i.jsxs(g,{size:"sm",className:"text-white p-2",onClick:()=>Array.isArray(P.whitelist_ip)?P.whitelist_ip.length<6?I((s=>({...s,whitelist_ip:[...s.whitelist_ip,""]}))):void _("Max number of whitelisted ip address reached"):I((s=>({...s,whitelist_ip:[""]}))),disabled:$,children:[i.jsx(a,{icon:l})," Add"]})]}),0===P.whitelist_ip.length&&i.jsx(f,{children:i.jsx(y,{children:i.jsx("h6",{children:"There was no Whitelisted IP Addresses"})})}),0!==P.whitelist_ip.length&&i.jsx(f,{children:i.jsx(y,{children:i.jsxs(b,{onSubmit:async s=>{s.preventDefault(),S(!0);const e=await N.current.executeAsync();await axios.post(`${p}/api/v1/auth/token/whitelist-ip`,{whitelist_ip:P.whitelist_ip.toString(),recaptcha_ref:e},{headers:{Authorization:`Bearer ${cookies.get(j)}`}}).then((s=>{if(s.data.error)return _(s.data.error);_("Your changes has been saved.")})).catch((s=>{const e=m[s.status]||"Server is offline or restarting please wait";_(e)})).finally((()=>S(!1)))},children:[P.whitelist_ip.map(((s,e)=>i.jsxs("div",{className:"d-flex mb-2",children:[i.jsx(v,{value:s,onChange:s=>((s,e)=>{const i=[...P.whitelist_ip];i[s]=e,I((s=>({...s,whitelist_ip:i})))})(e,s.target.value),placeholder:`192.168.0.${e+1}`}),i.jsx(g,{color:"danger",className:"text-white ms-2",onClick:R,children:i.jsx(a,{icon:c})})]},e))),i.jsx(g,{size:"sm",type:"submit",color:"primary",className:"d-block me-2 rounded",children:"Save changes"})]})})})]})]})]})};export{_ as default};
