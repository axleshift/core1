import{r as l,R as E,j as e}from"./D3kDgYDB.js";import{R as S}from"./D0iU1EWp.js";import{F as d,P,Q as T,R,S as D,T as z}from"./B6JYaRyH.js";import{a as B,V as h,b as p}from"./eqcJ5FTX.js";import{E as u}from"./DYDFNPHr.js";import{C as F,B as $,D as w,n as V,N as o,L as y,J as L}from"./DCCyG56P.js";import"./CNSOrHVr.js";import"./WyM-ksIe.js";import"./dB90dn3U.js";import"./Dw8pycEM.js";import"./8JwjhRSi.js";import"./o5tV6Bm-.js";import"./CWoBZRFf.js";import"./tpRZQFqq.js";import"./CzFDRTuY.js";import"./CQ-yZ3vu.js";import"./BmHAl9XU.js";import"./B6-gGlhp.js";import"./DiDpq0UU.js";import"./hKczlkOd.js";import"./CXnULsF_.js";import"./CCb-kr4I.js";import"./Cz0CWeBA.js";import"./Cp7XljvA.js";import"./BQBsAJpH.js";import"./DRFurTTo.js";import"./BZxJdD1U.js";const xe=()=>{const[b,n]=l.useState(!1),m=E.useRef(),[x,g]=l.useState(!0),[A,W]=l.useState(!1),[r,c]=l.useState({token:"",whitelist_ip:[]}),v=()=>{g(s=>!s)},f=async()=>{try{await navigator.clipboard.writeText(r),alert("API Key copied!")}catch(s){console.log(s),alert("Failed... no idea why.")}},j=async()=>{n(!0);const s=await m.current.executeAsync(),a=new FormData;a.append("recaptcha_ref",s),await axios.post(`${h}/api/v1/auth/token/new`,a,{headers:{Authorization:`Bearer ${cookies.get(p)}`}}).then(t=>c(t.data)).catch(t=>{console.error(t);const i=u[t.status]||"An unexpected error occurred";alert(i)}).finally(()=>n(!1))},C=async()=>{n(!0),await axios.get(`${h}/api/v1/auth/token/`,{headers:{Authorization:`Bearer ${cookies.get(p)}`}}).then(s=>{s.data.error||c(s.data)}).catch(s=>{console.error(s);const a=u[s.status]||"An unexpected error occurred";alert(a)}).finally(()=>n(!1))},_=()=>{if(!Array.isArray(r.whitelist_ip))return c(s=>({...s,whitelist_ip:[""]}));if(r.whitelist_ip.length<6)return c(s=>({...s,whitelist_ip:[...s.whitelist_ip,""]}));alert("Max number of whitelisted ip address reached")},k=(s,a)=>{const t=[...r.whitelist_ip];t[s]=a,c(i=>({...i,whitelist_ip:t}))},I=async s=>{s.preventDefault(),n(!0);const a=await m.current.executeAsync(),t=new FormData;t.append("whitelist_ip",r.whitelist_ip),t.append("recaptcha_ref",a),await axios.post(`${h}/api/v1/auth/token/whitelist-ip`,t,{headers:{Authorization:`Bearer ${cookies.get(p)}`}}).then(i=>{if(i.data.error)return alert(i.data.error);alert("done")}).catch(i=>{console.error(i);const N=u[i.status]||"An unexpected error occurred";alert(N)}).finally(()=>n(!1))};return l.useEffect(()=>{C()},[]),e.jsxs("div",{children:[b&&e.jsx("div",{className:"loading-overlay",children:e.jsx(F,{color:"primary",variant:"grow"})}),e.jsx(S,{ref:m,size:"invisible",sitekey:B}),e.jsxs($,{xs:{cols:1},sm:{cols:2},children:[e.jsxs(w,{children:[e.jsx("h4",{children:"Auth token"}),!r.token&&e.jsx("div",{className:"text-center border rounded mb-4",children:e.jsxs("div",{className:"p-1 p-md-5 my-5 my-md-0",children:[e.jsx(V,{src:"/images/threat.png",fluid:!0,width:"50%"}),e.jsx("h4",{children:"There was no Auth Token"}),e.jsx(o,{color:"primary",size:"sm",onClick:j,children:"Generate Token"})]})}),r.token&&e.jsx("div",{className:"text-center border rounded mb-4",children:e.jsxs("div",{className:"p-2 p-md-3",children:[e.jsxs("div",{className:"d-flex mb-3",children:[e.jsx(y,{className:x?"blurred":"",value:r.token,"aria-describedby":"basic-addon"}),e.jsx(o,{className:"ms-2",onClick:v,children:e.jsx(d,{icon:x?P:T})}),e.jsx(o,{className:"ms-2",onClick:f,children:e.jsx(d,{icon:R})})]}),e.jsx(o,{color:"primary",size:"sm",onClick:j,children:"Generate new token"})]})})]}),e.jsxs(w,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h4",{children:"Ip address"}),e.jsxs(o,{color:"success",size:"sm",className:"text-white",onClick:_,disabled:A,children:[e.jsx(d,{icon:D})," Create"]})]}),r.whitelist_ip.length==0&&e.jsx("div",{className:"text-center border rounded mb-4",children:e.jsx("div",{className:"p-2 p-md-3 my-5 my-md-0",children:e.jsx("h6",{children:"There was no Whitelisted IP Addresses"})})}),r.whitelist_ip.length!=0&&e.jsx("div",{className:"text-center border rounded mb-4",children:e.jsx("div",{className:"p-2 p-md-3",children:e.jsxs(L,{onSubmit:I,children:[r.whitelist_ip.map((s,a)=>e.jsxs("div",{className:"d-flex mb-2",children:[e.jsx(y,{value:s,onChange:t=>k(a,t.target.value),placeholder:`192.168.0.${a+1}`}),e.jsx(o,{color:"danger",className:"text-white ms-2",onClick:f,children:e.jsx(d,{icon:z})})]},a)),e.jsx(o,{type:"submit",color:"primary",className:"d-block me-2 rounded",children:"Save changes"})]})})})]})]})]})};export{xe as default};
