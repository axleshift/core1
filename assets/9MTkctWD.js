import{r as e,R as s,j as i}from"./Oq9P1Wj_.js";import{R as t}from"./eGqyD3ZN.js";import{F as a,M as r,L as o,_ as n,b as c,$ as l}from"./Bi-OQx1y.js";import{a as d,c as h,V as m,b as p}from"./CmJA4lJM.js";import{E as j}from"./BGB82IPO.js";import{c as x,a as u,b as w,w as f,p as v,s as y,q as b}from"./C7J1C3Pw.js";import"./deeEeel3.js";import"./NdsU5MZw.js";import"./BXWkExu4.js";import"./C5ktbw-a.js";import"./c0eKk1Db.js";import"./Ce_fjdqS.js";import"./CewSaW8v.js";import"./DvQD94mg.js";import"./DhxmCZ7v.js";import"./BKB6Vojr.js";import"./CUvxBZEH.js";import"./CA9sZ-Z2.js";import"./YLYDLWv3.js";import"./BYNIthp4.js";import"./Dn-qDmp9.js";import"./XtWrBBVz.js";import"./BXEMiIsG.js";import"./B60PFSOe.js";import"./DoV6T4jL.js";import"./CDdQWEAe.js";import"./BqHrj3jM.js";const k=()=>{const{addToast:k}=d(),[g,N]=e.useState(!0),_=s.useRef(),[A,S]=e.useState(!0),[C,z]=e.useState(!1),[$,T]=e.useState({token:"",whitelist_ip:[]}),I=async()=>{try{await navigator.clipboard.writeText($),k("API Key copied!")}catch(e){k("Failed... no idea why.")}},R=async()=>{N(!0);const e=await _.current.executeAsync();await axios.post(`${m}/api/v1/auth/token/new`,{recaptcha_ref:e},{headers:{Authorization:`Bearer ${cookies.get(p)}`}}).then((e=>T((s=>({...s,token:e.data.token}))))).catch((e=>{const s=j[e.status]||"Server is offline or restarting please wait";k(s)})).finally((()=>N(!1)))};return e.useEffect((()=>{(async()=>{await axios.get(`${m}/api/v1/auth/token/`,{headers:{Authorization:`Bearer ${cookies.get(p)}`}}).then((e=>{e.data.error||T(e.data)})).catch((e=>{const s=j[e.status]||"Server is offline or restarting please wait";k(s)})).finally((()=>N(!1)))})()}),[]),i.jsxs("div",{children:[g&&i.jsx("div",{className:"loading-overlay",children:i.jsx(x,{color:"primary",variant:"grow"})}),i.jsx(t,{ref:_,size:"invisible",sitekey:h}),!g&&i.jsxs(u,{xs:{cols:1},sm:{cols:2},children:[i.jsxs(w,{children:[i.jsx("h4",{children:"Auth token"}),!$.token&&i.jsx("div",{className:"text-center border rounded mb-4",children:i.jsxs("div",{className:"p-1 p-md-5 my-5 my-md-0",children:[i.jsx(f,{src:"/images/threat.png",fluid:!0,width:"50%",loading:"lazy"}),i.jsx("h4",{children:"There was no Auth Token"}),i.jsx(v,{color:"primary",size:"sm",onClick:R,children:"Generate Token"})]})}),$.token&&i.jsx("div",{className:"text-center border rounded mb-4",children:i.jsxs("div",{className:"p-2 p-md-3",children:[i.jsxs("div",{className:"d-flex mb-3",children:[i.jsx(y,{className:A?"blurred":"",value:$.token,"aria-describedby":"basic-addon"}),i.jsx(v,{className:"ms-2",onClick:()=>{S((e=>!e))},children:i.jsx(a,{icon:A?r:o})}),i.jsx(v,{className:"ms-2",onClick:I,children:i.jsx(a,{icon:n})})]}),i.jsx(v,{color:"primary",size:"sm",onClick:R,children:"Generate new token"})]})})]}),i.jsxs(w,{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx("h4",{children:"Ip address"}),i.jsxs(v,{color:"success",size:"sm",className:"text-white",onClick:()=>Array.isArray($.whitelist_ip)?$.whitelist_ip.length<6?T((e=>({...e,whitelist_ip:[...e.whitelist_ip,""]}))):void k("Max number of whitelisted ip address reached"):T((e=>({...e,whitelist_ip:[""]}))),disabled:C,children:[i.jsx(a,{icon:c})," Create"]})]}),0===$.whitelist_ip.length&&i.jsx("div",{className:"text-center border rounded mb-4",children:i.jsx("div",{className:"p-2 p-md-3 my-5 my-md-0",children:i.jsx("h6",{children:"There was no Whitelisted IP Addresses"})})}),0!==$.whitelist_ip.length&&i.jsx("div",{className:"text-center border rounded mb-4",children:i.jsx("div",{className:"p-2 p-md-3",children:i.jsxs(b,{onSubmit:async e=>{e.preventDefault(),N(!0);const s=await _.current.executeAsync();await axios.post(`${m}/api/v1/auth/token/whitelist-ip`,{whitelist_ip:$.whitelist_ip.toString(),recaptcha_ref:s},{headers:{Authorization:`Bearer ${cookies.get(p)}`}}).then((e=>{if(e.data.error)return k(e.data.error);k("Your changes has been saved.")})).catch((e=>{const s=j[e.status]||"Server is offline or restarting please wait";k(s)})).finally((()=>N(!1)))},children:[$.whitelist_ip.map(((e,s)=>i.jsxs("div",{className:"d-flex mb-2",children:[i.jsx(y,{value:e,onChange:e=>((e,s)=>{const i=[...$.whitelist_ip];i[e]=s,T((e=>({...e,whitelist_ip:i})))})(s,e.target.value),placeholder:`192.168.0.${s+1}`}),i.jsx(v,{color:"danger",className:"text-white ms-2",onClick:I,children:i.jsx(a,{icon:l})})]},s))),i.jsx(v,{type:"submit",color:"primary",className:"d-block me-2 rounded",children:"Save changes"})]})})})]})]})]})};export{k as default};
