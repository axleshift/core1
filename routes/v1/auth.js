const J=f;(function(p,q){const R={p:0x13c,q:'aMCJ',r:'exz6',s:0xf1,t:0x158,u:0x140,v:'%Tjw',w:'Sf)&',x:0xef,y:0x161},B=f,r=p();while(!![]){try{const s=-parseInt(B(R.p,R.q))/0x1*(parseInt(B(0x12e,R.r))/0x2)+-parseInt(B(0x11e,'RlmY'))/0x3*(-parseInt(B(R.s,'b[51'))/0x4)+parseInt(B(R.t,'bWf]'))/0x5*(parseInt(B(R.u,R.v))/0x6)+parseInt(B(0xf3,R.w))/0x7+-parseInt(B(R.x,'tqMC'))/0x8+-parseInt(B(0x119,'40Nw'))/0x9*(-parseInt(B(0x157,'%Tjw'))/0xa)+-parseInt(B(R.y,'Nv36'))/0xb;if(s===q)break;else r['push'](r['shift']());}catch(t){r['push'](r['shift']());}}}(e,0xb2b91));function e(){const aF=['bSopnI8','W4nba8koW5O','W5iGW6zXjq','ic/cOmkjWOG','Amk7wuC','md/cHSk5WRW','dCkinGfM','jcrvmuefamk2','W6SvWR7cPCoo','nw9TtbRcSCortt1ZiW','dbJcQfLdWQa','pxHnhMm9jW','vHOdW7Sde8kFj8o8gNZdNSozASomnHCkhq','WRVcSKFdSq','WOdcI8ojq2K','WRTqW7BdVmoeWPxdShldIe4','WRveWPpcHtFdQI4','osOl','W5OIB8oWvq','qriwW6CD','W5RdTmkvb8kI','WR9qW7NdVmoVWQ/dPutdVhS','pcSfWO0','WQDuWRRcTt8','W5eIW7Xlna','vt1rWQ7dJSkAW6ldQ8oiE3G','WRimWQdcN1xcUa/dIaJcPCkt','W69mW5b8m3RdH1tdUSokASoKWQBdMuq','gJ/cL11P','sJ1bmte','i8osWPWhua/dS0vTW4BdLJpcMdWGhCkBEZ3dTbVcISo0WPlcUxRcQ8oOlmobW67dKa','ixZdVKBcHa','DJ9vvCoDW73dONG','ubOeW7O','zuG/sqKev8kGWPi','wLvSiW','WRjOemksC8o/qmoZWPFdHW','vMhcImkqWRy3','WOecWR3cN1BcPqJdJ1ZcP8kuWR3dUmoohe8DW7CTW7nxjI/dN0vJFrW4W69gos7cOCktW4mq','AgZcKmkcua','Bdy9W40K','jmowWRhdPM9L','W5ZcM8oUrW','W5ZcISoHv8k7WQu','WR4wW4ldLvG','W7u7vCoQAa','omkPW6uBcq','pMXrBqG','vtDuWQNdJmo5WRxdGCosyhddVqG','W63dObRcTSodD8kYWPRdJIm','WRTiWPZcHr3dTJG','WP0lWPrxEG','oCoFW4iirG','gG7dLSovlmkBW4ZdN8oJW4S5Fmow','jSoNW7qqWP3dNb5Os8kVWPP6W7ZcMmkTWPVdJrpcRCk5eSkxwG','W7dcUZVcLWLn','xmkzs2CV','gr09valcIb7cSmkqWR/cGSkMoIpcG8kW','ngSwe8ktWQtcPY7dT2XwW7D7Fa','W7uiW5H3','ah/dRhlcMW','WRLEWPlcJW','W6/cQIFcMrnc','kfFdStWt','zSk3wurMWRq','hCocW5mnu0hdQvu/W5ldMtxcKI9SrSojEZhdQbRcKmkN','Amk9u1O','bCkjW4C/eHhcOSkRWQVdKmkk','W47cTsDZWPpcPG','F8kHuLe','W5VcRL3dUCoJECo3W6u','g1/dK3xcKq','WPOqWP5gyui','tv1JaK/dL0BdRmo6W5RcJmoPugm','g8kOW5afga','WPi8W4ddT2m','W4ZcKCoSt8kRWRu/ocldVa','W5tdT8knjG','rSoHemkO','xG8BW4a8','DMb8jJG','W4XHiCksW7i','sb4eW7OUe8oEySo/','mmkHfJPBW6/dN3NdISkHxvFcUq','tmkhjbW','W4r/iCklW78','weZcKCkKxq','W494p8kA','fCkdW50fcbFcSSk6WQNdNSku','DSkzsvKsWOzT','W7XyWO7cHaO','txZcQmkwta','WRGlW57dIv5gW4PcWQpcUCk6','W5xcOaRcHc8hW6eTaq','WQ1EubtdTW','g8oxW4yozq','W4zsoCkUW4y','WO7dQCoonCkK','ECk3wuC','W5xcTt3cSWq','p3hcUc/cGt7cKNJdRMVcHHna','EJBdJg3dJG','zSkBW6hcPfLtyhRcHs4','W5KwW5r6eq','xmksyg/dMSkDzuKBACkJW60S','fCohW4C1va','nxjMxHRcPSoStZP0','y8kvsvK','WP4IW7JdMhi','WRpcImoHteC','W4hdHxnPEG','eSkfW5qtdXe','qCoLhmkGEW','v8kfW5yT','o8oaW5WcvGy','WQKbW4tdJ1HAWP8jWRhcO8kMhCkUgSk/da53WRG','W47cSIuQW4pdPa','W6KnWQ/cOmoz','W6tdOv5WyG','W5/dJ3RdOCohW6VcSW','W7aLqmoqrCoj','vmkEW4qTW55t','W7m+uSoq','WP7dTwddNG','W43dPuxdRSod','D8ozW5CwvGFdUq','WP3dV33dJG','WOJcOmoDASoZWO/dGZ88pfldPGa','qmknW4aR','jtpdQh7dKxxdKL7dSa','lJHcWPPVweRdMCoHumkbW5lcJCk2W6BdTwFdRI4mWPZdNSk5BCkkBZzyrHGnWO4','W5RcQWBcJW','bbxcR1vEWROAl2e','WRJdK8o4p8kalmoO','W5VcKCotv8k8WR8LnG','WPGNzSohW7pcVtCrWR/cNq','WRSqWQhcGG','lZ/cJmkL','WQ8lW6pdJLHDW5fg','E8kgWQhdMJi','WQJdNhZdUSoT','t8kpW50','D8oWnqzwW4pdM1q','WPKwWPbgE0xcHd/dRa','W7qYW4nBcW','bCoJW6Kh','ptRcT8kFWO0','W67cISkHDCkxaCo8tfya','W68iWQ/cOmoB','W5FcQsT2','dbWYqWpcKG','jxrIsXVcSa','ed3cOSkrWRK','WQJdMCo4ka','W4VdVwvWta','WRGlW5ZdLK9xW4TiWRJcUa'];e=function(){return aF;};return e();}const d=(function(){const S={p:'sZlb'};let p=!![];return function(q,r){const s=p?function(){const C=f;if(r){const t=r[C(0x15b,S.p)](q,arguments);return r=null,t;}}:function(){};return p=![],s;};}());(function(){const a2={p:0x13d,q:'03E#',r:0xe0},a1={p:0x160,q:'zgFF',r:0x14a,s:0x100,t:'aMCJ',u:'weec',v:0x11d,w:'Z@v%',x:0xee,y:'k)z$',z:0x146,A:'OjR4'},D=f,p={'ivGyr':'\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','PahWm':function(q,r){return q(r);},'FFoPw':D(a2.p,a2.q),'vhzLt':function(q,r){return q+r;},'xvTTB':D(a2.r,'kIfw'),'VztMc':function(q,r){return q(r);},'TpwFl':function(q){return q();},'Ejfmz':function(q,r,s){return q(r,s);}};p['Ejfmz'](d,this,function(){const E=D,q=new RegExp(E(a1.p,a1.q)),r=new RegExp(p['ivGyr'],'i'),s=p[E(0x116,'qApb')](c,p[E(0x117,'pL!e')]);!q[E(a1.r,'bEHb')](s+E(a1.s,a1.t))||!r[E(0x148,'&wi5')](p[E(0x135,a1.u)](s,p[E(a1.v,a1.w)]))?p[E(a1.x,a1.y)](s,'0'):p[E(a1.z,a1.A)](c);})();}());const b=(function(){let p=!![];return function(q,r){const a3={p:0x12f},s=p?function(){const F=f;if(r){const t=r[F(a3.p,'aMCJ')](q,arguments);return r=null,t;}}:function(){};return p=![],s;};}()),a=b(this,function(){const a9={p:'&wi5',q:'03E#',r:0xe8,s:'39eh',t:0x10d,u:'03E#',v:0x110,w:'RlmY',x:0x143,y:'UXN7',z:'&wi5',A:'kIfw',aa:0xf8,ab:'weec',ac:0x139,ad:'RySx',ae:'Kf[3',af:0x11a,ag:')bMr',ah:'dA(b',ai:0x162,aj:'85*B',ak:0x12b},G=f,p={'xOPnT':function(t,u){return t+u;},'IXpMI':G(0x133,a9.p),'wDKmE':G(0x138,a9.q),'XCqVv':'warn','HIJCU':'info','nPRpQ':'error','EkRCZ':G(a9.r,a9.s),'ecCBG':G(0xfb,'To*c'),'YsNTe':'trace','wrrGH':function(t,u){return t<u;}};let q;try{const t=Function(p[G(0x125,'*GHb')](p[G(0x172,'85*B')]+G(a9.t,a9.u),');'));q=t();}catch(u){q=window;}const r=q[G(a9.v,a9.w)]=q['console']||{},s=[p[G(a9.x,a9.y)],p['XCqVv'],p[G(0x14f,a9.z)],p[G(0x128,a9.A)],p[G(a9.aa,a9.ab)],p[G(0x12a,'Z@v%')],p[G(a9.ac,a9.ad)]];for(let v=0x0;p[G(0xe1,'aqdr')](v,s[G(0x165,'k)z$')]);v++){const w=b[G(0xe3,a9.ae)][G(a9.af,a9.ag)][G(0xe2,'kIfw')](b),x=s[v],y=r[x]||w;w[G(0x149,a9.ah)]=b[G(a9.ai,'wLub')](b),w[G(0x111,'7I#Q')]=y[G(0x115,a9.aj)][G(a9.ak,'(4bI')](y),r[x]=w;}});(function(){const ad={p:0x16a,q:'Kf[3'},ac={p:0x154,q:'RySx',r:0xf4,s:'sZlb'},H=f,p={'vjtNX':function(s,t){return s+t;},'MhuQk':H(0xfe,'85*B'),'PPJJU':function(s){return s();}},q=function(){const I=H;let s;try{s=Function(p[I(ac.p,ac.q)](p[I(ac.r,ac.s)],I(0x145,'sZlb'))+');')();}catch(t){s=window;}return s;},r=p['PPJJU'](q);r[H(ad.p,ad.q)](c,0x9c4);}()),a();import g from'dotenv';g[J(0xfd,'sZlb')]();import h from'express';import i from'bcryptjs';import j from'crypto';import k from'../../models/db.js';import l from'../../src/logger.js';import{addSession,addUserProfileToSession,removeSession}from'../../src/sessions.js';import m from'../../middleware/auth.js';import n from'../../middleware/recaptcha.js';import o,{generateUniqueId}from'../../src/password.js';const router=h['Router']();function f(a,b){const c=e();return f=function(d,g){d=d-0xe0;let h=c[d];if(f['KHTxLk']===undefined){var i=function(n){const o='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let p='',q='';for(let r=0x0,s,t,u=0x0;t=n['charAt'](u++);~t&&(s=r%0x4?s*0x40+t:t,r++%0x4)?p+=String['fromCharCode'](0xff&s>>(-0x2*r&0x6)):0x0){t=o['indexOf'](t);}for(let v=0x0,w=p['length'];v<w;v++){q+='%'+('00'+p['charCodeAt'](v)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(q);};const m=function(n,o){let p=[],q=0x0,r,t='';n=i(n);let u;for(u=0x0;u<0x100;u++){p[u]=u;}for(u=0x0;u<0x100;u++){q=(q+p[u]+o['charCodeAt'](u%o['length']))%0x100,r=p[u],p[u]=p[q],p[q]=r;}u=0x0,q=0x0;for(let v=0x0;v<n['length'];v++){u=(u+0x1)%0x100,q=(q+p[u])%0x100,r=p[u],p[u]=p[q],p[q]=r,t+=String['fromCharCode'](n['charCodeAt'](v)^p[(p[u]+p[q])%0x100]);}return t;};f['kuFzbG']=m,a=arguments,f['KHTxLk']=!![];}const j=c[0x0],k=d+j,l=a[k];return!l?(f['VwDcdf']===undefined&&(f['VwDcdf']=!![]),h=f['kuFzbG'](h,g),a[k]=h):h=l,h;},f(a,b);}router[J(0x106,'pL!e')](J(0x10c,'tqMC'),async(p,q)=>{const ah={p:'N@gD',q:0x168,r:0x16c,s:0x169,t:'(4bI',u:0x123,v:'Z@v%',w:0x17b,x:'X8pA',y:0x103,z:'RySx',A:0x113,ai:'N@gD',aj:0x107,ak:0x167,al:0x150,am:0x12d,an:0x15d,ao:'08qK',ap:0x13e,aq:0x137,ar:0x153,as:'85*B',at:0x166,au:'w0Xl',av:0x10f,aw:'fE*s',ax:0x155,ay:0x175},K=J,r={'UqAZv':function(s,t){return s||t;},'tCQkK':'Invalid\x20email\x20address','OLMTI':K(0x14d,ah.p),'tyGTG':function(s){return s();},'EAPbd':'users','UHYvG':K(ah.q,'sZlb'),'hlRRf':K(ah.r,'(4bI'),'NEVmu':function(s,t){return s(t);}};try{const {email:s,first_name:t,last_name:u,password:v,repeat_password:w}=p[K(ah.s,ah.t)];if(r[K(ah.u,ah.v)](!s,!t)||!u||!v||!w)return q[K(0x16f,')bMr')](0x190)[K(ah.w,ah.x)]();if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/['test'](s))return q[K(ah.y,ah.z)](0xc8)[K(ah.A,ah.ai)]({'error':r[K(ah.aj,'M2h4')]});if(v[K(ah.ak,'(4bI')]<0x8)return q[K(ah.al,'b[51')](0xc8)[K(0x120,'6Y(i')]({'error':r[K(ah.am,'40Nw')]});if(v!=w)return q[K(0x152,'7I#Q')](0xc8)['json']({'error':K(ah.an,ah.ao)});const x=await r[K(ah.ap,'Dc#[')](k),y=x['collection'](r[K(0x129,'wLub')]),z=await y[K(ah.aq,'Dc#[')]({'email':s});if(z)return l[K(ah.ar,ah.as)](r[K(ah.at,ah.au)]),q['status'](0x199)[K(0x109,'pL!e')]();return await y[K(ah.av,'UXN7')]({'email':s,'first_name':t,'last_name':u,'role':r[K(0x156,ah.aw)],'password':r[K(ah.ax,'Kf[3')](o,v),'email_verify_at':'','created_at':new Date(),'update_at':new Date()}),q[K(0x104,'sJ2D')](0xc9)[K(0xf6,'[4tz')]();}catch(A){l['error'](A);}return q['status'](0x1f4)[K(ah.ay,'To*c')]();}),router[J(0x106,'pL!e')]('/login',n,async(p,q)=>{const ao={p:0x163,q:0x118,r:0x142,s:'Sf)&',t:0x150,u:'08qK',v:0xec,w:0x122,x:'fE*s',y:'7I#Q',z:0xff,A:0x13f,ap:'wLub',aq:'Kf[3',ar:0xf2,as:0x159,at:'Dc#[',au:'aqdr',av:'6Y(i',aw:0x17a,ax:'40Nw',ay:'OjR4',az:0xf7,aA:'85*B',aB:'zgFF'},L=J,r={'NxGIK':function(s,t){return s||t;},'bRdnw':function(s){return s();},'EXrBs':L(ao.p,'OjR4'),'LPRWz':function(s,t){return s!=t;},'UUXyK':function(s,t){return s(t);},'FCJXu':function(s){return s();},'NwbiP':L(ao.q,'sJ2D'),'GRsaE':L(ao.r,'wLub'),'nSZuy':function(s,t,u,v,w){return s(t,u,v,w);},'EFHbX':'user-agent'};try{const {email:s,password:t}=p[L(0x127,ao.s)];if(r['NxGIK'](!s,!t))return q[L(ao.t,'b[51')](0x190)[L(0x11c,ao.u)]();const u=await r['bRdnw'](k),v=u[L(0x126,'85*B')](r['EXrBs']),w=await v[L(0x102,'M2h4')]({'email':s});if(!w)return q['status'](0x194)['send']();if(r['LPRWz'](r[L(ao.v,'RlmY')](o,t),w[L(0x147,'Nv36')]))return q[L(ao.w,ao.x)](0x191)[L(0x151,ao.y)]();r['UUXyK'](addUserProfileToSession,w);const x=j[L(0xf5,'fE*s')](L(ao.z,'6Y(i'))['update'](r[L(ao.A,ao.ap)](generateUniqueId))[L(0xfa,ao.aq)](r[L(ao.ar,ao.ap)]),y=p[L(ao.as,ao.at)][r[L(0x14e,ao.au)]]||p[L(0x16b,ao.av)][L(ao.aw,ao.ax)];return r[L(0x16e,ao.ay)](addSession,w,x,y,p['headers'][r[L(ao.az,ao.aA)]]),q[L(0x121,'zgFF')](0xc8)[L(0x114,'Z@v%')]({'token':x});}catch(z){l['error'](z);}return q[L(0x121,ao.aB)](0x1f4)[L(0xed,'(4bI')]();}),router[J(0x105,'RySx')](J(0x108,'sZlb'),m,function(p,q,r){const ap={p:0x14c,q:'%lRl',r:0x164,s:'Dc#[',t:0x13a,u:'&wi5'},M=J;return q[M(ap.p,ap.q)](0xc8)[M(ap.r,ap.s)]({'email':p[M(ap.t,ap.u)]});}),router['post'](J(0xe5,'Dc#['),m,async function(p,q,r){const aq={p:'Z@v%',q:0x173,r:'7I#Q',s:'!9@W',t:0xe4,u:'[4tz',v:'aMCJ',w:'39eh',x:0x179,y:'&wi5',z:0x144,A:'RlmY'},N=J,s={'jfzTc':N(0x12c,aq.p)};try{const t=await k(),u=t[N(aq.q,aq.r)](s[N(0x13b,aq.s)]),v=await u[N(aq.t,aq.u)]({'email':p[N(0x11f,aq.v)]});return q['status'](0xc8)[N(0x10e,aq.w)]({'user':{'email':v['email'],'first_name':v['first_name'],'last_name':v[N(aq.x,aq.y)]}});}catch(w){l[N(aq.z,'MR)[')](w);}return q['status'](0x1f4)[N(0x124,aq.A)]();}),router[J(0xfc,'sJ2D')](J(0x132,'exz6'),m,function(p,q,r){const as={p:0x15a},O=J,s={'mDcsd':function(t,u){return t(u);}};return s[O(0x171,'Kf[3')](removeSession,p[O(as.p,')bMr')]),q['status'](0xc8)['send']();});export default router;function c(p){const aE={p:0x15e,q:0x174,r:'!9@W',s:0xf9,t:'*GHb'},aD={p:0xea,q:'sZlb',r:0x130,s:0x101,t:'*GHb',u:'kIfw',v:'bEHb',w:0xe6,x:0xf0,y:'tqMC',z:'wLub',A:'sJ2D',aE:'!9@W',aF:0x15f,aG:'[4tz'},P=J,q={'CxtjZ':P(aE.p,'k)z$'),'WSknz':'while\x20(true)\x20{}','XPcqv':function(s,t){return s!==t;},'cSuHJ':function(s,t){return s+t;},'OpycA':'length','bBKuY':function(s,t){return s===t;},'pwAtv':function(s,t){return s%t;},'kChPM':P(aE.q,aE.r),'zplNM':function(s,t){return s+t;},'MfMvi':P(0x134,'bWf]'),'LilZr':function(s,t){return s(t);},'rwFwb':function(s,t){return s(t);}};function r(s){const Q=P;if(typeof s===q[Q(aD.p,aD.q)])return function(t){}[Q(aD.r,'fE*s')](q[Q(aD.s,aD.t)])[Q(0x178,aD.u)]('counter');else q[Q(0x177,aD.v)](q[Q(0xe9,'Cis#')]('',s/s)[q['OpycA']],0x1)||q[Q(aD.w,'aqdr')](q[Q(aD.x,aD.y)](s,0x14),0x0)?function(){return!![];}[Q(0x141,'N@gD')](q[Q(0x11b,aD.z)](q[Q(0xeb,'kIfw')],Q(0x10b,aD.A)))['call'](Q(0x131,'UXN7')):function(){return![];}[Q(0xe7,'85*B')](q[Q(0x176,'&wi5')](Q(0x174,aD.aE),q['MfMvi']))['apply']('stateObject');q[Q(aD.aF,aD.aG)](r,++s);}try{if(p)return r;else q[P(aE.s,aE.t)](r,0x0);}catch(s){}}