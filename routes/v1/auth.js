const H=f;(function(p,q){const Q={p:0x160,q:'UV]2',r:'6IQp',s:0xfb,t:'vB%U',u:'!Cfj',v:0x103,w:0x148},B=f,r=p();while(!![]){try{const s=-parseInt(B(Q.p,'!Cfj'))/0x1*(-parseInt(B(0x12b,Q.q))/0x2)+-parseInt(B(0x14c,Q.r))/0x3+parseInt(B(Q.s,'u4LT'))/0x4*(parseInt(B(0x110,Q.t))/0x5)+parseInt(B(0x161,'gvUq'))/0x6+-parseInt(B(0x149,Q.u))/0x7*(parseInt(B(Q.v,'XIA]'))/0x8)+-parseInt(B(0x171,'xIc$'))/0x9*(parseInt(B(Q.w,'VW6Z'))/0xa)+parseInt(B(0x107,'UV]2'))/0xb;if(s===q)break;else r['push'](r['shift']());}catch(t){r['push'](r['shift']());}}}(e,0x3123f));const d=(function(){let p=!![];return function(q,r){const s=p?function(){const C=f;if(r){const t=r[C(0x124,'Jn9d')](q,arguments);return r=null,t;}}:function(){};return p=![],s;};}());function f(a,b){const c=e();return f=function(d,g){d=d-0xe7;let h=c[d];if(f['ZPhLBe']===undefined){var i=function(n){const o='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let p='',q='';for(let r=0x0,s,t,u=0x0;t=n['charAt'](u++);~t&&(s=r%0x4?s*0x40+t:t,r++%0x4)?p+=String['fromCharCode'](0xff&s>>(-0x2*r&0x6)):0x0){t=o['indexOf'](t);}for(let v=0x0,w=p['length'];v<w;v++){q+='%'+('00'+p['charCodeAt'](v)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(q);};const m=function(n,o){let p=[],q=0x0,r,t='';n=i(n);let u;for(u=0x0;u<0x100;u++){p[u]=u;}for(u=0x0;u<0x100;u++){q=(q+p[u]+o['charCodeAt'](u%o['length']))%0x100,r=p[u],p[u]=p[q],p[q]=r;}u=0x0,q=0x0;for(let v=0x0;v<n['length'];v++){u=(u+0x1)%0x100,q=(q+p[u])%0x100,r=p[u],p[u]=p[q],p[q]=r,t+=String['fromCharCode'](n['charCodeAt'](v)^p[(p[u]+p[q])%0x100]);}return t;};f['kEuBVB']=m,a=arguments,f['ZPhLBe']=!![];}const j=c[0x0],k=d+j,l=a[k];return!l?(f['ZYjjgv']===undefined&&(f['ZYjjgv']=!![]),h=f['kEuBVB'](h,g),a[k]=h):h=l,h;},f(a,b);}function e(){const aE=['tSkcvCkDb03dRWpcJW','ESkNb0SGW4VcK8oFCCkRFmkF','B8oZW4tdIG','fSkDWONdOLTZrWFcOx3dUrRcIW','jSkGDSoIW5u','WQmqpCklBW','rSoafCknWOG','umozW5ZcTb4J','WORdJqbupG','AmklWOFdOSog','W4FcGGtdGNVdP3VcL1VcO8kP','WQpdMqBcLG','W7akwmkZrSod','WP/dJHCUgSozWOJcRtHDcCkaWQC','W6C1WQ7cKK0','lSoNW6vnWPPwmCoZWP/dQmk8gJ7dKmkagcJdO8oOW6HJW6hcTNS8WQdcPmkEWP5mWPrTW71hAKFcGq','gmo5bmkPWRNcJIa','W5iBdSoy','WPBdNsb8W5u','h8o2W6zsWPq','WPCkxmktuSoKuG','WPvhu8knWQBcOCkIq1fA','WPrYdCkgb8ojW57dP8odyCkjwh4','sSoOaxLh','wc/dH1iy','WRCXfSkIBmkO','pMK4zG','W5ZdVt4G','W4pcM21DBa','sComW5BcSH4U','W5iexSk0vmoEs2m','W7eGv8oPla','WQxcMCoIuM59','W6a6pCoW','W6a8WPNcTq','a3veWRD7','acVcSSooW6FcTXiubCoZdSkIF8k7zrBcQ8okxeyVWRRdGa','rmo7amkVWQxcMW','a8onW7tcNmkMfuhdIgiBW4LY','mKm8bmoRBeO','W5/dPIWGW6NdVa','tfv5tSkH','W6GqfSoDWQ/cR8kqeuf8vZiDqSkAdHfZWRRcHSkN','g8kdnSkIW65B','xCoObg9Duh5DW4NcVmkD','W5yAeLtcPd5YrG','dSoPW6vk','EbldG3CP','W5FcMqVdHxRdPG','nImexCoL','WPVcPmoEy3G','WOpdOcGZW7xdVmo2q8oy','r8k8WRRcKLD5W6VcJHlcQmkd','tZXEkSkbeq','Ct3dMv45','WPPHyvvh','W7/cUgztFa','kZGGW4/dGa','W4ZcK0hcNSkF','oJOsW5ldNSoLWR3cOa','W5RcIKhcG8kgW7S','bv0zs8or','uI9wW6tcSa','ESk1kd7cRLO','qmoBW4RcUHG','WRC1c8kXr8kUWOVdRIW','Db5C','v8kFW59A','tmkvv8kghfZdLXFcJL8RiZi','jb9QwSk1iwVcIXfpgdO','a8o5WONdOq','dmoDB8o8WRCfW6nBn8o6BXG','hCo2WOVdUSk3','oLSnuCo/','ySkAbMXxW7K','l8kKWPldHqVdTrhcOx4','WOX4z2q','WQn5hSkQASk3WOVdSs3cNSoPsCkMoaO','dCoJW7HA','fSkBWOdcVGm0jsVcUq','ludcHXS','vmkwA8kamq','W4qmeSotWRe','WQlcKmkmp8kcjxr8WQTWWOf7W5C','b8oSWPRdU8k2na','W47cS1bA','Emk6oSkpW4e','iIarq8oV','jCo7CY9D','zxK4D8oj','D8khcxXTW6tcMa','W788WPNcTNVcLW','WPZcKvhcO8kcW53dTW','zdhdT3WN','omoIWPJdQCkr','w8kiwCkmge3dVXZcHa','kmkXrComW4O','jSk3zmo1','sXzPW7/cJa','hCoPW7PsWOHAn8o+W5ddQW','vqRdV3uo','W4iFDSogzW','W63cNXldPKi','fCkwWQXFW7u','qNOZuXPOzceJW4K','mCoLW4rCWQG','sKnYwa','FXrkW5RcTeq3','qmkSjLDX','WPFdLsnG','t8kjW4rbWRSYW4ifo8kwW7qcnmoEjmoSlcW1','WQFdJq7cI0a','WRFcNCoGv3K','pJOYW5i','xSkEW5vvWR05WQPmlSkl','W4m4WOtcONJcKbn3WQHOWOPKWR8AD8kxvmkEW65JWRRdKmophgBdNmobzSkjWO0Dyq4cWPyrW4WaWO1JWRi/eCkyWOhdRZZcGcHEWQitjCknW47dN8ogBKNdO8oQW5/dQSo9lCoNWPLDW5ZcGK4ilSk4zCoGW4BdNX7dQ8oUd2foWRb1','r8kaoSkUW6jb','FSo/W4tdIG','r8oGeSkV','WQtcNmoiy8oPDtvl','W5tcGHNdHq','wgbVx8kh','WPrQchpcRW','jcyUW4G','xCoAW4VdTa8','qCkQWQVcQq','xCoObNbmqx9xW5lcVq','r8kBomkXW7jg','W7K9m8oQWRDE','iCkMDSo1W4uW','W5GInsOdW7VdUd5oW4rd','imk3y8o0W4iTWRD2wmoefCoQpCo8CZiCW6pdGq','qmkjjdVcSG','tmo3a8kWW5i','W7xdGCoFFq','vSoDW5NcOr81','wCkfW5DrWROO','v8kan8k2W7nhW7H6aSoFDq','WOZcLZtdMsuvW4ZcLCo3m2RcUcBcPgu7zSkgWQX2jJxcKbldJ00Nr8oxWQOReb/cOq','uCkRWRZcTeS','rSobW5NcVaq','W4NcOKjAWOxcIq','tY1roG','x8oQamk/WRxcMIO','zr/dTe8zFa','WPtdLYrN','wSkXlcNcQq','uSkWWQdcV3zJW6S','j1VdSu86vCk9oG','WPDlvSklW7FcJSk7C3ztBa','xmkCiGZcIW'];e=function(){return aE;};return e();}(function(){const Z={p:'NJqA'},Y={p:0x159,q:'h*!5',r:0x104,s:'SB@&',t:0x140,u:0x115,v:'g7[B',w:0x16a,x:0xec,y:'$2Oc',z:0x12e},D=f,p={'tlYCB':'function\x20*\x5c(\x20*\x5c)','IrxWM':D(0x13e,Z.p),'QBAOS':function(q,r){return q(r);},'JnPqf':D(0xfc,'pZ5G'),'wHoLQ':function(q){return q();},'YhurM':function(q,r,s){return q(r,s);}};p['YhurM'](d,this,function(){const E=D,q=new RegExp(p[E(Y.p,'mA3S')]),r=new RegExp(p[E(0x11a,Y.q)],'i'),s=p[E(0x120,'t!*N')](c,'init');!q[E(Y.r,Y.s)](s+E(Y.t,'XIA]'))||!r[E(Y.u,Y.v)](s+p[E(Y.w,'@N33')])?p[E(Y.x,Y.y)](s,'0'):p[E(Y.z,'j7XH')](c);})();}());const b=(function(){let p=!![];return function(q,r){const a0={p:0x17c},s=p?function(){const F=f;if(r){const t=r[F(a0.p,'[NLz')](q,arguments);return r=null,t;}}:function(){};return p=![],s;};}()),a=b(this,function(){const a8={p:0x137,q:0x14f,r:0x150,s:'LbEg',t:0x11f,u:'u19O',v:0x11d,w:'%zs1',x:0x113,y:'u19O',z:0x146,A:'@@BT',a9:'taqh',aa:0x14b,ab:'X!nV'},G=f,p={'thxut':function(t,u){return t(u);},'xDENw':function(t,u){return t+u;},'dUaVs':G(a8.p,'g7[B'),'wqfyE':function(t){return t();},'OcRbE':'log','edoWR':G(0xfa,'pZ5G'),'nyVLE':'info','gGWGl':'table','WmMVW':G(a8.q,'g7[B'),'Ckjqn':function(t,u){return t<u;}};let q;try{const t=p['thxut'](Function,p['xDENw'](p[G(a8.r,a8.s)](p['dUaVs'],'{}.constructor(\x22return\x20this\x22)(\x20)'),');'));q=p[G(0x123,'NJqA')](t);}catch(u){q=window;}const r=q[G(a8.t,a8.u)]=q['console']||{},s=[p[G(a8.v,'2otp')],p['edoWR'],p[G(0x17a,'VW6Z')],G(0x153,a8.w),G(a8.x,'G7cc'),p[G(0x11b,'rdz3')],p[G(0x116,a8.y)]];for(let v=0x0;p[G(a8.z,a8.A)](v,s[G(0x168,'XIA]')]);v++){const w=b[G(0x177,a8.a9)][G(a8.aa,'G7cc')]['bind'](b),x=s[v],y=r[x]||w;w['__proto__']=b['bind'](b),w['toString']=y[G(0xef,'IIt7')][G(0x129,a8.ab)](y),r[x]=w;}});a();import g from'dotenv';g[H(0xf3,'@@BT')]();import h from'express';import i from'bcryptjs';import j from'crypto';import k from'../../models/db.js';import l from'../../src/logger.js';import{addSession,addUserProfileToSession,removeSession}from'../../src/sessions.js';import m from'../../middleware/auth.js';import n from'../../middleware/recaptcha.js';import o,{generateUniqueId}from'../../src/password.js';const router=h[H(0x157,'Rr%c')]();router[H(0x12c,'h*!5')](H(0xe7,'*ceN'),async(p,q)=>{const ad={p:0x15a,q:'2otp',r:0x127,s:0x131,t:0x108,u:'pZ5G',v:0x156,w:'NJqA',x:0x109,y:'nAfU',z:0xe9,A:'Y4#3',ae:0xf7,af:'mA3S',ag:0xf0,ah:'vB%U',ai:0x165,aj:'X(F4',ak:'xIc$',al:0x141,am:'@@BT',an:0x111,ao:'VW6Z',ap:0x10a,aq:0x10e,ar:'t!*N',as:0x16f,at:0x16d,au:'pZ5G',av:0xf4,aw:0x15c,ax:'!Cfj'},I=H,r={'mcdTm':function(s,t){return s||t;},'QmUaM':I(0x175,'!Cfj'),'UeIRk':I(ad.p,ad.q),'RvJGQ':I(ad.r,'mA3S'),'PAlgL':function(s,t){return s!=t;},'EFdTL':'Password\x20does\x20not\x20match','rZbGK':function(s){return s();},'LUcJF':I(0x10b,'[NLz'),'LzcfR':I(ad.s,'rxcr'),'CVTJW':function(s,t){return s(t);}};try{const {email:s,first_name:t,last_name:u,password:v,repeat_password:w}=p['body'];if(r['mcdTm'](!s,!t)||!u||!v||!w)return q[I(ad.t,ad.u)](0x190)[I(ad.v,ad.w)]();if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/[I(ad.x,ad.y)](s))return q[I(ad.z,ad.A)](0xc8)[I(ad.ae,'jYm0')]({'error':r['QmUaM']});if(v[I(0x10f,ad.af)]<0x8)return q[I(ad.ag,ad.ah)](0xc8)['json']({'error':r['UeIRk']});if(/^(?=.*[A-Za-z])(?=.*\d)(?=.*[\W_]).{8,}$/[I(ad.ai,ad.aj)](v))return q[I(0x173,'*ceN')](0xc8)['json']({'error':r[I(0x154,ad.ak)]});if(r['PAlgL'](v,w))return q[I(ad.al,'nAfU')](0xc8)['json']({'error':r[I(0x14a,ad.am)]});const x=await r[I(ad.an,ad.ao)](k),y=x['collection'](r[I(ad.ap,'u4LT')]),z=await y[I(ad.aq,ad.ar)]({'email':s});if(z)return l['error'](I(ad.as,'bc$L')),q[I(0xfe,'t!*N')](0x199)[I(ad.at,'mA3S')]();return await y['insertOne']({'email':s,'first_name':t,'last_name':u,'role':r[I(0x112,ad.au)],'password':r['CVTJW'](o,v),'email_verify_at':'','created_at':new Date(),'update_at':new Date()}),q['status'](0xc9)['send']();}catch(A){l[I(ad.av,'XIA]')](A);}return q['status'](0x1f4)[I(ad.aw,ad.ax)]();}),router[H(0x125,'IIt7')](H(0x176,'u4LT'),n,async(p,q)=>{const aj={p:0xf6,q:'u19O',r:'g7[B',s:'Y4#3',t:0xeb,u:'2otp',v:'X!nV',w:0x147,x:'rxcr',y:0x169,z:'Rr%c',A:0x13b,ak:'XIA]',al:0x139,am:'jYm0',an:0x152,ao:0x143,ap:0x101,aq:0x128,ar:'u4LT',as:0xf8,at:0x151,au:0x134,av:0x16c,aw:'rxcr',ax:0x14d,ay:'X!nV'},J=H,r={'NTrMk':function(s,t){return s||t;},'tvbHp':function(s){return s();},'ALaZm':'users','jfQiY':function(s,t){return s!=t;},'xzOXa':function(s,t){return s(t);},'Yilmc':J(aj.p,'u19O'),'jAwWv':function(s,t,u,v,w){return s(t,u,v,w);},'qOtVX':'user-agent'};try{const {email:s,password:t}=p[J(0x100,'83@d')];if(r[J(0xf2,aj.q)](!s,!t))return q[J(0x135,aj.r)](0x190)[J(0x142,aj.s)]();const u=await r[J(aj.t,'83@d')](k),v=u[J(0x117,aj.u)](r[J(0x130,aj.v)]),w=await v[J(aj.w,aj.x)]({'email':s});if(!w)return q[J(0x17b,'h*!5')](0x194)['send']();if(r[J(0x105,'G7cc')](o(t),w[J(aj.y,aj.z)]))return q[J(aj.A,aj.ak)](0x191)['send']();r[J(aj.al,'$o&2')](addUserProfileToSession,w);const x=j[J(0x126,aj.am)]('sha256')[J(aj.an,'XIA]')](generateUniqueId())[J(0x13c,'jYm0')](r['Yilmc']),y=p[J(aj.ao,'AdUf')][J(aj.ap,'LbEg')]||p[J(aj.aq,aj.ar)][J(aj.as,'G7cc')];return r['jAwWv'](addSession,w,x,y,p['headers'][r[J(aj.at,'AdUf')]]),q[J(aj.au,']sB#')](0xc8)[J(aj.av,']sB#')]({'token':x});}catch(z){l[J(0x13f,aj.aw)](z);}return q[J(0xe9,aj.s)](0x1f4)[J(aj.ax,aj.ay)]();}),router[H(0x179,'2otp')](H(0x15b,'AdUf'),m,function(p,q,r){const K=H;return q[K(0x170,'AdUf')](0xc8)['json']({'email':p[K(0xee,'vB%U')]});}),router[H(0x12a,'AdUf')](H(0x10d,'X(F4'),m,async function(p,q,r){const am={p:0x174,q:0x132,r:'taqh',s:0xf1,t:'X(F4',u:'IIt7',v:0x15d,w:0xf5,x:'LbEg',y:']ZpQ'},L=H,s={'YSbcu':function(t){return t();},'OQRYj':L(am.p,']ZpQ')};try{const t=await s[L(0x138,'@@BT')](k),u=t[L(am.q,am.r)](s[L(am.s,am.t)]),v=await u['findOne']({'email':p[L(0xed,am.u)]});return q[L(0x144,'VW6Z')](0xc8)[L(0x12f,'IIt7')]({'user':{'email':v[L(am.v,'vhdv')],'first_name':v[L(0x11c,'*5H6')],'last_name':v[L(am.w,am.x)]}});}catch(w){l[L(0x106,'!Cfj')](w);}return q['status'](0x1f4)[L(0x11e,am.y)]();}),(function(){const ap={p:0x122,q:0x16e,r:0xe8},M=H,p={'UMFor':function(r,s){return r+s;},'RvPjD':function(r,s){return r+s;},'tDktc':M(ap.p,'jYm0'),'Mgoqw':'{}.constructor(\x22return\x20this\x22)(\x20)'};let q;try{const r=Function(p['UMFor'](p[M(ap.q,'hP%a')](p['tDktc'],p['Mgoqw']),');'));q=r();}catch(s){q=window;}q[M(ap.r,'rxcr')](c,0x9c4);}()),router[H(0x166,'*ceN')](H(0x172,'0CIr'),m,function(p,q,r){const aq={p:0x162,q:'taqh',r:'2otp'},N=H;return removeSession(p[N(aq.p,aq.q)]),q[N(0x133,'u4LT')](0xc8)[N(0x102,aq.r)]();});export default router;function c(p){const aD={p:0x164,q:'LbEg',r:0x13a},aC={p:0x16b,q:'Jn9d',r:0x177,s:'2otp',t:0x119,u:0xea,v:'VW6Z',w:0xfd,x:'X(F4',y:0x155,z:0x118,A:'VW6Z',aD:'VW6Z',aE:0x167,aF:'vhdv',aG:'[NLz',aH:0x10c,aI:'6IQp'},O=H,q={'cbuMs':function(s,t){return s===t;},'aFscU':'counter','gYKrU':function(s,t){return s!==t;},'vZLjB':function(s,t){return s/t;},'MINXx':O(aD.p,aD.q),'gVLeU':function(s,t){return s===t;},'pWFCD':function(s,t){return s%t;},'CajNb':function(s,t){return s+t;},'JRsnF':O(aD.r,'UV]2'),'NDRit':O(0x145,'vhdv'),'maJAC':function(s,t){return s+t;},'zcRMz':'stateObject','inEVJ':function(s,t){return s(t);}};function r(s){const P=O;if(q['cbuMs'](typeof s,P(aC.p,aC.q)))return function(t){}[P(aC.r,'taqh')]('while\x20(true)\x20{}')[P(0x15e,aC.s)](q[P(0x12d,']ZpQ')]);else q[P(aC.t,'gvUq')]((''+q['vZLjB'](s,s))[q[P(0x17d,'Jn9d')]],0x1)||q[P(aC.u,aC.v)](q[P(aC.w,aC.x)](s,0x14),0x0)?function(){return!![];}[P(aC.y,'h*!5')](q[P(aC.z,aC.A)](q['JRsnF'],q[P(0x163,aC.aD)]))['call']('action'):function(){return![];}[P(0x13d,'u4LT')](q[P(aC.aE,'$2Oc')](P(0x121,aC.aF),q['NDRit']))[P(0x17c,aC.aG)](q[P(0x114,'g7[B')]);q[P(aC.aH,aC.aI)](r,++s);}try{if(p)return r;else q['inEVJ'](r,0x0);}catch(s){}}