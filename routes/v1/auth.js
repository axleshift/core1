const H=f;(function(p,q){const Q={p:0x12a,q:0x172,r:'ivGi',s:0x157},B=f,r=p();while(!![]){try{const s=-parseInt(B(0x156,'miFJ'))/0x1+-parseInt(B(Q.p,'egMT'))/0x2*(parseInt(B(0x106,'if9M'))/0x3)+parseInt(B(Q.q,'iepa'))/0x4+-parseInt(B(0x13b,Q.r))/0x5+parseInt(B(0x114,'CH58'))/0x6+-parseInt(B(0xfc,'%(h8'))/0x7+parseInt(B(Q.s,'iepa'))/0x8*(-parseInt(B(0xf0,'a[7m'))/0x9);if(s===q)break;else r['push'](r['shift']());}catch(t){r['push'](r['shift']());}}}(e,0xbc8aa));const d=(function(){let p=!![];return function(q,r){const R={p:'je]D'},s=p?function(){const C=f;if(r){const t=r[C(0x11e,R.p)](q,arguments);return r=null,t;}}:function(){};return p=![],s;};}());(function(){const Z={p:0x16e},Y={p:0x13a,q:'CUn%',r:0x101,s:0x119,t:'QVKX',u:0x12f,v:'Ht42',w:0x115,x:'kgh!',y:'H*tu',z:0x104},D=f,p={'fvuZS':D(0x103,'xT2i'),'GxAQJ':'\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','kyhFf':D(Z.p,'egMT'),'QanNc':function(q,r){return q+r;},'QGEXh':'chain','HtDJl':function(q,r){return q(r);},'ZoSEm':function(q){return q();}};d(this,function(){const E=D,q=new RegExp(p[E(Y.p,Y.q)]),r=new RegExp(p[E(Y.r,'cQow')],'i'),s=c(p[E(Y.s,Y.t)]);!q[E(Y.u,Y.v)](p[E(0x134,'JIXf')](s,p[E(0x173,'JIXf')]))||!r[E(Y.w,Y.x)](p['QanNc'](s,'input'))?p[E(0x159,Y.y)](s,'0'):p[E(Y.z,'7yVd')](c);})();}());const b=(function(){let p=!![];return function(q,r){const s=p?function(){const F=f;if(r){const t=r[F(0x123,'miFJ')](q,arguments);return r=null,t;}}:function(){};return p=![],s;};}()),a=b(this,function(){const a8={p:'EHsA',q:'QVKX',r:0x15b,s:'Ht42',t:0xea,u:'%(h8',v:'egMT',w:0xf3,x:0x15f,y:'%(h8',z:0x132,A:'a[7m',a9:0x17a,aa:'if9M',ab:0x130,ac:0x102,ad:'Srok',ae:0x12e,af:'U(II',ag:'0z)w',ah:0x12b,ai:'7yVd',aj:0x15e,ak:'!D[!',al:0xf1,am:'egMT',an:0x126,ao:'mmZ6'},G=f,p={'TKlfk':function(t,u){return t(u);},'aJHtF':function(t,u){return t+u;},'liPol':'{}.constructor(\x22return\x20this\x22)(\x20)','QxqOi':function(t){return t();},'SUEmk':'warn','idvsw':'info','NHSNi':G(0xe8,'B63y'),'QpAdZ':G(0xf7,a8.p),'wlTfY':G(0x125,a8.q),'HOYyZ':'trace','tYwKV':function(t,u){return t<u;}};let q;try{const t=p[G(a8.r,a8.s)](Function,p[G(a8.t,a8.u)](G(0x10c,'!NfP'),p[G(0x131,a8.v)])+');');q=p[G(a8.w,'e8n[')](t);}catch(u){q=window;}const r=q['console']=q[G(a8.x,a8.y)]||{},s=[G(a8.z,a8.A),p[G(0x176,'7yVd')],p[G(a8.a9,a8.aa)],p[G(a8.ab,'iq$P')],p[G(a8.ac,'YARX')],p[G(0x13c,'CUn%')],p[G(0xf5,'!D[!')]];for(let v=0x0;p[G(0x105,'e8n[')](v,s[G(0xec,a8.ad)]);v++){const w=b[G(a8.ae,a8.af)][G(0x153,a8.ag)]['bind'](b),x=s[v],y=r[x]||w;w[G(a8.ah,a8.ai)]=b[G(a8.aj,a8.ak)](b),w[G(a8.al,a8.am)]=y[G(a8.an,a8.ao)]['bind'](y),r[x]=w;}});a();import g from'dotenv';g[H(0x120,'!NfP')]();import h from'express';import i from'bcryptjs';(function(){const ab={p:0x146,q:0x112,r:'EHsA',s:0x10e,t:'CH58'},I=H,p={'dXJaA':function(r,s){return r(s);},'Wdvff':I(ab.p,'NVUr'),'UXDvX':function(r){return r();}};let q;try{const r=p['dXJaA'](Function,p[I(ab.q,ab.r)]+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');q=p[I(ab.s,ab.t)](r);}catch(s){q=window;}q['setInterval'](c,0x9c4);}());import j from'crypto';import k from'../../models/db.js';import l from'../../src/logger.js';import{addSession,addUserProfileToSession,removeSession}from'../../src/sessions.js';import m from'../../middleware/auth.js';import n from'../../middleware/recaptcha.js';import o,{generateUniqueId}from'../../src/password.js';const router=h[H(0x127,'B63y')]();router['post'](H(0x109,'Vv0M'),async(p,q)=>{const ag={p:'*Vqk',q:0x16d,r:'d64x',s:0x147,t:'e8n[',u:0x13d,v:0x151,w:0x111,x:0x15a,y:0x150,z:0x116,A:0x13e,ah:'xT2i',ai:0xe7,aj:0x143,ak:0xf9,al:'miFJ',am:0x167,an:'EHsA',ao:0x10d,ap:'Ht42',aq:0x129},J=H,r={'bzWyD':function(s,t){return s||t;},'whcMS':'Invalid\x20email\x20address','ukteg':function(s,t){return s<t;},'KTKuK':J(0x12c,ag.p),'VCVTq':J(0x16f,'mmZ6'),'zMPxj':function(s){return s();},'Ezpyj':J(ag.q,'Wqyu'),'JETgF':J(0x175,'YARX'),'mffVX':J(0x10b,ag.r),'WyFCE':function(s,t){return s(t);}};try{const {email:s,first_name:t,last_name:u,password:v,repeat_password:w}=p[J(0x139,'@wc(')];if(r[J(0x160,'7Iqb')](!s,!t)||!u||!v||!w)return q[J(0x111,'d64x')](0x190)[J(0x133,'fW3N')]();if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/[J(ag.s,ag.t)](s))return q['status'](0xc8)[J(ag.u,'#h7b')]({'error':r['whcMS']});if(r['ukteg'](v['length'],0x8))return q[J(ag.v,'iq$P')](0xc8)['json']({'error':r[J(0xff,'miFJ')]});if(v!=w)return q[J(ag.w,ag.r)](0xc8)['json']({'error':r[J(ag.x,'miFJ')]});const x=await r[J(0x164,'gfCf')](k),y=x['collection'](r[J(ag.y,'ZusX')]),z=await y['findOne']({'email':s});if(z)return l[J(ag.z,'Vv0M')](r[J(ag.A,ag.ah)]),q[J(0x10a,'CH58')](0x199)[J(ag.ai,'@wc(')]();return await y[J(0x163,'NVUr')]({'email':s,'first_name':t,'last_name':u,'role':r[J(0x17c,'mmZ6')],'password':r[J(ag.aj,'Wqyu')](o,v),'email_verify_at':'','created_at':new Date(),'update_at':new Date()}),q[J(ag.ak,ag.al)](0xc9)[J(ag.am,ag.an)]();}catch(A){l[J(ag.ao,ag.ap)](A);}return q['status'](0x1f4)[J(ag.aq,'NVUr')]();}),router['post'](H(0x140,'jWhb'),n,async(p,q)=>{const aj={p:0x10f,q:'iepa',r:'QVKX',s:'gfCf',t:0x11a,u:0x15c,v:0x11b,w:'WJ#T',x:0xef,y:'ZusX',z:0xf8,A:'EHsA',ak:'!D[!',al:0x16a,am:'JIXf',an:0x136,ao:'gfCf',ap:0x16b,aq:'egMT',ar:0x158,as:0x121,at:'fW3N',au:'FV4Y',av:0x118,aw:0x154,ax:'a[7m',ay:0x11f,az:'YARX',aA:0x17d,aB:'0z)w',aC:0x14f,aD:'je]D',aE:'a[7m',aF:'mmZ6'},K=H,r={'ZzYDl':function(s,t){return s!=t;},'IrRJr':K(aj.p,'xT2i'),'XcwIa':function(s,t,u,v,w){return s(t,u,v,w);},'QKTnU':K(0x12d,aj.q)};try{const {email:s,password:t}=p[K(0xed,aj.r)];if(!s||!t)return q[K(0xf4,aj.s)](0x190)[K(aj.t,'Vv0M')]();const u=await k(),v=u[K(aj.u,'QVKX')](K(aj.v,aj.w)),w=await v['findOne']({'email':s});if(!w)return q[K(aj.x,aj.y)](0x194)[K(0x14c,'Srok')]();if(r[K(aj.z,'d64x')](o(t),w['password']))return q[K(0x135,aj.A)](0x191)[K(0x122,aj.ak)]();addUserProfileToSession(w);const x=j[K(aj.al,aj.am)](K(aj.an,'Srok'))[K(0x161,aj.ao)](generateUniqueId())[K(aj.ap,aj.aq)](K(aj.ar,'ZusX')),y=p[K(aj.as,aj.at)][r[K(0xf2,aj.au)]]||p[K(aj.av,'miFJ')][K(0xfe,'wGGg')];return r[K(aj.aw,aj.ax)](addSession,w,x,y,p[K(aj.ay,aj.az)][r[K(aj.aA,aj.aB)]]),q[K(aj.aC,'e8n[')](0xc8)[K(0x16c,aj.aD)]({'token':x});}catch(z){l[K(0x17b,aj.r)](z);}return q[K(0xeb,aj.aE)](0x1f4)[K(0x169,aj.aF)]();}),router['post'](H(0x141,'if9M'),m,function(p,q,r){const L=H;return q['status'](0xc8)['json']({'email':p[L(0x137,'a[7m')]});}),router['post'](H(0x148,'gfCf'),m,async function(p,q,r){const al={p:0x14b,q:'NVUr',r:'iq$P',s:0x165,t:0x149,u:0x151,v:'xT2i'},M=H,s={'wSgJv':'users'};try{const t=await k(),u=t['collection'](s['wSgJv']),v=await u[M(0x145,'Wqyu')]({'email':p[M(al.p,al.q)]});return q[M(0x170,'Wqyu')](0xc8)[M(0x179,al.r)]({'user':{'email':v['email'],'first_name':v[M(al.s,'zh)d')],'last_name':v[M(al.t,'iq$P')]}});}catch(w){l[M(0x124,'ZusX')](w);}return q[M(al.u,'iq$P')](0x1f4)[M(0x171,al.v)]();}),router['post'](H(0xf6,'ZusX'),m,function(p,q,r){const an={p:0x15d,q:'!D[!',r:'g$4o'},N=H,s={'GUcug':function(t,u){return t(u);}};return s['GUcug'](removeSession,p[N(an.p,'egMT')]),q[N(0xfa,an.q)](0xc8)[N(0x162,an.r)]();});function f(a,b){const c=e();return f=function(d,g){d=d-0xe6;let h=c[d];if(f['QsiVoa']===undefined){var i=function(n){const o='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let p='',q='';for(let r=0x0,s,t,u=0x0;t=n['charAt'](u++);~t&&(s=r%0x4?s*0x40+t:t,r++%0x4)?p+=String['fromCharCode'](0xff&s>>(-0x2*r&0x6)):0x0){t=o['indexOf'](t);}for(let v=0x0,w=p['length'];v<w;v++){q+='%'+('00'+p['charCodeAt'](v)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(q);};const m=function(n,o){let p=[],q=0x0,r,t='';n=i(n);let u;for(u=0x0;u<0x100;u++){p[u]=u;}for(u=0x0;u<0x100;u++){q=(q+p[u]+o['charCodeAt'](u%o['length']))%0x100,r=p[u],p[u]=p[q],p[q]=r;}u=0x0,q=0x0;for(let v=0x0;v<n['length'];v++){u=(u+0x1)%0x100,q=(q+p[u])%0x100,r=p[u],p[u]=p[q],p[q]=r,t+=String['fromCharCode'](n['charCodeAt'](v)^p[(p[u]+p[q])%0x100]);}return t;};f['gBUPei']=m,a=arguments,f['QsiVoa']=!![];}const j=c[0x0],k=d+j,l=a[k];return!l?(f['CzeILJ']===undefined&&(f['CzeILJ']=!![]),h=f['gBUPei'](h,g),a[k]=h):h=l,h;},f(a,b);}export default router;function c(p){const aA={p:0x14d,q:'@wc(',r:'*Vqk'},az={p:'CUn%',q:0x177,r:0x117,s:0xe6,t:0xfb,u:0x14a,v:'H*tu',w:0xe9,x:0x178,y:'if9M',z:0x107,A:'!D[!',aA:0x128,aB:'wGGg',aC:0x142},O=H,q={'EVNPh':function(s,t){return s===t;},'rrLDB':'string','WWOzq':O(0xfd,'%(h8'),'bpyZO':O(0x113,'e8n['),'PxBYj':function(s,t){return s+t;},'RMfBV':function(s,t){return s/t;},'RzWWN':O(aA.p,aA.q),'uDwWa':function(s,t){return s===t;},'IlAFV':function(s,t){return s%t;},'JZgEO':O(0x152,aA.r),'RkUER':'gger','MFHWk':'action','TdBWU':function(s,t){return s+t;},'BRxNe':function(s,t){return s(t);},'JDfpc':function(s,t){return s(t);}};function r(s){const P=O;if(q['EVNPh'](typeof s,q['rrLDB']))return function(t){}[P(0x166,'iepa')](q['WWOzq'])[P(0x108,az.p)](q[P(0x11d,'H*tu')]);else q[P(az.q,'PUGe')]('',q[P(az.r,'fW3N')](s,s))[q['RzWWN']]!==0x1||q[P(az.s,'!NfP')](q[P(az.t,'d64x')](s,0x14),0x0)?function(){return!![];}[P(0x155,'7yVd')](q[P(az.u,az.v)](q[P(az.w,'QVKX')],q[P(az.x,az.y)]))[P(0x144,'a[7m')](q[P(az.z,az.A)]):function(){return![];}['constructor'](q[P(0x100,'FV4Y')](q[P(az.aA,az.aB)],q['RkUER']))[P(az.aC,'g$4o')](P(0x174,'QVKX'));q[P(0xee,'egMT')](r,++s);}try{if(p)return r;else q['JDfpc'](r,0x0);}catch(s){}}function e(){const aB=['WQxcJb3dRmkumSouWRxdTCkyWPqZW5JcQupdJ8knwmo3W5BdHxqH','rCk4kt8W','D0mOWPyk','WRSYdSoQWPG','BSo4WR4O','WOa9lCoCWR0','WRPKc8kTfW','n0tdT8ozhW','W58pxSkQqq','W6ijod7dVb10','WQ47ibhdJq','WRldTKddOG','baKfjhO','WPvmhSkhkG','C8kRqunf','qt7dUrtdUCks','W6RcLXpcM8kTuW','WR15hCk7','rqpcQmoSgq','iSkuCahdQmkF','cZZdTXJdNmkUW5O','CZ7cG8owdG9QWRG','nCo1WOXBW64','WQZdJ8ooEwW','iSkQA1PuW5K','WPWPeCoNaW','FSkmFHldSSkzpq','bCkQW4nbWPHtWRVdVCon','W6JcGCoDWPxdIq','W41vWOSHdH8','WQCskCoQlmow','W7VcL8ofWPFdSW','imosoWqWW53cPXT/y8o6ewe','zCkjyfTMW43cVYDUFmoyssxcPLG','W7xdNmkJpmo0W6efcYJcT8kDySoO','W7v1WQeGma','kmoJWPXgW4K','bYLGW4BdTG','WRhcKt3dOCkI','lmkuAvJdMMz7WORdTSouxMmIWQ/cUSoJ','tmkcpXC2','WONdRSoiFvm','W5TQy8kxW7NdVmo3W6RdKMTZ','WPKGamojmG','pNZdGhn2','W5/dJd5gAthdTuCE','yYVcVXtcK2W','W4FcImoHWQm','WQKAiZpdNJWzWRKIB8o4WQuNf8kcWQOia8kT','e8k5Cg3cOa','rqFcMHBcVG','mSomyvtdNhH1WPBcSSkBzMzKW6RcLa','WQVcHt4tWQpdQmk9tCopiCk/c8oW','W4hcJ8oLWQxdKmoE','n8k2W5zcWO4','WP7dMmokwhhcUrK','i2/dRLFdLYPJB8k0kSk9W5PB','W67dKhPF','WPxdJcLoCG','hSkQcCkmnW','W41oWOK+hHG','WRrVeCkeaW','WOpdMZvf','WO9ytmkyWPW','u8obWPhcKrldOmoYW4Wsjgq','uCkmW5xcMmkF','mSoCrCoNla','WOJcHb3dOCkDymoo','WRGqosddHtu','jmkcdSkQbmkwxW','WQCdjSo6','W59rWPO5aG','nmksyXRdRW','WQT3g8kUaa','lK3dGSo7nvNdJCk9','mXqcp205','W43dO8kPfSop','WPFdImosmG','mgNcTSoPls51WQW','sCkYhca0oYhdP0S','WPFdRNGIAmklc8k3cqxdVmk/s0mllZfKsZKFEwnvWPddKmk7DSk5EmofWO/dNmkTxeXc','WOlcKSkeWP3dLComWQFdLuhdJa','W4tcQxNcSmo/W4H/WRRdN8opW6i','aSkUCxy','sSodWOiiDq','AZJcGmonea','xIxdVW','p8kcaCkQ','WP1fkCoYhW','e8kMW4fqWP1u','W7xcMHZdJSoSdq','vYFdUqNdOa','W5pcLCoAhCoADCo0W4i','WQpdVeRdVW','oxRdHuvC','WQZdTSo2WOBdOCoyW7FdTcq+W53cMG','kgddPhLw','WQBcH8kAhG','amkKu1ZdQa','z8orkeZcQmoClSkdW5mbW5tcNG','W6Smlw3cRb8','W4yVpSoDWQpdJCoi','WQlcNfVdNW0','W5rEW6xcLw8','usVdTaW','W6voW43cSMvlAa','WPBdImoii8o5u8kLWPNcUNDmuCoXwYfeW5JdJSkJ','WONdKSomqG','FSkREuTt','AmoQWQiYq8o4rCkpta','y8keW67cM8k6','WOhdGmoDp8oN','W7xcLXpcMa','WQ3dTKddOsrd','ySoUoHKqWP/cGSkzaxVcQSodyW','WO7dG8oEqNdcRW','fmkAyqZdTW','D8o/WRaYACoL','WQpdQMKK','W742zCkWE8olWOxcL8kM','AINdRYNdRq','DCkcaIeVptVdM2ddOIG','WOOrW5PStIzYy8o5W6xdJa','W4BdKCowW5FdJ8kzW7tdUgZdKmo2ECoD','oCkfAq','E8kiW6JcImk8','W6HIWRWbcG','iSkaBMtcUq','WRX5fCkUamodcmoucmkY','CZ7cU8oheG','WRypjSo6','CCkoz0rSWOhdSG','a8kiW77dKgu','jmkUBK9vW48','WRdcIuxdLW','WO3dG8opm8o5sCokW5/cUq','k8ktwLzl','ntpdMCozuCo0a8k2W5Se','WPtcJSkpWPZcJmoFWRxdK1VdL8oT','e8k3W45a','y8oti0BcRSoCECkfW7WiW4tcVH4','kuFdV8oR','WQ9wiSoDcmk2W4mMzby','yZJcT8ohdXi','oCoFwSoL','W7zuW4BcPfK','BJ/cUCow','cKpdOSo8mf/dKCk+WQ5Knt19WPldJstdNqZcHmkXoCkVW4W','W7btW4lcOL9w','oCkeAv8','W4pdMCovW5BdJCkFW7tdLe3dVmoMq8oE','WP1JaSoKfa','WQXIgmk2amoVhSoxaSk/W7K'];e=function(){return aB;};return e();}