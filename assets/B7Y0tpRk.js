import{r as l,R as E,j as e}from"./D3kDgYDB.js";import{R as P}from"./D0iU1EWp.js";import{F as d,P as S,Q as R,R as T,S as z,T as D}from"./C794Y7R5.js";import{a as F,V as m,b as h}from"./Davggtsm.js";import{E as u}from"./URk2IvX2.js";import{C as $,G as B,H as y,n as V,R as o,P as b,N as G}from"./CIQNY0Wj.js";import"./CNSOrHVr.js";import"./WyM-ksIe.js";import"./dB90dn3U.js";import"./Dw8pycEM.js";import"./8JwjhRSi.js";import"./o5tV6Bm-.js";import"./CWoBZRFf.js";import"./tpRZQFqq.js";import"./CzFDRTuY.js";import"./CQ-yZ3vu.js";import"./BmHAl9XU.js";import"./B6-gGlhp.js";import"./DzfTGk6K.js";import"./hKczlkOd.js";import"./CXnULsF_.js";import"./CCb-kr4I.js";import"./Cz0CWeBA.js";import"./Cp7XljvA.js";import"./BQBsAJpH.js";import"./DRFurTTo.js";import"./BZxJdD1U.js";const xe=()=>{const[x,n]=l.useState(!0),p=E.useRef(),[f,g]=l.useState(!0),[k,W]=l.useState(!1),[r,c]=l.useState({token:"",whitelist_ip:[]}),A=()=>{g(t=>!t)},j=async()=>{try{await navigator.clipboard.writeText(r),alert("API Key copied!")}catch(t){console.log(t),alert("Failed... no idea why.")}},w=async()=>{n(!0);const t=await p.current.executeAsync(),a=new FormData;a.append("recaptcha_ref",t),await axios.post(`${m}/api/v1/auth/token/new`,a,{headers:{Authorization:`Bearer ${cookies.get(h)}`}}).then(s=>c(i=>({...i,token:s.data.token}))).catch(s=>{console.error(s);const i=u[s.status]||"Internal Application Error";alert(i)}).finally(()=>n(!1))},v=async()=>{await axios.get(`${m}/api/v1/auth/token/`,{headers:{Authorization:`Bearer ${cookies.get(h)}`}}).then(t=>{t.data.error||c(t.data)}).catch(t=>{console.error(t);const a=u[t.status]||"Internal Application Error";alert(a)}).finally(()=>n(!1))},C=()=>{if(!Array.isArray(r.whitelist_ip))return c(t=>({...t,whitelist_ip:[""]}));if(r.whitelist_ip.length<6)return c(t=>({...t,whitelist_ip:[...t.whitelist_ip,""]}));alert("Max number of whitelisted ip address reached")},_=(t,a)=>{const s=[...r.whitelist_ip];s[t]=a,c(i=>({...i,whitelist_ip:s}))},I=async t=>{t.preventDefault(),n(!0);const a=await p.current.executeAsync(),s=new FormData;s.append("whitelist_ip",r.whitelist_ip),s.append("recaptcha_ref",a),await axios.post(`${m}/api/v1/auth/token/whitelist-ip`,s,{headers:{Authorization:`Bearer ${cookies.get(h)}`}}).then(i=>{if(i.data.error)return alert(i.data.error);alert("done")}).catch(i=>{console.error(i);const N=u[i.status]||"Internal Application Error";alert(N)}).finally(()=>n(!1))};return l.useEffect(()=>{v()},[]),e.jsxs("div",{children:[x&&e.jsx("div",{className:"loading-overlay",children:e.jsx($,{color:"primary",variant:"grow"})}),e.jsx(P,{ref:p,size:"invisible",sitekey:F}),!x&&e.jsxs(B,{xs:{cols:1},sm:{cols:2},children:[e.jsxs(y,{children:[e.jsx("h4",{children:"Auth token"}),!r.token&&e.jsx("div",{className:"text-center border rounded mb-4",children:e.jsxs("div",{className:"p-1 p-md-5 my-5 my-md-0",children:[e.jsx(V,{src:"/images/threat.png",fluid:!0,width:"50%"}),e.jsx("h4",{children:"There was no Auth Token"}),e.jsx(o,{color:"primary",size:"sm",onClick:w,children:"Generate Token"})]})}),r.token&&e.jsx("div",{className:"text-center border rounded mb-4",children:e.jsxs("div",{className:"p-2 p-md-3",children:[e.jsxs("div",{className:"d-flex mb-3",children:[e.jsx(b,{className:f?"blurred":"",value:r.token,"aria-describedby":"basic-addon"}),e.jsx(o,{className:"ms-2",onClick:A,children:e.jsx(d,{icon:f?S:R})}),e.jsx(o,{className:"ms-2",onClick:j,children:e.jsx(d,{icon:T})})]}),e.jsx(o,{color:"primary",size:"sm",onClick:w,children:"Generate new token"})]})})]}),e.jsxs(y,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h4",{children:"Ip address"}),e.jsxs(o,{color:"success",size:"sm",className:"text-white",onClick:C,disabled:k,children:[e.jsx(d,{icon:z})," Create"]})]}),r.whitelist_ip.length===0&&e.jsx("div",{className:"text-center border rounded mb-4",children:e.jsx("div",{className:"p-2 p-md-3 my-5 my-md-0",children:e.jsx("h6",{children:"There was no Whitelisted IP Addresses"})})}),r.whitelist_ip.length!==0&&e.jsx("div",{className:"text-center border rounded mb-4",children:e.jsx("div",{className:"p-2 p-md-3",children:e.jsxs(G,{onSubmit:I,children:[r.whitelist_ip.map((t,a)=>e.jsxs("div",{className:"d-flex mb-2",children:[e.jsx(b,{value:t,onChange:s=>_(a,s.target.value),placeholder:`192.168.0.${a+1}`}),e.jsx(o,{color:"danger",className:"text-white ms-2",onClick:j,children:e.jsx(d,{icon:D})})]},a)),e.jsx(o,{type:"submit",color:"primary",className:"d-block me-2 rounded",children:"Save changes"})]})})})]})]})]})};export{xe as default};
