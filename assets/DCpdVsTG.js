import{j as e,r as s,R as i}from"./B29SdWEC.js";import{P as t}from"./E8MUDNEF.js";import"./BQRwqC_R.js";import{g as r,i as a,o as n,q as o,a as l,b as d,c}from"./CvTj7SuE.js";import{g as h,h as m,i as p,j as x,k as u,l as f,m as g,a as y}from"./Nht5C_EB.js";import{p as j}from"./2aPQtUzY.js";import{F as v,P as b,Q as w,D as N,l as S}from"./DvQY7fCG.js";import{P as _,B as k,I,F as R,O as B}from"./BQJNo7iP.js";import{c as q,Q as z}from"./DP5U83K8.js";let C=r(a({apiKey:g,authDomain:f,projectId:u,storageBucket:x,messagingSenderId:p,appId:m,measurementId:h}));const U=({threadsID:s,selectedUser:i,handleSelectUser:t,isMobile:r})=>e.jsx("div",{className:"border-end",style:{width:r?"100%":"30%",overflowY:"auto",height:r?"100%":"auto"},children:s.map((s=>e.jsxs("div",{onClick:()=>t(s),className:`${(null==i?void 0:i.sender_id)===s.sender_id&&"bg-body-secondary"} d-flex align-items-center px-3 py-2 border-bottom`,style:{cursor:"pointer",transition:"all 0.2s ease"},children:[e.jsx("div",{className:"bg-primary rounded-pill me-3 d-flex justify-content-center align-items-center text-white",style:{width:"36px",height:"36px"},children:s.sender_id.slice(0,1).toUpperCase()}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("div",{className:`${(null==i?void 0:i.sender_id)===s.sender_id&&"fw-bold"}`,style:{fontSize:"14px"},children:s.sender_id.slice(0,6).toUpperCase()}),e.jsx("div",{style:{fontSize:"11px"},className:"text-muted",children:j(s.timestamp)})]})]},s.sender_id)))});U.propTypes={threadsID:t.arrayOf(t.shape({id:t.string.isRequired,timestamp:t.oneOfType([t.string,t.number]).isRequired})).isRequired,selectedUser:t.shape({sender_id:t.string}),handleSelectUser:t.func.isRequired,isMobile:t.bool.isRequired};const M=({isOpen:t,messagesRef:r,selectedUser:a,handleBackToList:c,isMobile:h,showBackButton:m})=>{const[p,x]=s.useState([]),[u,f]=s.useState(""),[g,q]=s.useState(!1),z=i.useRef(null),{user:C}=y();s.useEffect((()=>{if(!a)return;const e=n(o(r,l("timestamp")),(e=>{const s=e.docs.map((e=>({id:e.id,...e.data()}))).filter((e=>e.sender_id===a.sender_id));x(s)}));return()=>e()}),[a]),s.useEffect((()=>{z.current&&z.current.scrollIntoView({behavior:"smooth"})}),[p,a]);const U=e.jsxs(_,{id:"popover-basic",style:{maxWidth:"300px"},children:[e.jsx(_.Header,{as:"h3",children:"Quick Messages"}),e.jsx(_.Body,{children:e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto"},children:["When will my shipment be dispatched?","What documents are required for customs clearance?","Can you confirm the estimated arrival date of my freight?","How can I update the delivery address or contact details?","Are there any special handling instructions I should be aware of?","How do I schedule a pickup for my next shipment?","What are the charges for expedited shipping?","Can I track my shipment in real-time?","What should I do if my shipment is delayed?","Are there any restrictions on the type of goods I can ship?","How do I file a claim for a damaged shipment?","What are the weight and size limits for freight shipments?","Can I request a specific delivery time for my shipment?","What payment methods do you accept for freight services?","How do I cancel or reschedule a shipment?"].map(((s,i)=>e.jsx("div",{className:"p-2 mb-1 border-bottom",style:{cursor:"pointer"},onClick:()=>(f(s),void q(!1)),children:s},i)))})})]}),M=e=>e.role===C.role;return e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",height:h?"100%":"auto"},children:a?e.jsxs("div",{className:"d-flex flex-column justify-content-between h-100",children:[e.jsxs("div",{className:"d-flex align-items-center px-2 py-1 m-1 rounded bg-body-secondary",children:[m&&e.jsx(k,{variant:"link",onClick:c,children:e.jsx(v,{icon:b})}),e.jsx("div",{className:"bg-primary fw-bold rounded-pill me-2 d-flex justify-content-center align-items-center text-white",style:{width:"40px",height:"40px"},children:a.sender_id.slice(0,1).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h4",{style:{margin:0,fontSize:h?"16px":"18px"},children:a.sender_id.slice(0,6).toUpperCase()}),e.jsx("div",{className:"text-muted",style:{fontSize:"13px"},children:a.sender_id})]})]}),e.jsxs("div",{className:"flex-grow-1 p-3",style:{overflowY:"auto"},children:[p.map(((s,i)=>e.jsxs("div",{style:{textAlign:M(s)?"right":"left",marginBottom:"12px"},children:[e.jsx("div",{className:(M(s)?"bg-primary":"bg-body-secondary")+" text-white rounded p-2",style:{display:"inline-block",maxWidth:h?"85%":"80%",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",position:"relative",wordBreak:"break-word"},children:e.jsx("div",{style:{fontSize:h?"13px":"14px"},children:s.message})}),e.jsx("div",{style:{fontSize:"11px",color:"gray",marginTop:"4px",textAlign:M(s)?"right":"left",paddingLeft:M(s)?"0":"12px",paddingRight:M(s)?"12px":"0"},children:j(s.timestamp)})]},i))),e.jsx("div",{ref:z})]}),e.jsx("div",{className:"mt-2",children:e.jsxs(I,{className:"mt-2",children:[e.jsx(R,{as:"textarea",placeholder:"Type a message...",value:u,className:"border-primary border",onChange:e=>f(e.target.value),style:{padding:"10px",resize:"none",minHeight:"45px",maxHeight:"45px",overflowY:"auto",fontSize:"12px"}}),"user"===C.role&&e.jsx(B,{trigger:"click",placement:"top",overlay:U,rootClose:!0,children:e.jsx(k,{style:{height:"45px"},children:e.jsx(v,{icon:w})})}),e.jsx(k,{style:{height:"45px"},onClick:async()=>{""!==u.trim()&&a&&(await d(r,{message:u,role:C.role,timestamp:Date.now(),sender_id:a.sender_id}),f(""))},children:e.jsx(v,{icon:N})})]})})]}):e.jsxs("div",{className:"d-flex justify-content-center align-items-center h-100 flex-column",children:[e.jsx("div",{className:"bg-primary rounded-pill d-flex justify-content-center align-items-center mb-3",style:{width:"70px",height:"70px"},children:e.jsx(v,{icon:S,size:"2x"})}),e.jsx("p",{children:"Select a user to view conversation"})]})})};M.propTypes={isOpen:t.bool,messagesRef:t.object.isRequired,selectedUser:t.shape({sender_id:t.string.isRequired}),handleBackToList:t.func.isRequired,isMobile:t.bool.isRequired,showBackButton:t.bool.isRequired};const O=({float:i,isOpen:t})=>{const[r,a]=s.useState(!0),[d,h]=s.useState(null),[m,p]=s.useState(!1),[x,u]=s.useState(!0),[f,g]=s.useState([]),{user:j}=y(),v=c(C,"messages");s.useEffect((()=>{if(!j._id)return;j&&!d&&i&&h({sender_id:j.ref});const e=n(o(v,l("timestamp")),(e=>{const s=new Map;let i=[];e.docs.forEach((e=>{const t={id:e.id,...e.data()};i.includes(t.ref)||(s.set(t.ref,t),i.push(t.ref))}));const t=Array.from(s.values());g(t),a(!1)})),s=()=>{p(window.innerWidth<768)};return s(),window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s),e()}}),[j]);return r?e.jsx("div",{className:"loading-overlay",children:e.jsx(q,{color:"primary",variant:"grow"})}):v?e.jsx("div",{className:"mb-3",children:e.jsx(z,{children:e.jsxs("div",{className:"d-flex",style:{height:m?"calc(100vh - 180px)":i?"40vh":"70vh",flexDirection:m?"column":"row"},children:["user"!==(null==j?void 0:j.role)&&(!m||m&&x)&&!i&&e.jsx(U,{threadsID:f,selectedUser:d,handleSelectUser:e=>{h(e),m&&u(!1)},isMobile:m}),("user"===(null==j?void 0:j.role)||!m||m&&!x)&&e.jsx(M,{isOpen:t,messagesRef:v,selectedUser:d||("user"===j.role?j:null),handleBackToList:()=>{m&&u(!0)},isMobile:m,showBackButton:m&&"user"!==(null==j?void 0:j.role)})]})})}):e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"70vh"},children:e.jsx("p",{children:"No messages yet"})})};O.propTypes={float:t.bool,isOpen:t.bool};const T=Object.freeze(Object.defineProperty({__proto__:null,default:O},Symbol.toStringTag,{value:"Module"}));export{O as M,C as d,T as i};
