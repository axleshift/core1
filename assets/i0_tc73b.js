import{r as c,R as w,j as e}from"./D3kDgYDB.js";import{F as A,G as N}from"./CUO9jjoX.js";import{R as S}from"./D0iU1EWp.js";import{u as P}from"./CQ-yZ3vu.js";import{b as h,a as R,V as f}from"./DaXf0fpO.js";import{E as _}from"./URk2IvX2.js";import{d as b}from"./o5tV6Bm-.js";import{c as I,C as k,K as T,L as B,S as $,T as D,U as F,l as L,n as O,R as z}from"./BRioXSKG.js";import"./CNSOrHVr.js";import"./WyM-ksIe.js";import"./dB90dn3U.js";import"./Dw8pycEM.js";import"./8JwjhRSi.js";import"./BmHAl9XU.js";import"./CWoBZRFf.js";import"./tpRZQFqq.js";import"./CzFDRTuY.js";import"./B6-gGlhp.js";import"./DzfTGk6K.js";import"./hKczlkOd.js";import"./CXnULsF_.js";import"./CCb-kr4I.js";import"./Cz0CWeBA.js";import"./Cp7XljvA.js";import"./BQBsAJpH.js";import"./DRFurTTo.js";import"./BZxJdD1U.js";const he=()=>{const[g,l]=c.useState(!1),[p,d]=c.useState({error:!1,message:""}),[i,x]=c.useState(["","","","","",""]),m=cookies.get(h),o=b(),u=w.useRef();P();const y=async()=>{if(m===void 0)return o("/login");await axios.post(`${f}/api/v1/auth/verify`,{},{headers:{Authorization:`Bearer ${m}`}}).then(r=>{if(r.data.is_email_verified)return o("/")}).catch(r=>{if(!r.response)return console.error(r);cookies.remove(h),o("/login")})};c.useEffect(()=>{y()},[o]);const j=(r,t)=>{const a=r.target.value.replace(/[^0-9]/g,"");if(a.length<=1){const s=[...i];s[t]=a,a&&t<5&&document.getElementById(`otp-input-${t+1}`).focus(),x(s)}},v=(r,t)=>{r.key==="Backspace"&&!i[t]&&t>0&&document.getElementById(`otp-input-${t-1}`).focus()},C=async r=>{r.preventDefault(),l(!0);const t=await u.current.executeAsync(),a=new FormData;a.append("otp",i),a.append("recaptcha_ref",t),await axios.post(`${f}/api/v1/auth/verify/otp`,a,{headers:{Authorization:`Bearer ${m}`}}).then(s=>{if(s.data.error)return d({error:!0,message:s.data.error});const n=new URLSearchParams(window.location.search),E=n.get("n")?n.get("n"):"/";o(E)}).catch(s=>{console.error(s);const n=_[s.status]||"Internal Application Error";d({error:!0,message:n})}).finally(()=>l(!1))};return e.jsxs("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:[e.jsx("div",{className:"auth-bg"}),e.jsxs(I,{children:[g&&e.jsx("div",{className:"loading-overlay",children:e.jsx(k,{color:"primary",variant:"grow"})}),e.jsx(T,{className:"justify-content-center",children:e.jsx(B,{md:8,lg:6,xl:5,children:e.jsx($,{className:"p-1 p-md-4 shadow",children:e.jsxs(D,{children:[p.error&&e.jsxs(F,{color:"danger",className:"d-flex align-items-center",children:[e.jsx(A,{className:"flex-shrink-0 me-2",icon:N,size:"xl"}),e.jsx("div",{children:p.message})]}),e.jsxs(L,{onSubmit:C,children:[e.jsx("h1",{children:"OTP"}),e.jsx("p",{className:"text-body-secondary",children:"Enter the 6digit code that was sent to your email address."}),e.jsx(S,{ref:u,size:"invisible",sitekey:R}),e.jsx("div",{className:"d-flex justify-content-center gap-2 mb-3",children:i.map((r,t)=>e.jsx(O,{type:"text",id:`otp-input-${t}`,value:r,onChange:a=>j(a,t),onKeyDown:a=>v(a,t),className:"otp-input",maxLength:"1"},t))}),e.jsx(z,{type:"submit",color:"primary",className:"me-2 rounded",children:"Submit"})]})]})})})})]})]})};export{he as default};
