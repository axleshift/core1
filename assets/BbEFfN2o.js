import{r as s,R as e,j as i}from"./Oq9P1Wj_.js";import{R as t}from"./eGqyD3ZN.js";import{F as a,H as r,G as l,Z as c,q as n,_ as o}from"./DiHbz8XT.js";import{b as d,d as h}from"./CSDaq6gO.js";import{E as m}from"./BGB82IPO.js";import{p as j}from"./BzOa6JrD.js";import{c as p,a as x,b as f,r as u,L as w,M as y,P as b,O as v}from"./By8a_4rn.js";import"./deeEeel3.js";import"./NdsU5MZw.js";import"./BXWkExu4.js";import"./C5ktbw-a.js";import"./c0eKk1Db.js";import"./Ce_fjdqS.js";import"./CewSaW8v.js";import"./DvQD94mg.js";import"./DhxmCZ7v.js";import"./fHQ1LRrH.js";import"./CUvxBZEH.js";import"./CA9sZ-Z2.js";import"./YLYDLWv3.js";import"./ChytwAMd.js";import"./Dn-qDmp9.js";import"./XtWrBBVz.js";import"./BXEMiIsG.js";import"./B60PFSOe.js";import"./DoV6T4jL.js";import"./CDdQWEAe.js";import"./BqHrj3jM.js";const N=()=>{const{addToast:N}=d(),[k,_]=s.useState(!0),g=e.useRef(),[S,A]=s.useState(!0),[C,P]=s.useState(!1),[O,z]=s.useState({token:"",whitelist_ip:[]}),I=async()=>{try{await navigator.clipboard.writeText(O),N("API Key copied!")}catch(s){N("Failed... no idea why.")}},R=async()=>{_(!0);const s=await g.current.executeAsync();axios.post("/auth/token/new",{recaptcha_ref:s}).then((s=>z((e=>({...e,token:s.data.token}))))).catch((s=>{const e=m[s.status]||"Server is offline or restarting please wait";N(e)})).finally((()=>_(!1)))};return s.useEffect((()=>{(async()=>{axios.get("/auth/token/").then((s=>z(s.data))).catch((s=>{const e=m[s.status]||"Server is offline or restarting please wait";N(e)})).finally((()=>_(!1)))})()}),[]),i.jsxs("div",{children:[k&&i.jsx("div",{className:"loading-overlay",children:i.jsx(p,{color:"primary",variant:"grow"})}),i.jsx(t,{ref:g,size:"invisible",sitekey:h}),!k&&!O.token&&i.jsx(x,{className:"justify-content-center my-5",children:i.jsx(f,{md:6,children:i.jsxs("div",{className:"clearfix",children:[i.jsx("h1",{className:"float-start display-3 me-4",children:"OOPS"}),i.jsx("h4",{children:"You have not generate a token yet."}),i.jsx(u,{color:"primary",size:"sm",onClick:R,children:"Generate Token"})]})})}),!k&&O.token&&i.jsxs(x,{xs:{cols:1},sm:{cols:2},children:[i.jsxs(f,{className:"mb-3",children:[i.jsx("h4",{children:"Auth token"}),i.jsx(w,{children:i.jsxs(y,{children:[i.jsxs("div",{className:"d-flex mb-3",children:[i.jsx(b,{className:S?"blurred":"",value:O.token,"aria-describedby":"basic-addon"}),i.jsx(u,{className:"ms-2",onClick:()=>{A((s=>!s))},children:i.jsx(a,{icon:S?r:l})}),i.jsx(u,{className:"ms-2",onClick:I,children:i.jsx(a,{icon:c})})]}),i.jsx(u,{color:"primary",size:"sm",onClick:R,children:"New token"})]})})]}),i.jsxs(f,{className:"mb-3",children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx("h4",{children:"Whitelisted IP"}),i.jsxs(u,{size:"sm",className:"text-white",onClick:()=>Array.isArray(O.whitelist_ip)?O.whitelist_ip.length<6?z((s=>({...s,whitelist_ip:[...s.whitelist_ip,""]}))):void N("Max number of whitelisted ip address reached"):z((s=>({...s,whitelist_ip:[""]}))),disabled:C,children:[i.jsx(a,{icon:n})," Add"]})]}),O.whitelist_ip&&0===O.whitelist_ip.length&&i.jsx(w,{className:"mb-3",children:i.jsx(y,{className:"justify-content-center m-3",children:i.jsxs("div",{className:"clearfix",children:[i.jsx("h1",{className:"float-start display-3 me-4",children:"OOPS"}),i.jsx("h4",{children:"There was no Whitelisted IP Addresses."}),i.jsx("p",{children:"Add new one to begin"})]})})}),O.whitelist_ip&&0!==O.whitelist_ip.length&&i.jsx(w,{className:"mb-3",children:i.jsx(y,{children:i.jsxs(v,{onSubmit:async s=>{s.preventDefault(),_(!0);const e=await g.current.executeAsync();axios.post("/auth/token/whitelist-ip",{whitelist_ip:O.whitelist_ip.toString(),recaptcha_ref:e}).then((s=>{if(s.data.error)return N(s.data.error);N("Your changes has been saved.")})).catch((s=>{const e=m[s.status]||"Server is offline or restarting please wait";N(e)})).finally((()=>_(!1)))},children:[O.whitelist_ip.map(((s,e)=>i.jsxs("div",{className:"d-flex mb-2",children:[i.jsx(b,{value:s,onChange:s=>((s,e)=>{const i=[...O.whitelist_ip];i[s]=e,z((s=>({...s,whitelist_ip:i})))})(e,s.target.value),placeholder:`192.168.0.${e+1}`}),i.jsx(u,{color:"danger",className:"text-white ms-2",onClick:I,children:i.jsx(a,{icon:o})})]},e))),i.jsx(u,{size:"sm",type:"submit",color:"primary",className:"d-block me-2 rounded",children:"Save changes"})]})})}),i.jsx("h4",{children:"Last accessed"}),i.jsx(w,{children:i.jsxs(y,{children:[i.jsx("p",{className:"display-5",children:O.last_accessed?j(O.last_accessed):"Never"}),i.jsx("span",{className:"lead",children:O.user_agent})]})})]})]})]})};export{N as default};
