import{r as e,R as t,j as s}from"./_LxKj9PG.js";import{R as i}from"./CD8lARB7.js";import{F as r,a,a2 as o}from"./GO_KNHZp.js";import{b as l,e as n}from"./DTlazO7w.js";import"./kEzgLQ3J.js";import{d as m}from"./BJRa5TG-.js";import{d as c,T as p,U as j,a as d,Q as h,R as u}from"./slvTtaAp.js";import"./C_9exQ7i.js";import"./Itq7e1c5.js";import"./BGnBE-TB.js";import"./c7OvE8pj.js";import"./yJGO6Amu.js";import"./BIw_sdFo.js";import"./tRrjmjzN.js";import"./BFk34ZWe.js";import"./lcqsW1nY.js";import"./DIrOWF5t.js";import"./D74OPSAh.js";import"./COFYN2eQ.js";import"./BJtv0x2K.js";import"./CjjZDEdp.js";import"./K-dupnmX.js";import"./ZZM5rHs7.js";import"./Dw1DiDGf.js";import"./YiBEvX-Q.js";import"./rRm29nvs.js";import"./CzGuHLZU.js";import"./B8Let_61.js";import"./CZm-rpfG.js";import"./fZjk1EK6.js";import"./BXEMiIsG.js";import"./Bb7MnDjl.js";import"./CA9thugF.js";import"./BPjVUy-D.js";import"./C_n0TLp5.js";import"./DYPlXUME.js";import"./BqHrj3jM.js";const x=()=>{const x=m(),{addToast:w}=l(),[f,y]=e.useState(!1),[v,g]=e.useState(!1),_=t.useRef(),[k,b]=e.useState({note:"",whitelist_ip:[""]});return f?s.jsx("div",{className:"loading-overlay",children:s.jsx(c,{color:"primary",variant:"grow"})}):s.jsxs(p,{onSubmit:async e=>{e.preventDefault();const t=await _.current.executeAsync();y(!0),axios.post("/auth/token/new",{...k,recaptcha_ref:t}).then((e=>{if(e.data.error)return w(e.data.error);x("/security/access-token"),setTimeout((()=>{x("/security/access-token",{state:{token:e.data.token}})}),1500)})).catch((e=>{var t,s;const i=(null==(s=null==(t=e.response)?void 0:t.data)?void 0:s.error)||("network error"===e.message?"Server is offline or restarting please wait":e.message);w(i)})).finally((()=>y(!1)))},children:[s.jsx(i,{ref:_,size:"invisible",sitekey:n}),s.jsx("h4",{children:"New Access Token"}),s.jsx("p",{className:"text-muted",children:"This can be used to authenticate with the API via HTTPS."}),s.jsx(j,{type:"text",id:"note",name:"note",label:"Note",value:k.note,onChange:e=>b({...k,note:e.target.value})}),s.jsx("small",{className:"text-muted",children:"Whats this token for?"}),s.jsxs("div",{className:"mt-3",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx("h4",{children:"Whitelist IP"}),s.jsxs(d,{size:"sm",className:"text-white ms-auto",onClick:()=>Array.isArray(k.whitelist_ip)?k.whitelist_ip.length<6?b((e=>({...e,whitelist_ip:[...e.whitelist_ip,""]}))):void w("Max number of whitelisted ip address reached"):b((e=>({...e,whitelist_ip:[""]}))),disabled:v,children:[s.jsx(r,{icon:a})," Add"]})]}),k.whitelist_ip&&0!==k.whitelist_ip.length&&s.jsx(h,{className:"mb-3",children:s.jsx(u,{children:k.whitelist_ip.map(((e,t)=>s.jsxs("div",{className:"d-flex mb-2",children:[s.jsx(j,{value:e,onChange:e=>((e,t)=>{const s=[...k.whitelist_ip];s[e]=t,b((e=>({...e,whitelist_ip:s})))})(t,e.target.value),placeholder:`192.168.0.${t+1}`}),s.jsx(d,{color:"danger",className:"text-white ms-2",onClick:e=>(e=>{if(1===k.whitelist_ip.length)return void w("Cannot delete the only IP address in the whitelist");const t=k.whitelist_ip.filter(((t,s)=>s!==e));b((e=>({...e,whitelist_ip:t})))})(t),children:s.jsx(r,{icon:o})})]},t)))})}),s.jsxs("div",{className:"d-flex mt-4",children:[s.jsx(d,{type:"submit",color:"primary",className:"me-2 rounded",children:"Generate"}),s.jsx(d,{type:"button",color:"outline-secondary",className:"rounded",onClick:e=>x("/security/access-token"),children:"Cancel"})]})]})};export{x as default};
