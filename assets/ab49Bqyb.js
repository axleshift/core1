import{R as s,r as e,j as r}from"./_LxKj9PG.js";import{F as a,B as t,J as o,K as i,L as d}from"./B3Nt1-ra.js";import{R as p}from"./CD8lARB7.js";import{a as l,d as n}from"./BIYEItPQ.js";import{d as c,b as j,c as m,Q as x,R as w,S as h,T as u,X as g,Y as f,U as v,a as b}from"./slvTtaAp.js";import"./C_9exQ7i.js";import"./Itq7e1c5.js";import"./BGnBE-TB.js";import"./c7OvE8pj.js";import"./yJGO6Amu.js";import"./BIw_sdFo.js";import"./BJRa5TG-.js";import"./tRrjmjzN.js";import"./BFk34ZWe.js";import"./lcqsW1nY.js";import"./DIrOWF5t.js";import"./D74OPSAh.js";import"./COFYN2eQ.js";import"./BJtv0x2K.js";import"./CjjZDEdp.js";import"./K-dupnmX.js";import"./ZZM5rHs7.js";import"./Dw1DiDGf.js";import"./YiBEvX-Q.js";import"./rRm29nvs.js";import"./CzGuHLZU.js";import"./B8Let_61.js";import"./CZm-rpfG.js";import"./fZjk1EK6.js";import"./BXEMiIsG.js";import"./Bb7MnDjl.js";import"./CA9thugF.js";import"./BPjVUy-D.js";import"./C_n0TLp5.js";import"./DYPlXUME.js";import"./BqHrj3jM.js";const S=()=>{const{user:S}=l(),y=s.useRef(),[C,N]=e.useState(!1),[k,_]=e.useState({password:"",new_password:"",repeat_password:""}),[A,R]=e.useState(!1),[K,q]=e.useState(!1),[z,O]=e.useState({error:!1,message:""}),P=s=>{const{id:e,value:r}=s.target;_((s=>({...s,[e]:r})))},F=[{id:1,text:"At least 8 characters",test:s=>s.length>=8},{id:2,text:"At least one uppercase letter",test:s=>/[A-Z]/.test(s)},{id:3,text:"At least one lowercase letter",test:s=>/[a-z]/.test(s)},{id:4,text:"At least one number",test:s=>/[0-9]/.test(s)},{id:5,text:"At least one special character",test:s=>/[!@#$%^&*(),.?":{}|<>]/.test(s)}],H=s=>F.map((e=>({...e,passed:e.test(s)}))),[J,Y]=e.useState(H(k.new_password));return r.jsxs("div",{children:[C&&r.jsx("div",{className:"loading-overlay",children:r.jsx(c,{color:"primary",variant:"grow"})}),r.jsx(p,{ref:y,size:"invisible",sitekey:n}),r.jsxs(j,{xs:{cols:1},sm:{cols:2},children:[r.jsxs(m,{children:[r.jsxs("h4",{children:["OK"===S.password?"Change":"Set"," Password"]}),r.jsx(x,{className:"mb-3",children:r.jsxs(w,{children:[z.error&&r.jsxs(h,{color:"danger",className:"d-flex align-items-center",children:[r.jsx(a,{className:"flex-shrink-0 me-2",icon:t,size:"xl"}),r.jsx("div",{children:z.message})]}),r.jsxs(u,{onSubmit:async s=>{s&&s.preventDefault();const e=await y.current.executeAsync();N(!0),axios.post("/auth/password",{...k,recaptcha_ref:e}).then((s=>{if(s.data.error)return O({error:!0,message:s.data.error});window.location.reload()})).catch((s=>{var e,r;const a=(null==(r=null==(e=s.response)?void 0:e.data)?void 0:r.error)||("network error"===s.message?"Server is offline or restarting please wait":s.message);O({error:!0,message:a})})).finally((()=>N(!1)))},children:["OK"===S.password&&r.jsxs(g,{className:"mb-3",children:[r.jsx(f,{children:r.jsx(a,{icon:o})}),r.jsx(v,{id:"password",type:A?"text":"password",placeholder:"Password",autoComplete:"current-password",value:k.password,onChange:s=>P(s),required:!0}),r.jsx(f,{children:r.jsx("span",{onClick:s=>R(!A),"aria-label":A?"Hide password":"Show password",children:r.jsx(a,{icon:A?i:d,onClick:s=>R(!A)})})})]}),r.jsxs(g,{className:"mb-3",children:[r.jsx(f,{children:r.jsx(a,{icon:o})}),r.jsx(v,{id:"new_password",type:K?"text":"password",placeholder:"New Password",autoComplete:"new-password",value:k.new_password,onChange:s=>(s=>{P(s),"new_password"===s.target.id&&Y(H(s.target.value))})(s),required:!0}),r.jsx(f,{children:r.jsx("span",{onClick:s=>q(!K),"aria-label":K?"Hide password":"Show password",children:r.jsx(a,{icon:K?i:d,onClick:s=>q(!K)})})})]}),r.jsx("ul",{children:J.map((s=>r.jsx("li",{style:{color:s.passed?"green":"red"},children:s.text},s.id)))}),r.jsxs(g,{className:"mb-3",children:[r.jsx(f,{children:r.jsx(a,{icon:o})}),r.jsx(v,{id:"repeat_password",type:"password",placeholder:"Repeat password",autoComplete:"new-password",value:k.repeat_password,onChange:s=>P(s),required:!0})]}),r.jsx(b,{type:"submit",color:"primary",className:"d-block me-2 rounded",children:"Save changes"})]})]})})]}),r.jsx(m,{})]})]})};export{S as default};
