import{r as e,R as s,j as t}from"./_LxKj9PG.js";import{R as i}from"./CD8lARB7.js";import{F as r,a,a2 as o}from"./B3Nt1-ra.js";import{b as l,d as n}from"./BIYEItPQ.js";import"./DDOxyIcP.js";import{d as m}from"./BJRa5TG-.js";import{d as c,T as p,U as d,a as j,Q as h,R as u}from"./slvTtaAp.js";import"./C_9exQ7i.js";import"./Itq7e1c5.js";import"./BGnBE-TB.js";import"./c7OvE8pj.js";import"./yJGO6Amu.js";import"./BIw_sdFo.js";import"./tRrjmjzN.js";import"./BFk34ZWe.js";import"./lcqsW1nY.js";import"./DIrOWF5t.js";import"./D74OPSAh.js";import"./COFYN2eQ.js";import"./BJtv0x2K.js";import"./CjjZDEdp.js";import"./K-dupnmX.js";import"./ZZM5rHs7.js";import"./Dw1DiDGf.js";import"./YiBEvX-Q.js";import"./rRm29nvs.js";import"./CzGuHLZU.js";import"./B8Let_61.js";import"./CZm-rpfG.js";import"./fZjk1EK6.js";import"./BXEMiIsG.js";import"./Bb7MnDjl.js";import"./CA9thugF.js";import"./BPjVUy-D.js";import"./C_n0TLp5.js";import"./DYPlXUME.js";import"./BqHrj3jM.js";const x=()=>{const x=m(),{addToast:w}=l(),[f,y]=e.useState(!1),[v,g]=e.useState(!1),_=s.useRef(),[b,k]=e.useState({note:"",whitelist_ip:[""]});return f?t.jsx("div",{className:"loading-overlay",children:t.jsx(c,{color:"primary",variant:"grow"})}):t.jsxs(p,{onSubmit:async e=>{e.preventDefault();const s=await _.current.executeAsync();y(!0),axios.post("/auth/token/new",{...b,recaptcha_ref:s}).then((e=>{if(e.data.error)return w(e.data.error);x("/security/access-token"),setTimeout((()=>{x("/security/access-token",{state:{token:e.data.token}})}),1500)})).catch((e=>{var s,t;const i=(null==(t=null==(s=e.response)?void 0:s.data)?void 0:t.error)||("network error"===e.message?"Server is offline or restarting please wait":e.message);w(i)})).finally((()=>y(!1)))},children:[t.jsx(i,{ref:_,size:"invisible",sitekey:n}),t.jsx("h4",{children:"New Access Token"}),t.jsx("p",{className:"text-muted",children:"This can be used to authenticate with the API via HTTPS."}),t.jsx(d,{type:"text",id:"note",name:"note",label:"Note",value:b.note,onChange:e=>k({...b,note:e.target.value})}),t.jsx("small",{className:"text-muted",children:"Whats this token for?"}),t.jsxs("div",{className:"mt-3",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("h4",{children:"Whitelist IP"}),t.jsxs(j,{size:"sm",className:"text-white ms-auto",onClick:()=>Array.isArray(b.whitelist_ip)?b.whitelist_ip.length<6?k((e=>({...e,whitelist_ip:[...e.whitelist_ip,""]}))):void w("Max number of whitelisted ip address reached"):k((e=>({...e,whitelist_ip:[""]}))),disabled:v,children:[t.jsx(r,{icon:a})," Add"]})]}),b.whitelist_ip&&0!==b.whitelist_ip.length&&t.jsx(h,{className:"mb-3",children:t.jsx(u,{children:b.whitelist_ip.map(((e,s)=>t.jsxs("div",{className:"d-flex mb-2",children:[t.jsx(d,{value:e,onChange:e=>((e,s)=>{const t=[...b.whitelist_ip];t[e]=s,k((e=>({...e,whitelist_ip:t})))})(s,e.target.value),placeholder:`192.168.0.${s+1}`}),t.jsx(j,{color:"danger",className:"text-white ms-2",onClick:e=>(e=>{if(1===b.whitelist_ip.length)return void w("Cannot delete the only IP address in the whitelist");const s=b.whitelist_ip.filter(((s,t)=>t!==e));k((e=>({...e,whitelist_ip:s})))})(s),children:t.jsx(r,{icon:o})})]},s)))})}),t.jsxs("div",{className:"d-flex mt-4",children:[t.jsx(j,{type:"submit",color:"primary",className:"me-2 rounded",children:"Generate"}),t.jsx(j,{type:"button",color:"outline-secondary",className:"rounded",onClick:e=>x("/security/access-token"),children:"Cancel"})]})]})};export{x as default};
