import{R as s,r as e,j as r}from"./B29SdWEC.js";import{F as a,z as t,G as o,H as i,I as l}from"./DkRsNtTr.js";import{R as d}from"./Cri8ushB.js";import{a as p,d as n}from"./BG-LqvoV.js";import{c,a as m,b as j,Q as x,R as w,S as h,T as u,X as g,Y as f,U as v,i as b}from"./CdjBIvmN.js";import"./ucIcx5RQ.js";import"./E8MUDNEF.js";import"./4RmQ9_ev.js";import"./CIdotNGq.js";import"./yJGO6Amu.js";import"./BIw_sdFo.js";import"./BFKNndIN.js";import"./BjhGVRpM.js";import"./BFk34ZWe.js";import"./BmTZu7tj.js";import"./CxXfFpkk.js";import"./DPENoFOj.js";import"./Ba2eFa9Y.js";import"./B1ETHe3Q.js";import"./CjjZDEdp.js";import"./K-dupnmX.js";import"./CLdVYh6z.js";import"./DPAjA2jz.js";import"./OBe_9qlD.js";import"./BXEMiIsG.js";import"./Bb7MnDjl.js";import"./CA9thugF.js";import"./BPjVUy-D.js";import"./C_n0TLp5.js";import"./DYPlXUME.js";import"./BqHrj3jM.js";const S=()=>{const{user:S}=p(),y=s.useRef(),[C,_]=e.useState(!1),[N,k]=e.useState({password:"",new_password:"",repeat_password:""}),[A,R]=e.useState(!1),[z,P]=e.useState(!1),[q,H]=e.useState({error:!1,message:""}),F=s=>{const{id:e,value:r}=s.target;k((s=>({...s,[e]:r})))},I=[{id:1,text:"At least 8 characters",test:s=>s.length>=8},{id:2,text:"At least one uppercase letter",test:s=>/[A-Z]/.test(s)},{id:3,text:"At least one lowercase letter",test:s=>/[a-z]/.test(s)},{id:4,text:"At least one number",test:s=>/[0-9]/.test(s)},{id:5,text:"At least one special character",test:s=>/[!@#$%^&*(),.?":{}|<>]/.test(s)}],K=s=>I.map((e=>({...e,passed:e.test(s)}))),[O,Y]=e.useState(K(N.new_password));return r.jsxs("div",{children:[C&&r.jsx("div",{className:"loading-overlay",children:r.jsx(c,{color:"primary",variant:"grow"})}),r.jsx(d,{ref:y,size:"invisible",sitekey:n}),r.jsxs(m,{xs:{cols:1},sm:{cols:2},children:[r.jsxs(j,{children:[r.jsxs("h4",{children:["OK"===S.password?"Change":"Set"," Password"]}),r.jsx(x,{className:"mb-3",children:r.jsxs(w,{children:[q.error&&r.jsxs(h,{color:"danger",className:"d-flex align-items-center",children:[r.jsx(a,{className:"flex-shrink-0 me-2",icon:t,size:"xl"}),r.jsx("div",{children:q.message})]}),r.jsxs(u,{onSubmit:async s=>{s&&s.preventDefault();const e=await y.current.executeAsync();_(!0),axios.post("/auth/password",{...N,recaptcha_ref:e}).then((s=>{if(s.data.error)return H({error:!0,message:s.data.error})})).catch((s=>{var e,r;const a=(null==(r=null==(e=s.response)?void 0:e.data)?void 0:r.error)||("network error"===s.message?"Server is offline or restarting please wait":s.message);H({error:!0,message:a})})).finally((()=>_(!1)))},children:["OK"===S.password&&r.jsxs(g,{className:"mb-3",children:[r.jsx(f,{children:r.jsx(a,{icon:o})}),r.jsx(v,{id:"password",type:A?"text":"password",placeholder:"Password",autoComplete:"current-password",value:N.password,onChange:s=>F(s),required:!0}),r.jsx(f,{children:r.jsx("span",{onClick:s=>R(!A),"aria-label":A?"Hide password":"Show password",children:r.jsx(a,{icon:A?i:l,onClick:s=>R(!A)})})})]}),r.jsxs(g,{className:"mb-3",children:[r.jsx(f,{children:r.jsx(a,{icon:o})}),r.jsx(v,{id:"new_password",type:z?"text":"password",placeholder:"New Password",autoComplete:"new-password",value:N.new_password,onChange:s=>(s=>{F(s),"new_password"===s.target.id&&Y(K(s.target.value))})(s),required:!0}),r.jsx(f,{children:r.jsx("span",{onClick:s=>P(!z),"aria-label":z?"Hide password":"Show password",children:r.jsx(a,{icon:z?i:l,onClick:s=>P(!z)})})})]}),r.jsx("ul",{children:O.map((s=>r.jsx("li",{style:{color:s.passed?"green":"red"},children:s.text},s.id)))}),r.jsxs(g,{className:"mb-3",children:[r.jsx(f,{children:r.jsx(a,{icon:o})}),r.jsx(v,{id:"repeat_password",type:"password",placeholder:"Repeat password",autoComplete:"new-password",value:N.repeat_password,onChange:s=>F(s),required:!0})]}),r.jsx(b,{type:"submit",color:"primary",className:"d-block me-2 rounded",children:"Save changes"})]})]})})]}),r.jsx(j,{})]})]})};export{S as default};
