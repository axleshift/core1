const K=f;(function(p,q){const S={p:0x23d,q:0x236,r:'6[Br',s:'vvoT',t:0x22f,u:'Bk8i',v:'Gdgp',w:']i!o'},B=f,r=p();while(!![]){try{const s=-parseInt(B(0x215,'VCo6'))/0x1*(-parseInt(B(S.p,'0eSX'))/0x2)+parseInt(B(0x25c,'%2gS'))/0x3+-parseInt(B(S.q,S.r))/0x4*(-parseInt(B(0x21a,S.s))/0x5)+-parseInt(B(S.t,S.u))/0x6+parseInt(B(0x205,']i!o'))/0x7+-parseInt(B(0x243,'yrrs'))/0x8*(parseInt(B(0x1d9,S.v))/0x9)+-parseInt(B(0x256,S.w))/0xa;if(s===q)break;else r['push'](r['shift']());}catch(t){r['push'](r['shift']());}}}(e,0xc7a7c),(function(){const X={p:0x1ee,q:'5e3Z'},W={p:0x262,q:0x265,r:'K6Bd',s:0x1d4,t:'dhjs'},C=f,p={'RLWWR':function(s,t){return s(t);},'FBCuX':function(s,t){return s+t;},'RrJli':function(s,t){return s+t;},'qpXVB':C(X.p,'uJqg')},q=function(){const D=C;let s;try{s=p[D(0x26b,'zK3Q')](Function,p[D(0x208,'edK3')](p[D(W.p,'m)q7')](D(W.q,W.r),p[D(W.s,W.t)]),');'))();}catch(t){s=window;}return s;},r=q();r[C(0x263,X.q)](c,0x9c4);}()));const d=(function(){let p=!![];return function(q,r){const s=p?function(){const E=f;if(r){const t=r[E(0x255,'aa8B')](q,arguments);return r=null,t;}}:function(){};return p=![],s;};}());function f(a,b){const c=e();return f=function(d,g){d=d-0x1ce;let h=c[d];if(f['vnGpEH']===undefined){var i=function(n){const o='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let p='',q='';for(let r=0x0,s,t,u=0x0;t=n['charAt'](u++);~t&&(s=r%0x4?s*0x40+t:t,r++%0x4)?p+=String['fromCharCode'](0xff&s>>(-0x2*r&0x6)):0x0){t=o['indexOf'](t);}for(let v=0x0,w=p['length'];v<w;v++){q+='%'+('00'+p['charCodeAt'](v)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(q);};const m=function(n,o){let p=[],q=0x0,r,t='';n=i(n);let u;for(u=0x0;u<0x100;u++){p[u]=u;}for(u=0x0;u<0x100;u++){q=(q+p[u]+o['charCodeAt'](u%o['length']))%0x100,r=p[u],p[u]=p[q],p[q]=r;}u=0x0,q=0x0;for(let v=0x0;v<n['length'];v++){u=(u+0x1)%0x100,q=(q+p[u])%0x100,r=p[u],p[u]=p[q],p[q]=r,t+=String['fromCharCode'](n['charCodeAt'](v)^p[(p[u]+p[q])%0x100]);}return t;};f['cbUSZz']=m,a=arguments,f['vnGpEH']=!![];}const j=c[0x0],k=d+j,l=a[k];return!l?(f['lwNWKk']===undefined&&(f['lwNWKk']=!![]),h=f['cbUSZz'](h,g),a[k]=h):h=l,h;},f(a,b);}(function(){const a8={p:0x222,q:'vRJQ'},a7={p:'K6Bd',q:0x234,r:0x245,s:'tE7k',t:'88t$'},F=f,p={'Gqxmo':F(a8.p,'Vq^@'),'oVhTy':F(0x1e8,'5S*9'),'kfHOx':function(q,r){return q(r);},'lgPkA':F(0x1da,'zK3Q'),'QiBHP':function(q,r){return q+r;},'qgEoH':'chain','WOgAJ':F(0x1f8,'edK3'),'QhzGn':function(q,r){return q(r);},'bSPcl':function(q){return q();},'bqqvl':function(q,r,s){return q(r,s);}};p[F(0x1e6,a8.q)](d,this,function(){const G=F,q=new RegExp(p[G(0x268,a7.p)]),r=new RegExp(p[G(0x219,'f]9f')],'i'),s=p[G(a7.q,'f]9f')](c,p[G(a7.r,a7.s)]);!q['test'](p['QiBHP'](s,p[G(0x202,a7.t)]))||!r['test'](s+p[G(0x1ec,'vQ8S')])?p['QhzGn'](s,'0'):p[G(0x246,'b)$8')](c);})();}());const b=(function(){let p=!![];return function(q,r){const s=p?function(){const H=f;if(r){const t=r[H(0x254,'Fq4#')](q,arguments);return r=null,t;}}:function(){};return p=![],s;};}()),a=b(this,function(){const aj={p:0x216,q:0x244,r:'m)q7',s:'lwB)',t:0x264,u:'s]yu',v:0x241,w:'tE7k',x:0x238,y:'yrrs',z:0x24b,A:'uJqg',ak:0x1f3,al:0x25d,am:'ZHjF',an:0x258,ao:'vQ8S',ap:0x235,aq:'jJFs',ar:0x21b,as:0x23f,at:'orey',au:0x261,av:0x251,aw:'9Xwu',ax:0x25b,ay:0x201},ai={p:0x1db,q:'6[Br',r:'YkJ)',s:0x20e},I=f,p={'jNHZz':function(u,v){return u(v);},'HTVGG':function(u,v){return u+v;},'Ewrum':function(u,v){return u+v;},'ieEMP':'return\x20(function()\x20','aoZdt':I(aj.p,'q4mp'),'fmjWu':function(u){return u();},'VVDnC':I(aj.q,aj.r),'HmGrj':'error','pPUje':I(0x1dd,aj.s),'IFivY':I(aj.t,aj.u),'oMSJy':I(aj.v,aj.w),'ObHHt':function(u,v){return u<v;}},q=function(){const J=I;let u;try{u=p[J(ai.p,'qDhb')](Function,p[J(0x212,ai.q)](p[J(0x260,ai.r)](p[J(ai.s,'VCo6')],p['aoZdt']),');'))();}catch(v){u=window;}return u;},r=p['fmjWu'](q),s=r[I(aj.x,aj.y)]=r['console']||{},t=[p[I(0x23b,'Gk!b')],I(aj.z,aj.A),I(aj.ak,'[xDD'),p[I(aj.al,aj.am)],p[I(0x23a,'jJFs')],p[I(aj.an,aj.ao)],p['oMSJy']];for(let u=0x0;p[I(0x1f2,'0eSX')](u,t[I(aj.ap,aj.aq)]);u++){const v=b[I(aj.ar,'5e3Z')][I(aj.as,aj.at)]['bind'](b),w=t[u],x=s[w]||v;v[I(aj.au,'g%vz')]=b[I(aj.av,aj.aw)](b),v[I(aj.ax,'Fq4#')]=x[I(0x214,'m)q7')][I(aj.ay,'IW8W')](x),s[w]=v;}});function e(){const aK=['WQuXfsbuzdJcUsFdHmkiWP9v','aehcH8oKWRS','W4CSdmo2r8kRqSkMW4W','WOf1EmoMsq','qGvmofRcUSo/WQ0tWONcHG','FmkGbmosW6i','W6NdRueY','WPjDW4dcPYS','W7CAW77dSeu','WPfSy8oDiWpcUq','gHZcTSkYW7ykxg7dG8oysSkAWRe','W6OmW4mjWQ/cVq','W4iCjq7dIW','tSk+WO5Ylq','E8kYrrBdKq','W5bSW6LzW6q4fhaEWOvN','vMFdQ8oFs2lcK8kzWQ/cGmo9bmo1pHK','W5lcSCozW5ZdVG','W4WYjtO','WPtcJCo9WQFdGW','W7igW6JdTG','WPiFWRtcSwS','W51dBX3cOG','WP7cV8oBFHq','WQtdSvWZDG','WOxcTxWtW7NcMCo/xW','W4ZcR8oGWPpdUCkrkG','W5HLWQzoW64zbw4jWPnWudW9W4lcT0ffySo7jGeVW4ZcQ1ysxXZcOYP0','WRWzAatcLge','WRFcMmolW70','iCo+WRrmuW','fvKsmMBcSCooWR4E','W5S4od3dSSoaiSoaW6RdUmkW','DSkAg8kR','WPrQy8okgb/cQu7dJhul','WPJcTfWcW7NcHmoEvSo+','EX5Mla','WPxcGZVdTW','E8kzWQnJ','WPyjW6VdI8o5x8oxW7JcUx9lW7qeW77dJ8oN','WP3cU1WtW5tcNSoWvCo+','AZrzf8k3','WOFcGYZdUG','WP7cH8owWPNdP8kObwVdQhlcQa','s0FdQ8oTWQ5F','WRipWRtcKKG','wdKOWO8','WQrbWOldQmo6','W6NdQCklh8ks','WRjhWPhdS8o9oa','WRHPsx4ki34','WQqjWQFcIu9y','bh53W5pdV8kuW70SBxddGSkEW40','WRdcMSooW61J','oSoiW71tbhPSW6eC','b17dOmo5WQ5EfW','W4SLW5hdQeW','jCooWPrxuG','W5JcQtBdRmokmq','W6ddNSk8d2pcQxLIiWL6','WPtcGrBdT8kT','ESkIc8oiW6hcGaC','iSonWRj/xKS','W4tcNa3dOCoB','n8kAW4KsyG','wmkVvIRdOG','WRzCWQpcUWhdVu/cKGj7WQpdMW','WPJdUq0cWPO','WQxcHCoaW7bGW7pcMLNdIq','WRuhWO7cTfy','W6n3r3Oa','WQTxvmo9qq','k8o5vCoVW7/cHILmBq','WP3cTuG','W7TIDNiK','W77dICk+dSkn','WO3cOSo4W6jz','W7eDW4mzWR/cVmoQ','gdnVWRFcGIaV','W5KsdsG','fmkbWRFdVq','sSkSWOL0iq','W5xdJt5K','WONcNSoDWRRdHa','W5XHW5SB','WOZcQ8oQWRldKq','WQSayGe','WP9GDq','FcxdUmoexgC','W4tdKJ18WPG','g2NcP8oAWPm','hrRcVmkYW7aixL7dLmoyqmkIWP8','WRWAArFcKW','jCk1iSkhsG','WOCuW6ZdHmoOfSkqW6ldQYbYW7ueWQ/dRG','W5hcSCk2kv/cIa','W5hdJr5KWPm6nCk7','W4tdLgRcU8oyAcZdKCoyW6zHFfi','W5hcSSooW4/dGa','W7XnW5ZcVG','W6rGsh0','W6PZW4CkWQC','WQXatmo9ymkMACkjW6O','WQpcQgulW6i','W4SYiGFdQmogmSorW6JdTSkU','tCkdyWNdOa','xc/dUCofs3VdKSodWQ3cKmo3sSoNoarVW4hcISkb','v8kDntnQWQSmoZlcTmk7W6jh','WOCCWRxcJK1eWPbNW5KSW43cSftdV8okW6bDWQNdT8kxW4xcPmkU','AtVdTCoDvG','WPFcM8oxWOq','W7fzW5BcOG','W4OyF8khW7G','W7/cTSo7W47dNSkZn8onW7RcLW','pmksomkczmolW701fgFdS1LQySkBy3uiuCoHamoYqSoXxWqElSkYdmk8xYOwmCkeWR4','WRmDzsRcKq','emkuWQtdP8orhW','Cmkmemk9','W4ldU8kfwh3cLW','mmkCW6JdQ1i','WP4wWOpcV3q','pCoCWR1Sx1a','W7ddKftdUwq','WRtcT04oW6FdKmo4xmk7Bmo/tCk3WRNdH8kuW5NdMNxcK8k4FhO','W6vkW5lcPh0g','qt4MWPxcUCox','W7eDW7RdTKpcUG','swKUW67dG3elW6NcP8k3WRJcQW','W7e6qCkK','EYnbgmkJ','W6vBW53cTa','b8oxB28TW69visq','WPZdUW8bWPe','WORdRbmk','WRqsWQRcKv9iWPzQWPyM','xtTJfmkm','W6mkW6/dQ1NcPW','W6yBAqlcIxFcIwaV','WOrXF8oqaGO','W5CcvZtcOq','WRumWRFcI1y','kmkkpCocW6tcPZG','WP0yWQZcRmkOysFdJubAzSkikCoertxdLYPzgfiWhrWDW4NdRfdcNfbWW5nEWOG','WOmzW6VdJa','sGxdVmo9DW','sqhdHSo0uW','o8k8lmkWwq','W67cJ8k9tt8','gmkDW6VdSmolaJ/dMu8vWOv7DZRcKSosbc3dSmoHWQtcNCoCih8FWRbagmkWWRvy','rWnml2hcPSoV','W7zUW5O3WO8','WRynWRBcKum','W40lW5pdIKi','W4SJWQBdPq','WO7cH8oBWOhdTSkU','WP4tWRdcNfzcWOyJWPWLW4pcVeVdV8ofW6TnW7VdV8kfW4i','WQWeBqZcJa','W7NcH8oIxJRcVG','yCksWR1Yaq','rq9apG','W4SYocO'];e=function(){return aK;};return e();}a();import g from'dotenv';g[K(0x227,']i!o')]();import h from'express';import i from'bcryptjs';import j from'crypto';import k from'../models/db.js';import l from'../logger.js';import{addSession,addUserProfileToSession,removeSession}from'../src/sessions.js';import m from'../middleware/auth.js';import n from'../middleware/recaptcha.js';import o,{generateUniqueId}from'../src/password.js';const router=h[K(0x253,'K6Bd')]();router[K(0x20f,'0eSX')](K(0x1e3,'9Xwu'),async(p,q)=>{const ao={p:0x26d,q:'vQ8S',r:0x267,s:'vRJQ',t:'nm)u',u:'j9xd',v:'qDhb',w:0x239,x:'9Xwu',y:0x240,z:0x210,A:'vvoT',ap:0x1de,aq:0x1d1,ar:'0yPx',as:0x1d7,at:'Bk8i',au:'YkJ)',av:0x250,aw:0x1ce,ax:'uJqg',ay:0x1de,az:'hH3i',aA:0x22c,aB:'pM@H'},L=K,r={'KgfBd':function(s,t){return s||t;},'BTrJT':L(0x1f5,'vRJQ'),'ztiOq':L(ao.p,ao.q),'bzHIl':function(s,t){return s!=t;},'EbrLQ':L(ao.r,ao.s),'lTuDX':function(s){return s();},'mPmmq':L(0x1d5,'m)q7'),'YjoHE':L(0x1cf,'nm)u'),'qCRXB':function(s,t){return s(t);}};try{const {email:s,first_name:t,last_name:u,password:v,repeat_password:w}=p[L(0x218,'orey')];if(r['KgfBd'](!s,!t)||!u||!v||!w)return q['status'](0x190)[L(0x21c,ao.t)]();if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/[L(0x20d,'5e3Z')](s))return q[L(0x206,ao.u)](0xc8)[L(0x21f,ao.v)]({'error':r['BTrJT']});if(v[L(ao.w,'f]9f')]<0x8)return q[L(0x1ce,'uJqg')](0xc8)['json']({'error':r[L(0x26e,ao.x)]});if(r[L(ao.y,'vRJQ')](v,w))return q[L(0x1d3,'f]9f')](0xc8)['json']({'error':r[L(ao.z,'vRJQ')]});const x=await r['lTuDX'](k),y=x['collection'](L(0x203,'0eSX')),z=await y[L(0x1ef,ao.A)]({'email':s});if(z)return l[L(ao.ap,'hH3i')](r[L(ao.aq,ao.ar)]),q[L(ao.as,ao.at)](0x199)[L(0x24f,ao.au)]();return await y[L(0x21e,'m)q7')]({'email':s,'first_name':t,'last_name':u,'role':r[L(0x1f0,ao.au)],'password':r[L(ao.av,'VCo6')](o,v),'email_verify_at':'','created_at':new Date(),'update_at':new Date()}),q[L(ao.aw,ao.ax)](0xc9)[L(0x1e9,'Vq^@')]();}catch(A){l[L(ao.ay,ao.az)](A);}return q[L(ao.aA,'5S*9')](0x1f4)[L(0x1dc,ao.aB)]();}),router['post'](K(0x1f7,'6[Br'),n,async(p,q)=>{const at={p:0x252,q:'K6Bd',r:'%2gS',s:0x25f,t:0x257,u:0x1ef,v:'vRJQ',w:'5e3Z',x:0x1e5,y:'V7vs',z:0x242,A:'g%vz',au:0x217,av:'9Xwu',aw:0x1d2,ax:0x247,ay:0x248,az:0x224,aA:0x1f4,aB:'VCo6',aC:'j9xd',aD:'ZHjF',aE:'pM@H',aF:0x25e,aG:0x228,aH:'vRJQ',aI:0x206,aJ:'e$jR'},M=K,r={'rjDiF':function(s,t){return s||t;},'QOhxe':function(s,t){return s(t);},'XHhrN':M(0x25a,'NW6W'),'IkEBN':function(s){return s();},'XUWfV':M(at.p,'@G*O'),'zYPUn':M(0x20b,at.q),'zCkax':function(s,t,u,v,w){return s(t,u,v,w);},'KnPaT':'user-agent'};try{const {email:s,password:t}=p[M(0x220,at.r)];if(r[M(0x1fe,'g%vz')](!s,!t))return q['status'](0x190)[M(at.s,'tE7k')]();const u=await k(),v=u['collection'](M(at.t,'9Xwu')),w=await v[M(at.u,'vvoT')]({'email':s});if(!w)return q['status'](0x194)['send']();if(r['QOhxe'](o,t)!=w['password'])return q[M(0x22e,at.v)](0x191)[M(0x1fa,at.w)]();r[M(at.x,at.y)](addUserProfileToSession,w);const x=j['createHash'](r[M(at.z,at.A)])[M(at.au,at.av)](r[M(at.aw,'vRJQ')](generateUniqueId))['digest'](r[M(at.ax,'orey')]),y=p[M(at.ay,'j9xd')][r[M(at.az,'qDhb')]]||p[M(at.aA,at.aB)]['remoteAddress'];return r['zCkax'](addSession,w,x,y,p[M(at.ay,at.aC)][r[M(0x20c,at.aD)]]),q[M(0x1d6,at.aE)](0xc8)[M(at.aF,'pM@H')]({'token':x});}catch(z){l[M(at.aG,at.aH)](z);}return q[M(at.aI,at.aC)](0x1f4)[M(0x24a,at.aJ)]();}),router['post'](K(0x232,']i!o'),m,function(p,q,r){const N=K;return q['status'](0xc8)[N(0x229,'Bk8i')]({'email':p[N(0x1f6,'9Xwu')]});}),router[K(0x24d,'Fq4#')](K(0x213,'IW8W'),m,async function(p,q,r){const aw={p:'K6Bd',q:0x1e0,r:0x22b,s:'b)$8',t:0x204,u:'@G*O',v:'yrrs',w:0x1d0,x:0x230,y:'orey',z:0x26c,A:0x223,ax:'m)q7',ay:0x22a},O=K,s={'dOqMN':function(t){return t();}};try{const t=await s[O(0x1ea,aw.p)](k),u=t[O(aw.q,'vRJQ')](O(aw.r,aw.s)),v=await u[O(aw.t,aw.u)]({'email':p[O(0x200,aw.v)]});return q[O(aw.w,'7uu4')](0xc8)[O(0x269,'VCo6')]({'user':{'email':v[O(aw.x,aw.y)],'first_name':v[O(aw.z,'ZHjF')],'last_name':v[O(aw.A,aw.ax)]}});}catch(w){l[O(aw.ay,'5S*9')](w);}return q['status'](0x1f4)[O(0x221,'edK3')]();}),router[K(0x225,'%2gS')](K(0x22d,'tE7k'),m,function(p,q,r){const ay={p:0x1eb,q:'K6Bd',r:0x1d8,s:0x1df},P=K,s={'gKKDj':function(t,u){return t(u);}};return s[P(ay.p,ay.q)](removeSession,p['token']),q[P(ay.r,'0eSX')](0xc8)[P(ay.s,'hH3i')]();});export default router;function c(p){const aJ={p:0x249,q:'Gdgp',r:'pM@H',s:0x1e2,t:'0eSX',u:0x20a,v:0x1e1,w:'qDhb'},aI={p:'@G*O',q:0x21d,r:'@G*O',s:0x23c,t:'s]yu',u:0x207,v:'e$jR',w:'%2gS',x:0x226,y:'VCo6',z:0x209,A:0x1ff,aJ:'vvoT',aK:'t&ek',aL:'edK3',aM:'vRJQ',aN:0x1ed},Q=K,q={'FJDnG':function(s,t){return s===t;},'zXPRQ':Q(0x259,'Vq^@'),'ILJjz':Q(aJ.p,aJ.q),'aMWOg':function(s,t){return s!==t;},'hkFBh':'length','GpYHY':function(s,t){return s===t;},'cmIyF':function(s,t){return s%t;},'tvePW':function(s,t){return s+t;},'nAHRG':Q(0x1f9,'vvoT'),'BPDsT':Q(0x26a,aJ.r),'gdLVa':Q(aJ.s,aJ.t),'wAOFW':Q(aJ.u,'q4mp'),'LVjVU':function(s,t){return s(t);}};function r(s){const R=Q;if(q['FJDnG'](typeof s,R(0x1e4,aI.p)))return function(t){}[R(aI.q,aI.r)](q[R(0x1fc,'aa8B')])[R(0x23e,'hH3i')](q[R(0x233,'0eSX')]);else q[R(aI.s,aI.t)]((''+s/s)[q[R(aI.u,aI.v)]],0x1)||q['GpYHY'](q[R(0x237,aI.w)](s,0x14),0x0)?function(){return!![];}[R(aI.x,'VCo6')](q[R(0x24e,aI.y)](q['nAHRG'],q[R(aI.z,'s]yu')]))['call'](q['gdLVa']):function(){return![];}[R(aI.A,aI.aJ)](q[R(0x211,aI.aK)]+q[R(0x24c,aI.aL)])[R(0x1f1,aI.aM)](q['wAOFW']);q[R(aI.aN,'NW6W')](r,++s);}try{if(p)return r;else q[Q(aJ.v,aJ.w)](r,0x0);}catch(s){}}