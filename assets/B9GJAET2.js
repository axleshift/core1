import{r as e,R as t,j as s}from"./B29SdWEC.js";import{R as i}from"./Cri8ushB.js";import{F as r,a,Y as o}from"./pc0rMXAE.js";import{b as l,e as n}from"./YLznJbGB.js";import"./U81FJbgb.js";import{d as c}from"./BFKNndIN.js";import{c as m,T as p,U as d,i as h,Q as j,R as u}from"./B8X9Gey2.js";import"./ucIcx5RQ.js";import"./E8MUDNEF.js";import"./4RmQ9_ev.js";import"./CIdotNGq.js";import"./yJGO6Amu.js";import"./BIw_sdFo.js";import"./BjhGVRpM.js";import"./BFk34ZWe.js";import"./BmTZu7tj.js";import"./CxXfFpkk.js";import"./DPENoFOj.js";import"./Ba2eFa9Y.js";import"./DShVK1TZ.js";import"./CjjZDEdp.js";import"./K-dupnmX.js";import"./D0A342eN.js";import"./DPAjA2jz.js";import"./OBe_9qlD.js";import"./BXEMiIsG.js";import"./Bb7MnDjl.js";import"./CA9thugF.js";import"./BPjVUy-D.js";import"./C_n0TLp5.js";import"./DYPlXUME.js";import"./BqHrj3jM.js";const x=()=>{const x=c(),{addToast:w}=l(),[f,v]=e.useState(!1),[y,_]=e.useState(!1),N=t.useRef(),[b,g]=e.useState({note:"",whitelist_ip:[""]});return f?s.jsx("div",{className:"loading-overlay",children:s.jsx(m,{color:"primary",variant:"grow"})}):s.jsxs(p,{onSubmit:async e=>{e.preventDefault();const t=await N.current.executeAsync();v(!0),axios.post("/auth/token/new",{...b,recaptcha_ref:t}).then((e=>{if(e.data.error)return w(e.data.error);w("New access token generated"),x("/security/access-token"),setTimeout((()=>{x("/security/access-token",{state:{token:e.data.token}})}),1500)})).catch((e=>{var t,s;const i=(null==(s=null==(t=e.response)?void 0:t.data)?void 0:s.error)||"Server is offline or restarting please wait";w(i)})).finally((()=>v(!1)))},children:[s.jsx(i,{ref:N,size:"invisible",sitekey:n}),s.jsx("h4",{children:"New Access Token"}),s.jsx("p",{className:"text-muted",children:"This can be used to authenticate with the API via HTTPS."}),s.jsx(d,{type:"text",id:"note",name:"note",label:"Note",value:b.note,onChange:e=>g({...b,note:e.target.value})}),s.jsx("small",{className:"text-muted",children:"Whats this token for?"}),s.jsxs("div",{className:"mt-3",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx("h4",{children:"Whitelist IP"}),s.jsxs(h,{size:"sm",className:"text-white ms-auto",onClick:()=>Array.isArray(b.whitelist_ip)?b.whitelist_ip.length<6?g((e=>({...e,whitelist_ip:[...e.whitelist_ip,""]}))):void w("Max number of whitelisted ip address reached"):g((e=>({...e,whitelist_ip:[""]}))),disabled:y,children:[s.jsx(r,{icon:a})," Add"]})]}),b.whitelist_ip&&0!==b.whitelist_ip.length&&s.jsx(j,{className:"mb-3",children:s.jsx(u,{children:b.whitelist_ip.map(((e,t)=>s.jsxs("div",{className:"d-flex mb-2",children:[s.jsx(d,{value:e,onChange:e=>((e,t)=>{const s=[...b.whitelist_ip];s[e]=t,g((e=>({...e,whitelist_ip:s})))})(t,e.target.value),placeholder:`192.168.0.${t+1}`}),s.jsx(h,{color:"danger",className:"text-white ms-2",onClick:e=>(e=>{if(1===b.whitelist_ip.length)return void w("Cannot delete the only IP address in the whitelist");const t=b.whitelist_ip.filter(((t,s)=>s!==e));g((e=>({...e,whitelist_ip:t})))})(t),children:s.jsx(r,{icon:o})})]},t)))})}),s.jsxs("div",{className:"d-flex mt-4",children:[s.jsx(h,{type:"submit",color:"primary",className:"me-2 rounded",children:"Generate"}),s.jsx(h,{type:"button",color:"outline-secondary",className:"rounded",onClick:e=>x("/security/access-token"),children:"Cancel"})]})]})};export{x as default};
