(function(j,k){const G={j:0xcd,k:'5kef',l:'!7nT',m:0x73,n:0xa7,o:'ZF3k',p:0xb3,q:'Gxnl',r:0xb1,H:0xad},s=f,l=j();while(!![]){try{const m=parseInt(s(G.j,'EIN#'))/0x1+parseInt(s(0x8e,G.k))/0x2+-parseInt(s(0xbf,G.l))/0x3*(-parseInt(s(G.m,'Gxnl'))/0x4)+parseInt(s(G.n,G.o))/0x5+parseInt(s(G.p,'*Enc'))/0x6+-parseInt(s(0x95,G.q))/0x7*(-parseInt(s(G.r,'NO[2'))/0x8)+-parseInt(s(G.H,'X[El'))/0x9;if(m===k)break;else l['push'](l['shift']());}catch(n){l['push'](l['shift']());}}}(e,0x98e89));const d=(function(){let j=!![];return function(k,l){const m=j?function(){const t=f;if(l){const n=l[t(0x88,'oIml')](k,arguments);return l=null,n;}}:function(){};return j=![],m;};}());(function(){const Q={j:0xa6,k:0xd0,l:'e^T#',m:0x9d,n:'BNIY',o:0xdc,p:'5kef',q:'BefA'},P={j:0x8c,k:'e^T#',l:'*Enc',m:0xe0,n:0xd9,o:')YbG',p:0x9e,q:'UgGN'},u=f,j={'rDXsJ':u(Q.j,'BefA'),'VEYTv':'\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','kcxRY':function(k,l){return k(l);},'lnDti':u(Q.k,Q.l),'veHEC':function(k,l){return k+l;},'eSNSh':u(Q.m,Q.n),'SEfWE':u(Q.o,Q.p),'gVypC':function(k){return k();},'dBIJN':function(k,l,m){return k(l,m);}};j[u(0x8b,Q.q)](d,this,function(){const v=u,k=new RegExp(j[v(P.j,'X[El')]),l=new RegExp(j[v(0x98,P.k)],'i'),m=j[v(0xe1,P.l)](c,j[v(0xe2,P.l)]);!k['test'](j[v(0xd7,'ZF3k')](m,j[v(P.m,'gK1A')]))||!l['test'](m+j[v(P.n,P.o)])?j[v(P.p,P.q)](m,'0'):j[v(0x82,'EIN#')](c);})();}());const b=(function(){let j=!![];return function(k,l){const m=j?function(){if(l){const n=l['apply'](k,arguments);return l=null,n;}}:function(){};return j=![],m;};}()),a=b(this,function(){const a0={j:'iy9h',k:'GYd5',l:'[oB*',m:0xd4,n:0xcb,o:'GA50',p:0x9c,q:0xb9,r:'zcRL',a1:0xa9,a2:'EIN#',a3:0x9f,a4:'%5#O',a5:0x7e,a6:0xcc,a7:'yKVc',a8:'zcRL',a9:'5kef',aa:0xab,ab:'e5nl',ac:0xdf},Z={j:'GYd5',k:0x76,l:'5JSS',m:0x91,n:'XcAl',o:0xcf,p:'yKVc',q:0x87},w=f,j={'KTtqh':function(o,p){return o(p);},'VIiNY':function(o,p){return o+p;},'bZVwP':function(o,p){return o+p;},'XGtYB':w(0xb2,'gK1A'),'MAfCz':w(0xb7,a0.j),'TUjxh':w(0x77,a0.k),'OxpsU':w(0x78,a0.l),'Rytnw':'error','YXJOG':w(a0.m,'zcRL'),'yfxbu':w(a0.n,a0.o),'lAbIZ':'trace','RiigG':function(o,p){return o<p;}},k=function(){const x=w;let o;try{o=j[x(0xdd,Z.j)](Function,j[x(Z.k,Z.l)](j[x(Z.m,Z.n)](j[x(Z.o,Z.p)],j[x(Z.q,'GJ1L')]),');'))();}catch(p){o=window;}return o;},l=k(),m=l['console']=l[w(a0.p,'ZF3k')]||{},n=['log',j['TUjxh'],j['OxpsU'],j[w(a0.q,a0.r)],j[w(a0.a1,a0.a2)],j[w(a0.a3,a0.a4)],j['lAbIZ']];for(let o=0x0;j['RiigG'](o,n[w(0xba,a0.o)]);o++){const p=b[w(a0.a5,'[oB*')][w(a0.a6,a0.a7)][w(0xa4,a0.a8)](b),q=n[o],r=m[q]||p;p[w(0x79,a0.a9)]=b['bind'](b),p[w(a0.aa,'XkKg')]=r[w(0xce,a0.ab)][w(a0.ac,'CqC]')](r),m[q]=p;}});a();import g from'fs';import{ObjectId}from'mongodb';import h from'../models/db.js';function e(){const ao=['tf00mq0','WPZcOCoUD8ku','W5ZcUCk2yG','W5HJnSo6gq','WQhcShJdNZS','W6i7WP3dR8o8','jCkJW57cUhpcHmkA','tMGWiJe','aSkrwxjx','jNrMWPu','W6ZcIKBdIdDeWP85W7OnpCo/W5q','WPPsW6RcICkHrmk8W7KdWOlcKSkw','fxvsWPNdHq','W7jXW5hdT8kO','g8kXWP1tmtdcJSomW4K','oIBdHcZcTG','WRnWW5xcLMa','W7eVjWhcKNRcICoHWQy9cmoS','CJ/dSmoxWRRdOmkMWQa','W4ZcVCkPFCo/W7RdLmkh','WOWdW6hcPLm','W5ZcT8k0FCoIW6FdJ8kxW58hW7G','WP7dSxxcNCkt','W7afBmktcW','r8oxtCorWRaGWRq','W4pdPSkJW6uT','cmk2W5OrWPW','dsDwsdK','fCoJW78gj8oxW7xdRmoKmW','WQpdPwiCW5yh','WOJcNCosq8ksW4VdKrGy','WQ7cR38','W5eizmkT','W6mfWPldS8oD','tf8xcWVdQgxdVmkFW7aadZTNjSoV','fSkafSkBW6P0W6qVx2JdOgCW','WP90WRrQWP0q','t1DrW7eb','uInL','WOP4WPn3WPKCWQmT','WRtdGSkkWRHFdwyOWQDs','q8oNmZuSnrJcQCkLg8kHd8o4WQ8','WPG7nSo5DG','WQ7dJr7cJgO4W40vW680mq','WOGLmSoIAq','dSkZWPxdI2vSnt5F','W6/cV0Knd2tdQ0hcKuZdTCo1ucyEWQmJeSkU','W6lcMSouW6mowcOgWPjUWP/cP8os','rqhcOYnO','WQKJW4ZcU0VdPmkyWQWtDmo4','W4KHW6uSF212WR0','WP/dUmoAxmkUofBcQ8k7nrJcI2JdNSkIWRddVYVcL8ogcCkdWPHJW4zDW7ZdQqf3dCkx','lc7dNaZcKeeaWPxdRCo4W5jIivCK','W6eyFSkNpW','WRPNW4NcNMBcVa','WOijW4JcMeG','cHScWOfsEWlcNmkOhtGYW6VcUCokWQxdUwNdNG','lZFdUb/cLW','paniud8','WO7dRmoVoSkLWQpcJCkqW6idW7HYAq','WR0vW4/cK0y','BMBdKvaRBmkMnmoRWQC','nmkKW5SbWQhdGhe','W7hcPmoDaCkEW714vSoFW5RdMGWUWPFcVhtcGSkOwImPWOjQFmk7kI3dU01rESkK','t1GlbW0','m8oTW6uAdW','fSkGWP5lfW','nSkOW5OgWQpdGa','W7BcQSkBwY1ICrxcLMJcPCoQsW','W7rsimovgG','WRZdTh4sW4Wi','WQjJW4xcLxC','FxVdKKGHE8kRlCoH','jdyVWOX+WP8Jy2ddL0BdLq','WPKNamo/D0VcRSkt','vu7dIwum','WRmOW5hcHG','pdpdMqtcIhS5WP7dUG','Ar7dS8oLWPG','n2nHWQRdUrS','W5yzACkSodmWW6RdKa','krxdNGv7','W4pcUINdQmoOW5a6','uSoDA8oNWPW','WRFdP8kmDSks','rt4npdS','WQxdKvVcImkKn8kbWOZdP8oQ','aSk6Bwq','WRtdLW/cJxS','W7O+W6uYW4i','W6JdMSoDWQtcQq','dXVdMc0','W7JcIxmRfq','WRZdJSkEWOzJ','WRVdG8kIWQbt','WORcSuyskx/dKG','W7f9v23dIdBcPG','W73dJL3cOIC','FxFcIvZdIICyWQNdRmoKW7Xv','vXpdQSoQWOO','W4ylW6mT','pSkLW4Ga','WOldPG/cIMadW4aGW5u','W47cVSkBlSkw','WOmNja','W7/cRSonlxG','WPtdQmkgW5KVgCkB','nmkKW4aCWQhdL3zdeLGN','yYv2','i3nWWRhdIrWP','qXZcVZ9UdCkTwCkGW6iN','CvLIW44f','WQvNW5tcINVcU8kMWOy'];e=function(){return ao;};return e();}import i from'./logger.js';function f(a,b){const c=e();return f=function(d,g){d=d-0x72;let h=c[d];if(f['cTQyjF']===undefined){var i=function(n){const o='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let p='',q='';for(let r=0x0,s,t,u=0x0;t=n['charAt'](u++);~t&&(s=r%0x4?s*0x40+t:t,r++%0x4)?p+=String['fromCharCode'](0xff&s>>(-0x2*r&0x6)):0x0){t=o['indexOf'](t);}for(let v=0x0,w=p['length'];v<w;v++){q+='%'+('00'+p['charCodeAt'](v)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(q);};const m=function(n,o){let p=[],q=0x0,r,t='';n=i(n);let u;for(u=0x0;u<0x100;u++){p[u]=u;}for(u=0x0;u<0x100;u++){q=(q+p[u]+o['charCodeAt'](u%o['length']))%0x100,r=p[u],p[u]=p[q],p[q]=r;}u=0x0,q=0x0;for(let v=0x0;v<n['length'];v++){u=(u+0x1)%0x100,q=(q+p[u])%0x100,r=p[u],p[u]=p[q],p[q]=r,t+=String['fromCharCode'](n['charCodeAt'](v)^p[(p[u]+p[q])%0x100]);}return t;};f['afdhzh']=m,a=arguments,f['cTQyjF']=!![];}const j=c[0x0],k=d+j,l=a[k];return!l?(f['HWkWnQ']===undefined&&(f['HWkWnQ']=!![]),h=f['afdhzh'](h,g),a[k]=h):h=l,h;},f(a,b);}export const addSession=async(j,k,l,m)=>{const a1={j:0x96,k:'5JSS',l:'*Enc',m:'5JSS',n:0xa3,o:'1Y@^'},y=f,n={'hDpAK':y(a1.j,a1.k)};try{const o=await h();await o[y(0xac,a1.l)](n[y(0xd2,a1.m)])['insertOne']({'user_id':j['_id'],'token':k,'active':!![],'ip_address':l,'user_agent':m,'last_accessed':Date[y(a1.n,'oIml')]()});}catch(p){i[y(0xb4,a1.o)](p);}};(function(){const a6={j:'K(0(',k:0xc5,l:0xb5},a5={j:'BefA',k:'iy9h',l:'t^$y'},z=f,j={'ROBck':function(m,n){return m(n);},'fwMYr':function(m,n){return m+n;},'SbxIS':z(0xbc,a6.j),'EavpM':function(m){return m();}},k=function(){const A=z;let m;try{m=j['ROBck'](Function,j[A(0x84,a5.j)](j[A(0xd8,a5.k)],A(0xc3,a5.l))+');')();}catch(n){m=window;}return m;},l=j[z(a6.k,'P)eL')](k);l[z(a6.l,'e^T#')](c,0x9c4);}());export const getUser=async j=>{const a7={j:0x72,k:0xda,l:'*B42',m:0xae,n:'#pe3',o:'Hg$2',p:0x92,q:'2H1h',r:0xdb,a8:0xb8,a9:'GA50'},B=f,k={'HUQer':'sessions'};try{const l=await h(),m=await l['collection'](k['HUQer'])[B(a7.j,'u@vp')]({'token':j});if(!m)return null;const n=await l[B(a7.k,a7.l)](B(a7.m,'e5nl'))[B(0x8a,a7.n)]({'_id':m[B(0x80,a7.o)]});return{'_id':n[B(0xaa,'#fKh')],'email':n[B(0xb0,'e5nl')],'first_name':n['first_name'],'last_name':n[B(a7.p,a7.q)],'role':n[B(a7.r,'X[El')],'email_verify_at':n[B(a7.a8,'yvbf')]};}catch(o){i[B(0x94,a7.a9)](o);}return null;};export const removeSession=async j=>{const a9={j:'e^T#',k:0xa0,l:'P)eL',m:0xa2,n:'e5nl'},C=f,k={'gSwac':function(l){return l();},'XOpjm':C(0x97,'!7nT')};try{const l=await k[C(0xc0,a9.j)](h);await l[C(a9.k,a9.l)](k[C(0xbb,'e^T#')])[C(a9.m,'u379')]({'token':j},{'$set':{'active':![],'last_accessed':Date[C(0x7b,a9.n)]()}});}catch(m){i['error'](m);}};export const isActiveToken=async j=>{const aa={j:'GA50',k:0xbd,l:'yvbf',m:'!lC[',n:0xc7,o:'[oB*',p:'yKVc',q:0xb6,r:0xa8,ab:0xc4,ac:'BefA'},D=f,k={'ftEzk':D(0x83,aa.j)};try{const l=await h(),m=await l['collection'](k[D(aa.k,aa.l)])[D(0xd6,aa.m)]({'token':j});if(m[D(aa.n,aa.o)])await l[D(0xc1,aa.p)](D(aa.q,'!^WV'))[D(0xd1,'yvbf')]({'token':j},{'$set':{'last_accessed':Date[D(0x7f,'#fKh')]()}});return m[D(aa.r,'XkKg')];}catch(n){i[D(aa.ab,aa.ac)](n);}return![];};function c(j){const an={j:0x8d,k:'Hg$2',l:'5kef',m:0xde},am={j:0xca,k:0x99,l:'!7nT',m:0xc9,n:0xc2,o:0x7c,p:'yvbf',q:0xa5,r:0x89,an:'jH1D',ao:0x81,ap:'1Y@^',aq:'u379',ar:0x9b,as:'zcRL',at:0xd5,au:0xc6,av:'2H1h',aw:'Hg$2',ax:0x9a,ay:'*B42'},E=f,k={'KnLHD':function(m,n){return m===n;},'YDCpM':'while\x20(true)\x20{}','IsvDj':function(m,n){return m!==n;},'aLXUr':function(m,n){return m+n;},'seyIJ':function(m,n){return m/n;},'eUTsC':function(m,n){return m%n;},'HBfzs':function(m,n){return m+n;},'CdfZC':'debu','DghLg':E(an.j,'wjhE'),'JPCTe':E(0xd3,an.k),'CuGZS':E(0xaf,an.l),'XOByR':function(m,n){return m(n);},'GVLNx':function(m,n){return m(n);}};function l(m){const F=E;if(k['KnLHD'](typeof m,F(am.j,'oO)h')))return function(n){}[F(am.k,am.l)](k['YDCpM'])[F(am.m,'GJ1L')](F(am.n,'[oB*'));else k[F(am.o,'L(^S')](k['aLXUr']('',k[F(0x93,am.p)](m,m))[F(0xa1,'oO)h')],0x1)||k[F(am.q,'jH1D')](k[F(0x74,'gb1[')](m,0x14),0x0)?function(){return!![];}['constructor'](k[F(0xbe,'%5#O')](k['CdfZC'],k[F(0x7a,'t^$y')]))[F(0x86,'!7nT')](k[F(am.r,am.an)]):function(){return![];}[F(am.ao,am.ap)](k[F(0x85,am.aq)](k[F(am.ar,am.as)],k[F(am.at,'CqC]')]))[F(am.au,am.av)](k[F(0x90,am.aw)]);k[F(am.ax,am.ay)](l,++m);}try{if(j)return l;else k[E(an.m,'^OJ*')](l,0x0);}catch(m){}}