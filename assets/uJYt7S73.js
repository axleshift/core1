import{r as l,R as E,j as e}from"./D3kDgYDB.js";import{R as P}from"./D0iU1EWp.js";import{F as d,O as S,P as R,Q as T,R as D,S as z}from"./3V3OsIEt.js";import{V as F,a as p,b as h}from"./D0Vj9XiZ.js";import{E as u}from"./DYDFNPHr.js";import{C as $,D as B,E as y,y as V,O as o,M as w,K}from"./CRebGdRz.js";import"./CNSOrHVr.js";import"./WyM-ksIe.js";import"./dB90dn3U.js";import"./Dw8pycEM.js";import"./8JwjhRSi.js";import"./FDBtgKq2.js";import"./D3kAHpSt.js";import"./tpRZQFqq.js";import"./CzFDRTuY.js";import"./CQ-yZ3vu.js";import"./BmHAl9XU.js";import"./t_wxcTun.js";import"./DiDpq0UU.js";import"./CHUBTVDa.js";import"./CXnULsF_.js";import"./CCb-kr4I.js";import"./Cz0CWeBA.js";import"./Cp7XljvA.js";import"./BQBsAJpH.js";import"./CWmxXzlZ.js";import"./BZxJdD1U.js";const xe=()=>{const[b,c]=l.useState(!1),m=E.useRef(),[x,g]=l.useState(!0),[A,M]=l.useState(!1),[r,n]=l.useState({token:"",whitelist_ip:[]}),v=()=>{g(s=>!s)},f=async()=>{try{await navigator.clipboard.writeText(r),alert("API Key copied!")}catch(s){console.log(s),alert("Failed... no idea why.")}},j=async()=>{c(!0);const s=await m.current.executeAsync(),a=new FormData;a.append("recaptcha_ref",s),await axios.post(`${p}/api/v1/auth/token/new`,a,{headers:{Authorization:`Bearer ${cookies.get(h)}`}}).then(t=>n(t.data)).catch(t=>{console.error(t);const i=u[t.status]||"An unexpected error occurred";alert(i)}).finally(()=>c(!1))},C=async()=>{c(!0),await axios.get(`${p}/api/v1/auth/token/`,{headers:{Authorization:`Bearer ${cookies.get(h)}`}}).then(s=>n(s.data)).catch(s=>{console.error(s);const a=u[s.status]||"An unexpected error occurred";alert(a)}).finally(()=>c(!1))},_=()=>{if(!Array.isArray(r.whitelist_ip))return n(s=>({...s,whitelist_ip:[""]}));if(r.whitelist_ip.length<6)return n(s=>({...s,whitelist_ip:[...s.whitelist_ip,""]}));alert("Max number of whitelisted ip address reached")},k=(s,a)=>{const t=[...r.whitelist_ip];t[s]=a,n(i=>({...i,whitelist_ip:t}))},I=async s=>{s.preventDefault(),c(!0);const a=await m.current.executeAsync(),t=new FormData;t.append("whitelist_ip",r.whitelist_ip),t.append("recaptcha_ref",a),await axios.post(`${p}/api/v1/auth/token/whitelist-ip`,t,{headers:{Authorization:`Bearer ${cookies.get(h)}`}}).then(i=>{if(i.data.error)return alert(i.data.error);alert("done")}).catch(i=>{console.error(i);const N=u[i.status]||"An unexpected error occurred";alert(N)}).finally(()=>c(!1))};return l.useEffect(()=>{C()},[]),e.jsxs("div",{children:[b&&e.jsx("div",{className:"loading-overlay",children:e.jsx($,{color:"primary",variant:"grow"})}),e.jsx(P,{ref:m,size:"invisible",sitekey:F}),e.jsxs(B,{xs:{cols:1},sm:{cols:2},children:[e.jsxs(y,{children:[e.jsx("h4",{children:"Auth token"}),!r&&e.jsx("div",{className:"text-center border rounded mb-4",children:e.jsxs("div",{className:"p-1 p-md-5 my-5 my-md-0",children:[e.jsx(V,{src:"/images/threat.png",fluid:!0,width:"50%"}),e.jsx("h1",{children:"There was no API Token"}),e.jsx(o,{color:"primary",size:"sm",onClick:j,children:"Generate Token"})]})}),r&&e.jsx("div",{className:"text-center border rounded mb-4",children:e.jsxs("div",{className:"p-2 p-md-3 my-5 my-md-0",children:[e.jsxs("div",{className:"d-flex mb-3",children:[e.jsx(w,{className:x?"blurred":"",value:r.token,"aria-describedby":"basic-addon"}),e.jsx(o,{className:"ms-2",onClick:v,children:e.jsx(d,{icon:x?S:R})}),e.jsx(o,{className:"ms-2",onClick:f,children:e.jsx(d,{icon:T})})]}),e.jsx(o,{color:"primary",size:"sm",onClick:j,children:"Generate new token"})]})})]}),e.jsxs(y,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h4",{children:"Ip address"}),e.jsxs(o,{color:"success",size:"sm",className:"text-white",onClick:_,disabled:A,children:[e.jsx(d,{icon:D})," Create"]})]}),!r.whitelist_ip&&e.jsx("div",{className:"text-center border rounded mb-4",children:e.jsx("div",{className:"p-2 p-md-3 my-5 my-md-0",children:e.jsx("h6",{children:"There was no Whitelisted IP Addresses"})})}),r.whitelist_ip&&e.jsx("div",{className:"text-center border rounded mb-4",children:e.jsx("div",{className:"p-2 p-md-3 my-5 my-md-0",children:e.jsxs(K,{onSubmit:I,children:[r.whitelist_ip.map((s,a)=>e.jsxs("div",{className:"d-flex mb-2",children:[e.jsx(w,{value:s,onChange:t=>k(a,t.target.value),placeholder:`192.168.0.${a+1}`}),e.jsx(o,{color:"danger",className:"text-white ms-2",onClick:f,children:e.jsx(d,{icon:z})})]},a)),e.jsx(o,{type:"submit",color:"primary",className:"d-block me-2 rounded",children:"Save changes"})]})})})]})]})]})};export{xe as default};
