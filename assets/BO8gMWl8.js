import{r as a,j as s}from"./D3kDgYDB.js";import{F as b,z as C}from"./C794Y7R5.js";import{d as N}from"./-dn4NjNH.js";import{c as $,o as A,q as M,a as P,b as R}from"./tEDvo0RF.js";import{V as p}from"./CEWh2H4v.js";import{P as D,i as E}from"./zOQeB56e.js";import{p as I}from"./C2QnNB4K.js";import{k as S}from"./o5tV6Bm-.js";import{S as T,T as O,n as c,aa as k,R as B}from"./CIQNY0Wj.js";import"./CNSOrHVr.js";import"./WyM-ksIe.js";import"./BT8GUUf_.js";import"./BXWtuYvb.js";import"./CWoBZRFf.js";import"./Dw8pycEM.js";import"./8JwjhRSi.js";import"./tpRZQFqq.js";import"./CzFDRTuY.js";import"./CQ-yZ3vu.js";import"./BmHAl9XU.js";import"./B6-gGlhp.js";import"./DzfTGk6K.js";import"./hKczlkOd.js";import"./CXnULsF_.js";import"./CCb-kr4I.js";import"./Cz0CWeBA.js";import"./Cp7XljvA.js";import"./BQBsAJpH.js";import"./DRFurTTo.js";import"./BZxJdD1U.js";const fe=()=>{const r=D(),[u,g]=a.useState([]),[i,m]=a.useState(""),d=a.useRef(null),[y,l]=a.useState(1),f=$(N,"messages"),h=E()?S().id:r.ref;a.useEffect(()=>{const e=A(M(f,P("timestamp")),t=>{const o=t.docs.map(n=>({id:n.id,...n.data()})).filter(n=>n.ref===h);g(o)});return()=>e()},[]),a.useEffect(()=>{d.current&&d.current.scrollIntoView({behavior:"smooth"})},[u]);const j=e=>{if(e.key==="Enter"){if(e.shiftKey){m(t=>t+`
`),l(t=>Math.min(t+1,4)),e.preventDefault();return}x(),e.preventDefault()}},x=async()=>{i.trim()!==""&&(await R(f,{text:i,sender:r.role,timestamp:Date.now(),ref:h}),m(""),l(1))},w=e=>{const t=e.target.value;m(t);const o=Math.max(1,(t.match(/\n/g)||[]).length+1);l(Math.min(o,4))},v=e=>e.split(`
`).map((t,o)=>s.jsxs("span",{children:[t,o<e.split(`
`).length-1&&s.jsx("br",{})]},o));return s.jsx("div",{className:"row d-flex justify-content-center mx-0 mb-4",children:s.jsxs(T,{style:{height:"78vh",overflow:"hidden",padding:"0px"},children:[s.jsxs(O,{style:{position:"relative",height:"100vh",overflow:"auto"},children:[u.map((e,t)=>s.jsxs("div",{className:`d-flex flex-row ${e.sender===(r.role==="user"?"admin":"user")?"justify-content-start":"justify-content-end"}`,children:[e.sender===(r.role==="admin"?"user":"admin")&&s.jsx(c,{crossOrigin:"Anonymous",className:"rounded-5 me-2",src:r.role==="admin"?`${p}/u/${r.ref}.png`:"/images/default-avatar.jpg",style:{width:"45px",height:"100%"}}),s.jsxs("div",{children:[s.jsx("p",{className:`small p-2 mb-1 rounded ${e.sender!==(r.role==="user"?"user":"admin")?"bg-primary text-white me-3":"bg-body-tertiary ms-3"}`,children:v(e.text)}),s.jsx("p",{className:`small ms-3 mb-3 text-muted ${e.sender===(r.role==="user"?"user":"admin")?"me-3":""}`,children:I(e.timestamp)})]}),e.sender===(r.role==="user"?"user":"admin")&&s.jsx(c,{crossOrigin:"Anonymous",className:"rounded-5 ms-2",src:`${p}/u/${r.ref}.png`,style:{width:"45px",height:"100%"}})]},t)),s.jsx("div",{ref:d})]}),s.jsxs("div",{className:"card-footer text-muted d-flex justify-content-start align-items-center p-3 gap-2",children:[s.jsx("div",{children:s.jsx(c,{crossOrigin:"Anonymous",className:"me-2 rounded-5",src:`${p}/u/${r.ref}.png`,style:{width:"40px",height:"100%"}})}),s.jsx(k,{value:i,onChange:e=>w(e),onKeyDown:j,rows:y,style:{resize:"none"}}),s.jsx(B,{type:"submit",color:"primary",className:"me-2 rounded",onClick:x,children:s.jsx(b,{icon:C})})]})]})})};export{fe as default};
