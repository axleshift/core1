import{R as e,r as s,j as a}from"./CbKKHx2O.js";import{F as r,V as t,l as o,m as i,W as n,L as l,M as c,N as d,A as m,I as p,J as u,K as h}from"./CIhhzLoR.js";import{R as j}from"./DfG9QjQz.js";import{a as x,b as g,V as f,e as w}from"./Dk_mBoWf.js";import{d as y,Q as b,R as v,T as N,A as C,X as _,U as S,a as k,Y as z,b as A,c as R,S as U}from"./C-SwLysj.js";import"./D9QqU1Un.js";import"./z-cSZRUs.js";import"./vr9ZyHRf.js";import"./DylAs1sT.js";import"./yJGO6Amu.js";import"./BIw_sdFo.js";import"./CXjkhZnE.js";import"./BKrKJ3DW.js";import"./BFk34ZWe.js";import"./U6rf_yqH.js";import"./D68gzNyG.js";import"./6thM_Rat.js";import"./BsZLDNo0.js";import"./CAJYX4M0.js";import"./Bhaa8ZPc.js";import"./K-dupnmX.js";import"./B7alYAEp.js";import"./DP3P1EsK.js";import"./C3hrCPXF.js";import"./Dw0KO6EP.js";import"./CzGuHLZU.js";import"./B8Let_61.js";import"./CPqRiR-E.js";import"./fZjk1EK6.js";import"./BXEMiIsG.js";import"./Bb7MnDjl.js";import"./CA9thugF.js";import"./BPjVUy-D.js";import"./CTpwok2W.js";import"./DYPlXUME.js";import"./BqHrj3jM.js";const q=()=>{const{user:m,setUser:p}=x(),u=e.useRef(),h=Intl.supportedValuesOf("timeZone"),{addToast:U}=g(),[q,O]=s.useState({username:m.username,email:m.email,first_name:m.first_name,last_name:m.last_name,timezone:m.timezone}),[T,D]=s.useState(!1),[F,I]=s.useState(null),L=e=>{const{name:s,value:a}=e.target;return O((e=>({...e,[s]:a})))};return a.jsxs("div",{children:[T&&a.jsx("div",{className:"loading-overlay",children:a.jsx(y,{color:"primary",variant:"grow"})}),a.jsx("h4",{children:"Account details"}),a.jsx(b,{className:"mb-3",children:a.jsx(v,{children:a.jsxs(N,{onSubmit:e=>(async e=>{if(e.preventDefault(),q.username===m.username&&q.email===m.email&&q.first_name===m.first_name&&q.last_name===m.last_name&&q.timezone===m.timezone)return U("No changes detected.");const s=await u.current.executeAsync();D(!0),axios.post("/auth/user",{...q,recaptcha_ref:s}).then((e=>{if(e.data.error)return U(e.data.error);p(e.data),U("Your changes has been saved.")})).catch((e=>{var s,a;const r=(null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.error)||("network error"===e.message?"Server is offline or restarting please wait":e.message);U(r)})).finally((()=>D(!1)))})(e),children:[F?a.jsx(C,{src:URL.createObjectURL(F),className:"rounded-pill p-1 border mb-3",width:"100px",fluid:!0,loading:"lazy"}):m.avatar?a.jsx(a.Fragment,{children:a.jsx(C,{crossOrigin:"Anonymous",src:`${f}/images/${m.avatar}.png`,className:"rounded-pill p-1 border mb-3",width:"100px",fluid:!0,loading:"lazy"})}):a.jsx("div",{className:"rounded-pill bg-primary d-flex align-items-center justify-content-center mb-3 fs-4",style:{width:"70px",height:"70px",color:"white"},children:(E=m.first_name,E?E.charAt(0).toUpperCase():"")}),a.jsx(r,{id:"faCamera",icon:t,className:"position-absolute bg-secondary p-2 rounded-pill bg-opacity-50",style:{top:"50px",left:"50px",cursor:"pointer"},onClick:()=>{document.querySelector('input[name="profile_pic"]').click()}}),a.jsxs(_,{className:"mb-2",children:[a.jsx(S,{className:"d-none",name:"profile_pic",type:"file",accept:"image/*",onChange:e=>{I(e.target.files[0]);const s=document.getElementById("upload-button"),a=document.getElementById("faCamera");e.target.files.length>0?(s.style.display="inline-block",a.style.display="none"):(s.style.display="none",a.style.display="inline-block")}}),a.jsx(k,{id:"upload-button",color:"primary",className:"ms-2 rounded d-none",onClick:e=>{F&&(async e=>{e.preventDefault();const s=await u.current.executeAsync();D(!0);const a=new FormData;a.append("profile_pic",F),a.append("recaptcha_ref",s),axios.post("/auth/upload",a,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{if(e.data.error)return U(e.data.error);U("Your profile picture has been updated.")})).catch((e=>{var s,a;const r=(null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.error)||("network error"===e.message?"Server is offline or restarting please wait":e.message);U(r)})).finally((()=>D(!1)))})(e)},children:"Upload"})]}),a.jsxs(_,{className:"mb-3",children:[a.jsx(z,{children:a.jsx(r,{icon:o})}),a.jsx(S,{type:"text",name:"username",placeholder:"Username",autoComplete:"username",value:q.username,onChange:e=>L(e)})]}),a.jsxs(_,{className:"mb-3",children:[a.jsx(z,{children:a.jsx(r,{icon:i})}),a.jsx(S,{type:"email",name:"email",placeholder:"Email",autoComplete:"email",value:q.email,onChange:e=>L(e)})]}),a.jsxs(A,{children:[a.jsx(R,{md:6,className:"mb-3",children:a.jsxs(_,{children:[a.jsx(z,{children:a.jsx(r,{icon:o})}),a.jsx(S,{name:"first_name",type:"text",placeholder:"First Name",autoComplete:"given-name",value:q.first_name,onChange:e=>L(e)})]})}),a.jsx(R,{md:6,className:"mb-3",children:a.jsxs(_,{children:[a.jsx(z,{children:a.jsx(r,{icon:o})}),a.jsx(S,{name:"last_name",type:"text",placeholder:"Last Name",autoComplete:"family-name",value:q.last_name,onChange:e=>L(e)})]})})]}),a.jsxs(_,{className:"mb-2 d-none",children:[a.jsx(z,{children:a.jsx(r,{icon:n})}),a.jsx(S,{type:"text",name:"timezone",placeholder:"Timezone",list:"timezone-options",value:q.timezone,onChange:e=>L(e)}),a.jsx("datalist",{id:"timezone-options",children:h.map((e=>a.jsx("option",{value:e},e)))})]}),a.jsxs("div",{className:"mb-3",children:[a.jsxs(k,{color:"primary",className:"mb-1 me-2 rounded",size:"sm",disabled:m.oauth2&&m.oauth2.google,children:[a.jsx(r,{icon:l,className:"me-1"})," ",m.oauth2&&m.oauth2.google?m.oauth2.google.email:"Connect Google"]}),a.jsxs(k,{color:"primary",className:"mb-1 me-2 rounded",size:"sm",disabled:m.oauth2&&m.oauth2.github,children:[a.jsx(r,{icon:c,className:"me-1"})," ",m.oauth2&&m.oauth2.github?m.oauth2.github.email:"Connect Github"]}),a.jsxs(k,{color:"primary",className:"mb-1 me-2 rounded",size:"sm",disabled:m.oauth2&&m.oauth2.microsoft,children:[a.jsx(r,{icon:d,className:"me-1"})," ",m.oauth2&&m.oauth2.microsoft?m.oauth2.microsoft.email:"Connect Microsoft"]})]}),a.jsx(k,{type:"submit",color:"primary",className:"d-block me-2 rounded",children:"Save changes"})]})})}),"user"===m.role&&a.jsxs(a.Fragment,{children:[a.jsx("h4",{className:"text-danger",children:"Delete account"}),a.jsx(b,{className:"mb-3",children:a.jsxs(v,{children:[a.jsxs("p",{children:["If you wish to delete your account, please note that this action is irreversible and will remove all your data permanently.",a.jsx("br",{}),"To proceed with the deletion of your account, please click the button below:"]}),a.jsx("span",{className:"text-muted",children:"We cannot process your account deletion request, if you have unpaid invoices or inroute shippment"}),a.jsx(k,{type:"submit",color:"danger",className:"mt-4 d-block me-2 rounded",disabled:!0,children:"Request account deletion"})]})})]}),a.jsx(j,{ref:u,size:"invisible",sitekey:w})]});var E},O=()=>{const{user:t}=x(),o=e.useRef(),[i,n]=s.useState(!1),[l,c]=s.useState({password:"",new_password:"",repeat_password:""}),[d,g]=s.useState(!1),[f,C]=s.useState(!1),[A,R]=s.useState({error:!1,message:""}),q=e=>{const{id:s,value:a}=e.target;c((e=>({...e,[s]:a})))},O=[{id:1,text:"At least 8 characters",test:e=>e.length>=8},{id:2,text:"At least one uppercase letter",test:e=>/[A-Z]/.test(e)},{id:3,text:"At least one lowercase letter",test:e=>/[a-z]/.test(e)},{id:4,text:"At least one number",test:e=>/[0-9]/.test(e)},{id:5,text:"At least one special character",test:e=>/[!@#$%^&*(),.?":{}|<>]/.test(e)}],T=e=>O.map((s=>({...s,passed:s.test(e)}))),[D,F]=s.useState(T(l.new_password));return a.jsxs("div",{children:[i&&a.jsx("div",{className:"loading-overlay",children:a.jsx(y,{color:"primary",variant:"grow"})}),a.jsxs("h4",{children:["OK"===t.password?"Change":"Set"," Password"]}),a.jsx(b,{className:"mb-3",children:a.jsxs(v,{children:[A.error&&a.jsxs(U,{color:"danger",className:"d-flex align-items-center",children:[a.jsx(r,{className:"flex-shrink-0 me-2",icon:m,size:"xl"}),a.jsx("div",{children:A.message})]}),a.jsxs(N,{onSubmit:async e=>{e&&e.preventDefault();const s=await o.current.executeAsync();n(!0),axios.post("/auth/password",{...l,recaptcha_ref:s}).then((e=>{if(e.data.error)return R({error:!0,message:e.data.error});window.location.reload()})).catch((e=>{var s,a;const r=(null==(a=null==(s=e.response)?void 0:s.data)?void 0:a.error)||("network error"===e.message?"Server is offline or restarting please wait":e.message);R({error:!0,message:r})})).finally((()=>n(!1)))},children:["OK"===t.password&&a.jsxs(_,{className:"mb-3",children:[a.jsx(z,{children:a.jsx(r,{icon:p})}),a.jsx(S,{id:"password",type:d?"text":"password",placeholder:"Password",autoComplete:"current-password",value:l.password,onChange:e=>q(e),required:!0}),a.jsx(z,{children:a.jsx("span",{onClick:e=>g(!d),"aria-label":d?"Hide password":"Show password",children:a.jsx(r,{icon:d?u:h,onClick:e=>g(!d)})})})]}),a.jsxs(_,{className:"mb-3",children:[a.jsx(z,{children:a.jsx(r,{icon:p})}),a.jsx(S,{id:"new_password",type:f?"text":"password",placeholder:"New Password",autoComplete:"new-password",value:l.new_password,onChange:e=>(e=>{q(e),"new_password"===e.target.id&&F(T(e.target.value))})(e),required:!0}),a.jsx(z,{children:a.jsx("span",{onClick:e=>C(!f),"aria-label":f?"Hide password":"Show password",children:a.jsx(r,{icon:f?u:h,onClick:e=>C(!f)})})})]}),l.new_password.length>0&&a.jsx("ul",{children:D.map((e=>a.jsx("li",{className:"text-"+(e.passed?"success":"danger"),children:e.text},e.id)))}),a.jsxs(_,{className:"mb-3",children:[a.jsx(z,{children:a.jsx(r,{icon:p})}),a.jsx(S,{id:"repeat_password",type:"password",placeholder:"Repeat password",autoComplete:"new-password",value:l.repeat_password,onChange:e=>q(e),required:!0})]}),a.jsx(k,{type:"submit",color:"primary",className:"d-block me-2 rounded",children:"Save changes"})]})]})}),a.jsx(j,{ref:o,size:"invisible",sitekey:w})]})},T=()=>a.jsx("div",{className:"d-flex flex-column",children:a.jsxs(A,{children:[a.jsx(R,{xs:12,md:6,lg:5,xl:4,children:a.jsx(q,{})}),a.jsx(R,{xs:12,md:6,lg:5,xl:4,children:a.jsx(O,{})})]})});export{T as default};
