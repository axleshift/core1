import{r as e,R as s,j as t}from"./kqbr3HuW.js";import{R as i}from"./Cn6opJBz.js";import{F as r,L as a,K as o,V as n,b as c,W as l}from"./BNSBxhWN.js";import{a as d,b as h,V as m,c as p}from"./CRRLWr4S.js";import{E as j}from"./URk2IvX2.js";import{C as x,N as u,O as w,t as y,n as v,q as b,o as f}from"./DJLAdtNU.js";import"./BgRKNlhe.js";import"./CgN-7aKy.js";import"./BSjYzxj3.js";import"./BJ13bZ6b.js";import"./c0eKk1Db.js";import"./DFarnK1O.js";import"./uhX4GmSj.js";import"./oXqQd4Ap.js";import"./CQYGjB7w.js";import"./DbzcfNKS.js";import"./BGKE3O6B.js";import"./DJeUPDeV.js";import"./B0UoamS-.js";import"./HSznFPq-.js";import"./omosduih.js";import"./D3yCfJ5s.js";import"./BXEMiIsG.js";import"./B60PFSOe.js";import"./DoV6T4jL.js";import"./CJ2-25UQ.js";import"./BqHrj3jM.js";const k=()=>{const{addToast:k}=d(),[g,N]=e.useState(!0),_=s.useRef(),[A,C]=e.useState(!0),[S,z]=e.useState(!1),[I,$]=e.useState({token:"",whitelist_ip:[]}),T=async()=>{try{await navigator.clipboard.writeText(I),k("API Key copied!")}catch(e){console.log(e),k("Failed... no idea why.")}},E=async()=>{N(!0);const e=await _.current.executeAsync();await axios.post(`${m}/api/v1/auth/token/new`,{recaptcha_ref:e},{headers:{Authorization:`Bearer ${cookies.get(p)}`}}).then((e=>$((s=>({...s,token:e.data.token}))))).catch((e=>{console.error(e);const s=j[e.status]||"Internal Application Error";k(s)})).finally((()=>N(!1)))};return e.useEffect((()=>{(async()=>{await axios.get(`${m}/api/v1/auth/token/`,{headers:{Authorization:`Bearer ${cookies.get(p)}`}}).then((e=>{e.data.error||$(e.data)})).catch((e=>{console.error(e);const s=j[e.status]||"Internal Application Error";k(s)})).finally((()=>N(!1)))})()}),[]),t.jsxs("div",{children:[g&&t.jsx("div",{className:"loading-overlay",children:t.jsx(x,{color:"primary",variant:"grow"})}),t.jsx(i,{ref:_,size:"invisible",sitekey:h}),!g&&t.jsxs(u,{xs:{cols:1},sm:{cols:2},children:[t.jsxs(w,{children:[t.jsx("h4",{children:"Auth token"}),!I.token&&t.jsx("div",{className:"text-center border rounded mb-4",children:t.jsxs("div",{className:"p-1 p-md-5 my-5 my-md-0",children:[t.jsx(y,{src:"/images/threat.png",fluid:!0,width:"50%"}),t.jsx("h4",{children:"There was no Auth Token"}),t.jsx(v,{color:"primary",size:"sm",onClick:E,children:"Generate Token"})]})}),I.token&&t.jsx("div",{className:"text-center border rounded mb-4",children:t.jsxs("div",{className:"p-2 p-md-3",children:[t.jsxs("div",{className:"d-flex mb-3",children:[t.jsx(b,{className:A?"blurred":"",value:I.token,"aria-describedby":"basic-addon"}),t.jsx(v,{className:"ms-2",onClick:()=>{C((e=>!e))},children:t.jsx(r,{icon:A?a:o})}),t.jsx(v,{className:"ms-2",onClick:T,children:t.jsx(r,{icon:n})})]}),t.jsx(v,{color:"primary",size:"sm",onClick:E,children:"Generate new token"})]})})]}),t.jsxs(w,{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("h4",{children:"Ip address"}),t.jsxs(v,{color:"success",size:"sm",className:"text-white",onClick:()=>Array.isArray(I.whitelist_ip)?I.whitelist_ip.length<6?$((e=>({...e,whitelist_ip:[...e.whitelist_ip,""]}))):void k("Max number of whitelisted ip address reached"):$((e=>({...e,whitelist_ip:[""]}))),disabled:S,children:[t.jsx(r,{icon:c})," Create"]})]}),0===I.whitelist_ip.length&&t.jsx("div",{className:"text-center border rounded mb-4",children:t.jsx("div",{className:"p-2 p-md-3 my-5 my-md-0",children:t.jsx("h6",{children:"There was no Whitelisted IP Addresses"})})}),0!==I.whitelist_ip.length&&t.jsx("div",{className:"text-center border rounded mb-4",children:t.jsx("div",{className:"p-2 p-md-3",children:t.jsxs(f,{onSubmit:async e=>{e.preventDefault(),N(!0);const s=await _.current.executeAsync();await axios.post(`${m}/api/v1/auth/token/whitelist-ip`,{whitelist_ip:I.whitelist_ip.toString(),recaptcha_ref:s},{headers:{Authorization:`Bearer ${cookies.get(p)}`}}).then((e=>{if(e.data.error)return k(e.data.error);k("Your changes has been saved.")})).catch((e=>{console.error(e);const s=j[e.status]||"Internal Application Error";k(s)})).finally((()=>N(!1)))},children:[I.whitelist_ip.map(((e,s)=>t.jsxs("div",{className:"d-flex mb-2",children:[t.jsx(b,{value:e,onChange:e=>((e,s)=>{const t=[...I.whitelist_ip];t[e]=s,$((e=>({...e,whitelist_ip:t})))})(s,e.target.value),placeholder:`192.168.0.${s+1}`}),t.jsx(v,{color:"danger",className:"text-white ms-2",onClick:T,children:t.jsx(r,{icon:l})})]},s))),t.jsx(v,{type:"submit",color:"primary",className:"d-block me-2 rounded",children:"Save changes"})]})})})]})]})]})};export{k as default};
