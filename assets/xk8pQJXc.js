import{r as s,R as e,j as i}from"./Oq9P1Wj_.js";import{R as t}from"./eGqyD3ZN.js";import{F as a,R as r,E as l,D as n,W as o,a as c,X as d}from"./BFkBtbHA.js";import{b as h,e as m}from"./CClQ46gh.js";import{p as j}from"./2aPQtUzY.js";import{c as p,a as x,b as u,i as w,R as f,P as y,Q as v,T as b,S as N}from"./B1wsI-8q.js";import"./deeEeel3.js";import"./NdsU5MZw.js";import"./BXWkExu4.js";import"./C5ktbw-a.js";import"./c0eKk1Db.js";import"./Ce_fjdqS.js";import"./CewSaW8v.js";import"./B0pL_gbQ.js";import"./DhxmCZ7v.js";import"./fHQ1LRrH.js";import"./CUvxBZEH.js";import"./CA9sZ-Z2.js";import"./YLYDLWv3.js";import"./b9dqFv80.js";import"./VSWDZ_lP.js";import"./B2NO97j6.js";import"./CMOmnr8K.js";import"./Dn-qDmp9.js";import"./XtWrBBVz.js";import"./BXEMiIsG.js";import"./DsGp7kFX.js";import"./CA9thugF.js";import"./B60PFSOe.js";import"./DoV6T4jL.js";import"./CDdQWEAe.js";import"./BqHrj3jM.js";const _=()=>{const{addToast:_}=h(),[g,k]=s.useState(!0),S=e.useRef(),[A,C]=s.useState(!0),[P,z]=s.useState(!1),[I,R]=s.useState([]),[T,F]=s.useState({token:"",whitelist_ip:[]}),Y=async()=>{const s=await S.current.executeAsync();k(!0),axios.post("/auth/token/new",{recaptcha_ref:s}).then((s=>F((e=>({...e,token:s.data.token}))))).catch((s=>{var e,i;const t=(null==(i=null==(e=s.response)?void 0:e.data)?void 0:i.error)||"Server is offline or restarting please wait";_(t)})).finally((()=>k(!1)))};return s.useEffect((()=>{(async()=>{axios.get("/auth/token/").then((s=>{F(s.data),R(s.data.whitelist_ip)})).catch((s=>{var e,i;const t=(null==(i=null==(e=s.response)?void 0:e.data)?void 0:i.error)||"Server is offline or restarting please wait";_(t)})).finally((()=>k(!1)))})()}),[]),g?i.jsx("div",{className:"loading-overlay",children:i.jsx(p,{color:"primary",variant:"grow"})}):T.token?i.jsxs("div",{children:[i.jsx(t,{ref:S,size:"invisible",sitekey:m}),i.jsxs(f,{color:"warning",className:"small",children:[i.jsx(a,{icon:r,className:"me-2"})," You will only be able to use our API by using the token and list of IP Addresses:"]}),i.jsxs(x,{xs:{cols:1},sm:{cols:2},children:[i.jsxs(u,{className:"mb-3",children:[i.jsx("h4",{children:"Auth token"}),i.jsx(y,{children:i.jsxs(v,{children:[i.jsxs("div",{className:"d-flex mb-3",children:[i.jsx(b,{className:A?"blurred":"",value:T.token,"aria-describedby":"basic-addon"}),i.jsx(w,{className:"ms-2",onClick:()=>{C((s=>!s))},children:i.jsx(a,{icon:A?l:n})}),i.jsx(w,{className:"ms-2",onClick:async()=>{try{await navigator.clipboard.writeText(T),_("API Key copied!")}catch(s){_("Failed... no idea why.")}},children:i.jsx(a,{icon:o})})]}),i.jsx(w,{color:"primary",size:"sm",onClick:Y,children:"New token"})]})})]}),i.jsxs(u,{className:"mb-3",children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx("h4",{children:"Whitelist IP"}),i.jsxs(w,{size:"sm",className:"text-white",onClick:()=>Array.isArray(T.whitelist_ip)?T.whitelist_ip.length<6?F((s=>({...s,whitelist_ip:[...s.whitelist_ip,""]}))):void _("Max number of whitelisted ip address reached"):F((s=>({...s,whitelist_ip:[""]}))),disabled:P,children:[i.jsx(a,{icon:c})," Add"]})]}),T.whitelist_ip&&0===T.whitelist_ip.length&&0===I.length&&i.jsx(y,{className:"mb-3",children:i.jsx(v,{className:"justify-content-center",children:i.jsx("h6",{children:"No IP addresses have been whitelisted yet."})})}),T.whitelist_ip&&(0!==T.whitelist_ip.length||0!==I.length)&&i.jsx(y,{className:"mb-3",children:i.jsx(v,{children:i.jsxs(N,{onSubmit:async s=>{s.preventDefault();const e=await S.current.executeAsync();k(!0),axios.post("/auth/token/whitelist-ip",{whitelist_ip:0===T.whitelist_ip.length?"[]":T.whitelist_ip.toString(),recaptcha_ref:e}).then((s=>{if(s.data.error)return _(s.data.error);R(T.whitelist_ip),_("Your changes has been saved.")})).catch((s=>{var e,i;const t=(null==(i=null==(e=s.response)?void 0:e.data)?void 0:i.error)||"Server is offline or restarting please wait";_(t)})).finally((()=>k(!1)))},children:[T.whitelist_ip.map(((s,e)=>i.jsxs("div",{className:"d-flex mb-2",children:[i.jsx(b,{value:s,onChange:s=>((s,e)=>{const i=[...T.whitelist_ip];i[s]=e,F((s=>({...s,whitelist_ip:i})))})(e,s.target.value),placeholder:`192.168.0.${e+1}`}),i.jsx(w,{color:"danger",className:"text-white ms-2",onClick:s=>(s=>{const e=T.whitelist_ip.filter(((e,i)=>i!==s));F((s=>({...s,whitelist_ip:e})))})(e),children:i.jsx(a,{icon:d})})]},e))),i.jsx(w,{size:"sm",type:"submit",color:"primary",className:"d-block me-2 rounded",children:"Save changes"})]})})}),i.jsx("h4",{children:"Last accessed"}),i.jsx(y,{children:i.jsxs(v,{children:[i.jsx("p",{className:"display-5",children:T.last_accessed?j(T.last_accessed):"Never"}),i.jsx("span",{className:"lead",children:T.user_agent?T.user_agent:"NaN"})]})})]})]})]}):i.jsxs(i.Fragment,{children:[i.jsx(t,{ref:S,size:"invisible",sitekey:m}),i.jsx(x,{className:"justify-content-center my-5",children:i.jsx(u,{md:6,children:i.jsxs("div",{className:"clearfix",children:[i.jsx("h1",{className:"float-start display-3 me-4",children:"OOPS"}),i.jsx("h4",{children:"You have not generate a token yet."}),i.jsx(w,{color:"primary",size:"sm",onClick:Y,children:"Generate Token"})]})})})]})};export{_ as default};
