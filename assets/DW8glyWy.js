import{R as e,r as s,j as a}from"./Oq9P1Wj_.js";import{F as t,I as r}from"./C6rVyMd0.js";import{Q as i}from"./Cl7qhzEd.js";import{h as n}from"./DxFnCsxZ.js";import{R as c}from"./eGqyD3ZN.js";import{a as o,b as l,e as d}from"./B7Lpz4X5.js";import{E as m}from"./BGB82IPO.js";import{d as j,k as p}from"./Ce_fjdqS.js";import{c as h,a as f,b as u,d as x,e as y,g as v,h as b,i as g,Y as S}from"./3-dW6UXf.js";import"./deeEeel3.js";import"./NdsU5MZw.js";import"./BXWkExu4.js";import"./C5ktbw-a.js";import"./c0eKk1Db.js";import"./CewSaW8v.js";import"./DvQD94mg.js";import"./DhxmCZ7v.js";import"./fHQ1LRrH.js";import"./CUvxBZEH.js";import"./CA9sZ-Z2.js";import"./YLYDLWv3.js";import"./ChytwAMd.js";import"./Dn-qDmp9.js";import"./XtWrBBVz.js";import"./BXEMiIsG.js";import"./B60PFSOe.js";import"./DoV6T4jL.js";import"./CDdQWEAe.js";import"./BqHrj3jM.js";const w=()=>{const{user:w}=o(),N=e.useRef(),{addToast:k}=l(),[C,R]=s.useState({}),[_,O]=s.useState({});s.useState("");const[D,E]=s.useState(""),[A,$]=s.useState(!1),[q,B]=s.useState(!0),[F,J]=s.useState(!1),[P,Q]=s.useState(!1),T=s.useRef(null),Y=j(),{id:z}=p();return s.useEffect((()=>{(async()=>{$(!0),axios.get(`/freight/${z}`).then((e=>{R(e.data),O(e.data)})).catch((e=>{J(!0)})).finally((()=>$(!1)))})()}),[]),A?a.jsx("div",{className:"loading-overlay",children:a.jsx(h,{color:"primary",variant:"grow"})}):F?a.jsx(f,{className:"justify-content-center my-5",children:a.jsx(u,{md:6,children:a.jsxs("div",{className:"clearfix",children:[a.jsx("h1",{className:"float-start display-3 me-4",children:"OOPS"}),a.jsx("h4",{children:"There was no shipment found."}),a.jsx("p",{children:"Double check tracking id for any mistake."})]})})}):a.jsxs("div",{children:[P&&a.jsxs(x,{visible:!0,onClose:()=>Q(!1),alignment:"center",scrollable:!0,children:[a.jsx(y,{closeButton:!0}),a.jsx(v,{children:a.jsx("div",{className:"d-flex justify-content-center align-items-center",children:a.jsx("div",{ref:T,className:"d-inline-block",children:a.jsx(i,{value:z})})})}),a.jsx(b,{className:"d-flex justify-content-center align-items-center",children:a.jsx(g,{color:"primary",onClick:()=>{Q(!1),n(T.current,{useCORS:!0}).then((e=>{const s=e.toDataURL("image/png"),a=document.createElement("a");a.href=s,a.download="qrcode.png",document.body.appendChild(a),a.click(),document.body.removeChild(a)}))},children:"Download"})})]}),a.jsx(c,{ref:N,size:"invisible",sitekey:d}),a.jsxs("div",{className:"d-flex flex-column flex-sm-row justify-content-between align-items-center mb-4",children:[a.jsx("span",{className:"d-block",children:z}),a.jsxs(S,{className:"mb-2 mb-sm-0",children:[a.jsx(g,{color:"primary",className:"me-2 rounded",onClick:e=>Q(!0),children:a.jsx(t,{icon:r})}),"cancelled"!==D&&"received"!==D&&a.jsxs(a.Fragment,{children:["to_pay"===D&&"user"===w.role&&a.jsx(g,{color:"primary",className:"me-2 rounded",onClick:async()=>{const e=await N.current.executeAsync();$(!0),axios.post("/invoices",{id:z,recaptcha_ref:e}).then((e=>window.location.href=e.data.r_url)).catch((e=>{const s=m[e.status]||"Server is offline or restarting please wait";k(s)})).finally((()=>$(!1)))},children:"Book shipment"}),a.jsx(g,{color:"primary",className:"me-2 rounded",onClick:async()=>{if(q)return B(!1);const e=await N.current.executeAsync();$(!0);const s={..._,recaptcha_ref:e};axios.post(`/freight/update/${z}`,s).then((e=>k("Your changes has been saved."))).catch((e=>{const s=m[e.status]||"Server is offline or restarting please wait";k(s,"Submit failed!"),O(C)})).finally((()=>{$(!1),B(!0)}))},disabled:["to_receive","received"].includes(D),children:q?"Edit":"Save"}),a.jsx(g,{color:q?"danger":"warn",className:"me-2 rounded",onClick:async()=>{if(!q)return B(!0),void O(C);const e=await N.current.executeAsync();$(!0),axios.post(`/freight/cancel/${z}`,{recaptcha_ref:e}).then((e=>{k("Shipment has been cancelled."),Y("/dashboard")})).catch((e=>{const s=m[e.status]||"Server is offline or restarting please wait";k(s,"Submit failed!"),O(C)})).finally((()=>$(!1)))},disabled:["to_receive","received"].includes(D),children:"Cancel"})]})]})]}),JSON.stringify(C)]})};export{w as default};
