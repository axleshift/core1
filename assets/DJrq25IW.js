import{r as a,j as t}from"./D3kDgYDB.js";import{F as w,z as b}from"./BqcBghZ0.js";import{d as C}from"./CafcEviV.js";import{c as N,o as M,q as D,a as P,b as R}from"./tEDvo0RF.js";import{P as _,i as E}from"./zOQeB56e.js";import{p as S}from"./C2QnNB4K.js";import{k}from"./o5tV6Bm-.js";import{O as A,P as B,n as l,a7 as F,N as I}from"./DCCyG56P.js";import"./CNSOrHVr.js";import"./WyM-ksIe.js";import"./BT8GUUf_.js";import"./D7UqtEvD.js";import"./CWoBZRFf.js";import"./Dw8pycEM.js";import"./8JwjhRSi.js";import"./tpRZQFqq.js";import"./CzFDRTuY.js";import"./CQ-yZ3vu.js";import"./BmHAl9XU.js";import"./B6-gGlhp.js";import"./DiDpq0UU.js";import"./hKczlkOd.js";import"./CXnULsF_.js";import"./CCb-kr4I.js";import"./Cz0CWeBA.js";import"./Cp7XljvA.js";import"./BQBsAJpH.js";import"./DRFurTTo.js";import"./BZxJdD1U.js";import"./BXWtuYvb.js";const ue=()=>{const r=_(),[p,x]=a.useState([]),[n,m]=a.useState(""),c=a.useRef(null),[j,d]=a.useState(1),u=N(C,"messages"),h=E()?k().id:r.customer_service_ref;a.useEffect(()=>{const e=M(D(u,P("timestamp")),s=>{const o=s.docs.map(i=>({id:i.id,...i.data()})).filter(i=>i.customer_service_ref===h);x(o)});return()=>e()},[]),a.useEffect(()=>{c.current&&c.current.scrollIntoView({behavior:"smooth"})},[p]);const g=e=>{if(e.key==="Enter"){if(e.shiftKey){m(s=>s+`
`),d(s=>Math.min(s+1,4)),e.preventDefault();return}f(),e.preventDefault()}},f=async()=>{n.trim()!==""&&(await R(u,{text:n,sender:r.role,timestamp:Date.now(),customer_service_ref:h}),m(""),d(1))},v=e=>{const s=e.target.value;m(s);const o=Math.max(1,(s.match(/\n/g)||[]).length+1);d(Math.min(o,4))},y=e=>e.split(`
`).map((s,o)=>t.jsxs("span",{children:[s,o<e.split(`
`).length-1&&t.jsx("br",{})]},o));return t.jsx("div",{className:"row d-flex justify-content-center mx-0 mb-4",children:t.jsxs(A,{style:{height:"78vh",overflow:"hidden",padding:"0px"},children:[t.jsxs(B,{style:{position:"relative",height:"100vh",overflow:"auto"},children:[p.map((e,s)=>t.jsxs("div",{className:`d-flex flex-row ${e.sender===(r.role==="user"?"admin":"user")?"justify-content-start":"justify-content-end"}`,children:[e.sender===(r.role==="admin"?"user":"admin")&&t.jsx(l,{className:"rounded-5 me-2",src:"https://avatars.githubusercontent.com/u/62317165?v=4",style:{width:"45px",height:"100%"}}),t.jsxs("div",{children:[t.jsx("p",{className:`small p-2 mb-1 rounded ${e.sender!==(r.role==="user"?"user":"admin")?"bg-primary text-white me-3":"bg-body-tertiary ms-3"}`,children:y(e.text)}),t.jsx("p",{className:`small ms-3 mb-3 text-muted ${e.sender===(r.role==="user"?"user":"admin")?"me-3":""}`,children:S(e.timestamp)})]}),e.sender===(r.role==="user"?"user":"admin")&&t.jsx(l,{className:"rounded-5 ms-2",src:"https://avatars.githubusercontent.com/u/62317165?v=4",style:{width:"45px",height:"100%"}})]},s)),t.jsx("div",{ref:c})]}),t.jsxs("div",{className:"card-footer text-muted d-flex justify-content-start align-items-center p-3 gap-2",children:[t.jsx("div",{children:t.jsx(l,{className:"me-2 rounded-5",src:"https://avatars.githubusercontent.com/u/62317165?v=4",style:{width:"40px",height:"100%"}})}),t.jsx(F,{value:n,onChange:e=>v(e),onKeyDown:g,rows:j,style:{resize:"none"}}),t.jsx(I,{type:"submit",color:"primary",className:"me-2 rounded",onClick:f,children:t.jsx(w,{icon:b})})]})]})})};export{ue as default};
